import{_ as n}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as a,e as t}from"./app.3009e38b.js";const p={},o=t(`<h2 id="cookie-\u548C-session-\u7F3A\u70B9" tabindex="-1"><a class="header-anchor" href="#cookie-\u548C-session-\u7F3A\u70B9" aria-hidden="true">#</a> cookie \u548C session \u7F3A\u70B9</h2><ol><li>\u5B89\u5168\u6027\u95EE\u9898\uFF1Acookie \u548C session \u4E2D\u5B58\u50A8\u7684\u6570\u636E\u90FD\u53EF\u4EE5\u88AB\u7BE1\u6539\uFF0C\u5982\u679C\u6CA1\u6709\u91C7\u53D6\u9002\u5F53\u7684\u5B89\u5168\u63AA\u65BD\uFF0C\u4F1A\u9762\u4E34\u88AB\u653B\u51FB\u7684\u98CE\u9669\u3002\uFF08cookie \u662F\u660E\u6587\u4F20\u9012\uFF0Csession \u662F\u52A0\u5BC6\u540E\u7684\u51ED\u8BC1\uFF09</li><li>\u6269\u5C55\u6027\u95EE\u9898\uFF1A\u5982\u679C\u8981\u6269\u5C55\u7CFB\u7EDF\uFF0C\u9700\u8981\u8003\u8651\u5982\u4F55\u5904\u7406 cookie \u548C session \u7684\u6570\u636E\u5171\u4EAB\uFF0C\u5426\u5219\u53EF\u80FD\u4F1A\u5BFC\u81F4\u591A\u4E2A\u7CFB\u7EDF\u4E4B\u95F4\u72B6\u6001\u4E0D\u4E00\u81F4\u3002\uFF08\u5BF9\u4E8E\u6D4F\u89C8\u5668\u5916\u7684\u5176\u4ED6\u5BA2\u6237\u7AEF android\uFF0C\u5FC5\u987B\u624B\u52A8\u8BBE\u7F6E\uFF1B\u5BF9\u4E8E\u5206\u5E03\u5F0F\u7CFB\u7EDF\u548C\u670D\u52A1\u5668\u96C6\u7FA4\uFF0C\u6BD4\u8F83\u96BE\u4FDD\u8BC1\u5176\u4ED6\u7CFB\u7EDF\u53EF\u4EE5\u6B63\u786E\u89E3\u6790 session\uFF09</li><li>\u6027\u80FD\u95EE\u9898\uFF1Acookie \u548C session \u9700\u8981\u5360\u7528\u670D\u52A1\u5668\u548C\u5BA2\u6237\u7AEF\u7684\u5B58\u50A8\u7A7A\u95F4\u548C\u5E26\u5BBD\u8D44\u6E90\uFF0C\u5982\u679C\u6570\u636E\u91CF\u8FC7\u5927\u6216\u8005\u8BBF\u95EE\u91CF\u8FC7\u9AD8\uFF0C\u4F1A\u5BFC\u81F4\u6027\u80FD\u95EE\u9898\u3002\uFF08cookie \u4F1A\u88AB\u9644\u52A0\u5728\u6BCF\u4E2A Http \u8BF7\u6C42\u4E2D\uFF0C\u589E\u52A0\u4E86\u6D41\u91CF\uFF09</li><li>\u8DE8\u57DF\u95EE\u9898\uFF1A\u7531\u4E8E\u6D4F\u89C8\u5668\u7684\u540C\u6E90\u7B56\u7565\u9650\u5236\uFF0Ccookie \u548C session \u65E0\u6CD5\u8DE8\u57DF\u4F7F\u7528\uFF0C\u9700\u8981\u91C7\u7528\u5176\u4ED6\u65B9\u5F0F\u6765\u5B9E\u73B0\u4E0D\u540C\u57DF\u4E4B\u95F4\u7684\u6570\u636E\u5171\u4EAB\u3002</li><li>\u7A33\u5B9A\u6027\u95EE\u9898\uFF1A\u5982\u679C\u670D\u52A1\u5668\u51FA\u73B0\u6545\u969C\u6216\u8005\u91CD\u542F\uFF0C\u4F1A\u5BFC\u81F4 session \u6570\u636E\u7684\u4E22\u5931\uFF0C\u9700\u8981\u91C7\u7528\u5907\u4EFD\u548C\u6062\u590D\u673A\u5236\u6765\u4FDD\u8BC1\u7CFB\u7EDF\u7684\u7A33\u5B9A\u6027\u3002</li><li>Cookie \u7684\u5927\u5C0F\u9650\u5236\u662F 4kb\uFF0C\u5BF9\u4E8E\u590D\u6742\u7684\u9700\u6C42\u6765\u8BF4\u662F\u4E0D\u591F\u7684\u3002</li></ol><p><img src="https://secure2.wostatic.cn/static/oMASvrJVRixegKVShJKmAZ/image.png?auth_key=1690640716-trE3fRvzmzsvYJNHwxRHrY-0-a37474bf200ac20220c00fb3997b0510" alt=""></p><h2 id="token" tabindex="-1"><a class="header-anchor" href="#token" aria-hidden="true">#</a> Token</h2><p>Token \u7684\u4E09\u4E2A\u7EC4\u6210\u90E8\u5206</p><p>header \u548C payload \u90FD\u53EF\u4EE5\u88AB\u89E3\u5BC6\u51FA\u6765</p><p><img src="https://secure2.wostatic.cn/static/oZZ8XBRZ8yT4c8HFKpWkwZ/image.png?auth_key=1690640717-cXhtf2zXoeuT7neYYBDwfX-0-cb4528f54b47c246c9a76a826e7c3c14" alt=""></p><p><img src="https://secure2.wostatic.cn/static/w5H4SYxXoFNHrAcuGTFYG/image.png?auth_key=1690640717-9sH5pYvQpx2BJ3wav9BVFV-0-7458325d4053bb24a1db17230e6ee06e" alt=""></p><p><img src="https://secure2.wostatic.cn/static/svJitvdbLKBF2FMQHciXt7/image.png?auth_key=1690640717-pcGuv9GZmq8cBNDCQxqMr9-0-6d54a691be68cb4c3499b9d80f272dfb" alt=""></p><h2 id="\u5BF9\u79F0\u52A0\u5BC6" tabindex="-1"><a class="header-anchor" href="#\u5BF9\u79F0\u52A0\u5BC6" aria-hidden="true">#</a> \u5BF9\u79F0\u52A0\u5BC6</h2><p>\u52A0\u89E3\u5BC6\u7528\u7684\u540C\u4E00\u79CD\u7B97\u6CD5\uFF08HS256\uFF09\u65E2\u53EF\u4EE5\u53D1\u5E03\u4EE4\u724C\u4E5F\u53EF\u4EE5\u9A8C\u8BC1\u4EE4\u724C</p><p>\u5B89\u88C5\uFF1A<code>npm install jsonwebtoken</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;jsonwebtoken&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> secretKey <span class="token operator">=</span> <span class="token string">&quot;nevermore&quot;</span><span class="token punctuation">;</span>

userRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.\u9881\u53D1token</span>
  <span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;nevermore&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> secretKey<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">expiresIn</span><span class="token operator">:</span> <span class="token number">600</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    token<span class="token punctuation">,</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;\u767B\u5F55\u6210\u529F&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

userRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.\u83B7\u53D6\u5BA2\u6237\u7AEF\u643A\u5E26\u8FC7\u6765\u7684token</span>
  <span class="token comment">// \u4ECE\u8BF7\u6C42\u5934\u4E2D\u83B7\u53D6token</span>
  <span class="token keyword">const</span> authorization <span class="token operator">=</span> ctx<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization<span class="token punctuation">;</span>
  <span class="token comment">// \u6CE8\u610F\uFF1A\u8FD9\u91CC\u7684token\u662FBearer+\u7A7A\u683C+token</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> authorization<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;Bearer &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 2.\u9A8C\u8BC1token(\u89E3\u5BC6)</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;nevermore&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;ikun&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1010</span><span class="token punctuation">,</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;\u65E0\u6548\u7684token\u6216\u8005\u767B\u5F55\u8FC7\u671F&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u975E\u5BF9\u79F0\u52A0\u5BC6-rs256" tabindex="-1"><a class="header-anchor" href="#\u975E\u5BF9\u79F0\u52A0\u5BC6-rs256" aria-hidden="true">#</a> \u975E\u5BF9\u79F0\u52A0\u5BC6\uFF08RS256\uFF09</h2><p>\u53EF\u4EE5\u4F7F\u7528 openssl \u6765\u751F\u6210\u4E00\u5BF9\u79C1\u94A5\u548C\u516C\u94A5</p><ul><li><p>\u79C1\u94A5\uFF1Aprivate_key\uFF08\u7528\u4E8E\u53D1\u5E03\u4EE4\u724C\uFF09</p><p>\u64CD\u4F5C\uFF1A\u6253\u5F00 git.bash\u2192 \u8F93\u5165<code>openssl</code>\u2192 \u8F93\u5165<code>genrsa -out private.key 2048</code></p></li><li><p>\u516C\u94A5\uFF1Apublic_key\uFF08\u7528\u4E8E\u9A8C\u8BC1\u4EE4\u724C\uFF09</p><p>\u64CD\u4F5C\uFF08\u5229\u7528\u79C1\u94A5\u751F\u6210\uFF09\uFF1A\u8F93\u5165<code>rsa -in private.key -pubout -out public.key </code></p></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> KoaRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@koa/router&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;jsonwebtoken&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> userRouter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KoaRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">prefix</span><span class="token operator">:</span> <span class="token string">&quot;/users&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> privateKey <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">&quot;./keys/private.key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> publicKey <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">&quot;./keys/public.key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

userRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.\u9881\u53D1token(\u4F7F\u7528\u975E\u5BF9\u79F0\u52A0\u5BC6\u7B97\u6CD5RS256)</span>
  <span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;nevermore&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> privateKey<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">expiresIn</span><span class="token operator">:</span> <span class="token number">600</span><span class="token punctuation">,</span>
    <span class="token literal-property property">algorithm</span><span class="token operator">:</span> <span class="token string">&quot;RS256&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    token<span class="token punctuation">,</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;\u767B\u5F55\u6210\u529F&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

userRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.\u83B7\u53D6\u5BA2\u6237\u7AEF\u643A\u5E26\u8FC7\u6765\u7684token</span>
  <span class="token comment">// \u4ECE\u8BF7\u6C42\u5934\u4E2D\u83B7\u53D6token</span>
  <span class="token keyword">const</span> authorization <span class="token operator">=</span> ctx<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization<span class="token punctuation">;</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> authorization<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;Bearer &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 2.\u9A8C\u8BC1token(\u516C\u94A5\u89E3\u5BC6)</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> publicKey<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">algorithms</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;RS256&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;nevermore&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;ikun&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1010</span><span class="token punctuation">,</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;\u65E0\u6548\u7684token\u6216\u8005\u767B\u5F55\u8FC7\u671F&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>userRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>userRouter<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;koa\u670D\u52A1\u5668\u542F\u52A8\u6210\u529F&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="cookie-\u8BBE\u7F6E" tabindex="-1"><a class="header-anchor" href="#cookie-\u8BBE\u7F6E" aria-hidden="true">#</a> Cookie \u8BBE\u7F6E</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> userRouter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KoaRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">prefix</span><span class="token operator">:</span> <span class="token string">&quot;/users&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

userRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;slogan&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ikun&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">maxAge</span><span class="token operator">:</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token comment">// \u6709\u6548\u671F7\u5929</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&quot;\u767B\u5F55\u6210\u529F&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

userRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cookie <span class="token operator">=</span> ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;slogan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cookie <span class="token operator">===</span> <span class="token string">&quot;ikun&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&quot;\u7528\u6237\u4FE1\u606F&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&quot;\u8BF7\u767B\u5F55&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="session-\u8BBE\u7F6E" tabindex="-1"><a class="header-anchor" href="#session-\u8BBE\u7F6E" aria-hidden="true">#</a> Session \u8BBE\u7F6E</h2><p>\u5B89\u88C5\uFF1A<code>npm install koa-session</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> KoaRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@koa/router&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> KoaSession <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-session&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// cookie\u662F\u660E\u6587\u51ED\u8BC1\uFF0Csession\u662F\u52A0\u5BC6\u540E\u7684\u51ED\u8BC1</span>
<span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">KoaSession</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&quot;sessionid&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">signed</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// \u4E0D\u52A0\u5BC6</span>
    <span class="token literal-property property">maxAge</span><span class="token operator">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token literal-property property">httpOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// \u4E0D\u5141\u8BB8js\u83B7\u53D6cookie</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  app
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u52A0\u76D0\u64CD\u4F5C(\u4F1A\u751F\u6210\u4E24\u4E2Asessionid\u3001sessionid.sig-&gt;\u76D0)</span>
app<span class="token punctuation">.</span>keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;salt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;aaa&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u4F1A\u5C06session\u52A0\u5165\u5230ctx\u4E0A</span>

<span class="token keyword">const</span> userRouter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KoaRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">prefix</span><span class="token operator">:</span> <span class="token string">&quot;/users&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u6DFB\u52A0\u8DEF\u7531\u524D\u7F00</span>

userRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>slogan <span class="token operator">=</span> <span class="token string">&quot;ikun&quot;</span><span class="token punctuation">;</span>

  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&quot;\u767B\u5F55\u6210\u529F&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

userRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cookie <span class="token operator">=</span> ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>slogan<span class="token punctuation">;</span> <span class="token comment">// \u8FD9\u91CC\u4F1A\u901A\u8FC7\u7B97\u6CD5\u81EA\u52A8\u89E3\u6790sessionid\u3001sessionid.sig</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cookie <span class="token operator">===</span> <span class="token string">&quot;ikun&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&quot;\u7528\u6237\u4FE1\u606F&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&quot;\u8BF7\u767B\u5F55&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,22),e=[o];function c(i,l){return s(),a("div",null,e)}const k=n(p,[["render",c],["__file","node-other.html.vue"]]);export{k as default};
