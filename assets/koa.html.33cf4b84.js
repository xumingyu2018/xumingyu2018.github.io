import{_ as n}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as a,e as p}from"./app.e4226a9b.js";const t={},e=p(`<p>Express \u662F\u4E00\u4E2A\u8DEF\u7531\u548C\u4E2D\u95F4\u4EF6\u7684 Web \u6846\u67B6\uFF0C\u5B83\u672C\u8EAB\u529F\u80FD\u975E\u5E38\u5C11\u3002\u672C\u8D28\u662F\u4E00\u7CFB\u5217\u4E2D\u95F4\u4EF6\u51FD\u6570\u7684\u8C03\u7528\u3002</p><h2 id="\u4E2D\u95F4\u4EF6\u7684\u4F5C\u7528" tabindex="-1"><a class="header-anchor" href="#\u4E2D\u95F4\u4EF6\u7684\u4F5C\u7528" aria-hidden="true">#</a> \u4E2D\u95F4\u4EF6\u7684\u4F5C\u7528</h2><p>\u5728\u8BF7\u6C42\u548C\u54CD\u5E94\u4E4B\u95F4\u505A\u4E00\u4E9B\u4E8B\u60C5\u3002</p><ul><li>\u4E2D\u95F4\u4EF6\u53EF\u4EE5\u6267\u884C\u4EFB\u4F55\u4EE3\u7801\u3002</li><li>\u4E2D\u95F4\u4EF6\u53EF\u4EE5\u4FEE\u6539\u8BF7\u6C42\u548C\u54CD\u5E94\u5BF9\u8C61\u3002</li><li>\u53EF\u4EE5\u5728\u4E2D\u95F4\u4EF6\u4E2D\u7ED3\u675F\u54CD\u5E94\u5468\u671F\u3002</li><li>\u53EF\u4EE5\u8C03\u7528 next \u65B9\u6CD5\uFF0C\u5C06\u8BF7\u6C42\u8F6C\u4EA4\u7ED9\u4E0B\u4E00\u4E2A\u4E2D\u95F4\u4EF6\u3002</li></ul><h2 id="\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5" aria-hidden="true">#</a> \u5B89\u88C5</h2><p>\u811A\u624B\u67B6\uFF1A<code>npm install -g express-generator</code></p><p>\u521B\u5EFA\u9879\u76EE\uFF1A<code>express express-demo</code></p><h2 id="\u57FA\u672C\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#\u57FA\u672C\u7ED3\u6784" aria-hidden="true">#</a> \u57FA\u672C\u7ED3\u6784</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// \u521B\u5EFAapp\u5BF9\u8C61</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// \u7F16\u5199\u4E2D\u95F4\u4EF6</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;\u767B\u5F55\u6210\u529F\uFF01&#39;</span> <span class="token punctuation">,</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// \u53C2\u6570\u662Ferr\u7C7B\u578B</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// \u901A\u8FC7app.use()\u3001router.usr()\u65B9\u6CD5\u6216\u8005get\u3001post\u3001delete\u53EF\u4EE5\u7ED9app\u6CE8\u518C\u4EFB\u610F\u7C7B\u578B\u7684\u4E2D\u95F4\u4EF6</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;\u7B2C\u4E8C\u4E2A\u4E2D\u95F4\u4EF6\u6267\u884C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// \u542F\u52A8\u670D\u52A1\u5668</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">&#39;8000&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;express\u670D\u52A1\u5668\u542F\u52A8\u6210\u529F&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="api" tabindex="-1"><a class="header-anchor" href="#api" aria-hidden="true">#</a> Api</h2><p><code>app.use()</code>\uFF1A\u901A\u8FC7 use \u65B9\u6CD5\u6CE8\u518C\u4E2D\u95F4\u4EF6\u662F\u6700\u666E\u901A\u7684\u7684\u4E2D\u95F4\u4EF6\uFF0C\u65E0\u8BBA\u662F\u4EC0\u4E48\u8BF7\u6C42\u65B9\u5F0F\u90FD\u53EF\u4EE5\u5339\u914D\u4E0A\u3002</p><ul><li>\u5F62\u5F0F\uFF1A<code>app.use(&#39;/\u8DEF\u5F84&#39;, (req, res, next) =&gt;{})</code>\u8DEF\u5F84\u5339\u914D\u4E2D\u95F4\u4EF6\u4E0D\u4F1A\u5BF9\u8BF7\u6C42\u65B9\u5F0F\u8FDB\u884C\u9650\u5236\u3002</li></ul><p><code>app.get()/app.post()</code>\uFF1A\u8DEF\u5F84-\u65B9\u6CD5\u5339\u914D\u4E2D\u95F4\u4EF6\u4F1A\u5BF9\u8BF7\u6C42\u65B9\u5F0F\uFF08method\uFF09\u548C\u8DEF\u5F84\u8FDB\u884C\u9650\u5236\u3002</p><ul><li>\u5F62\u5F0F\uFF1A<code>app.get(&#39;/\u8DEF\u5F84&#39;\uFF0C\u4E2D\u95F4\u4EF61\uFF0C\u4E2D\u95F4\u4EF62\uFF0C\u4E2D\u95F4\u4EF63)</code>\uFF08\u5982\u5904\u7406\u53C2\u6570 1\uFF0C\u9A8C\u8BC1\u8EAB\u4EFD\uFF0C\u67E5\u8BE2\u6570\u636E\u5E93\uFF0C\u8FD4\u56DE\u6570\u636E\uFF09</li></ul><p><code>next()</code>\uFF1A\u5F53 express \u63A5\u6536\u5230\u5BA2\u6237\u7AEF\u53D1\u9001\u7684\u7F51\u7EDC\u8BF7\u6C42\u65F6\uFF0C\u5728\u6240\u6709\u4E2D\u95F4\u4EF6\u5F00\u59CB\u8FDB\u884C\u5339\u914D\uFF0C\u5F53\u5339\u914D\u5230\u7B2C\u4E00\u4E2A\u7B26\u5408\u8981\u6C42\u7684\u4E2D\u95F4\u4EF6\u65F6\uFF0C\u5C31\u4F1A\u6267\u884C\u8BE5\u4E2D\u95F4\u4EF6\uFF0C\u540E\u7EED\u7684\u4E2D\u95F4\u4EF6\u662F\u5426\u6267\u884C\u53D6\u51B3\u4E8E\u4E0A\u4E00\u4E2A\u4E2D\u95F4\u4EF6\u6709\u6CA1\u6709\u6267\u884C<code>next()</code>\u3002</p><ul><li>\u6CE8\u610F\uFF1A<code>next()</code>\u53C2\u6570\u53EA\u80FD\u4E3A err\u3002\uFF08\u4E0B\u9762\u6709\u9519\u8BEF\u4FE1\u606F\u5904\u7406\u6848\u4F8B\uFF01\uFF09</li></ul><p><code>res.end(string)</code>\uFF1A\u7ED3\u675F\u54CD\u5E94\u8FC7\u7A0B\u3002</p><p><code>res.json(string?, object?)</code>\uFF1A\u4EE5 json \u5F62\u5F0F\u8FD4\u56DE\u7ED9\u5BA2\u6237\u7AEF\u3002</p><ul><li>\u4F7F\u7528\uFF1A<code>res.json({ code:200, msg: &quot;\u54CD\u5E94\u6210\u529F&quot;, list: [{k1,v1}, {k2,v2}]})</code></li></ul><p><code>res:status(404)</code>\uFF1A\u8BBE\u7F6E\u54CD\u5E94\u72B6\u6001\u3002</p><h2 id="\u4F7F\u7528-express-\u81EA\u5E26\u4E2D\u95F4\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528-express-\u81EA\u5E26\u4E2D\u95F4\u4EF6" aria-hidden="true">#</a> \u4F7F\u7528 express \u81EA\u5E26\u4E2D\u95F4\u4EF6</h2><p><code>express.json()</code>\uFF1A\u89E3\u6790\u5BA2\u6237\u7AEF\u4F20\u9012\u8FC7\u6765\u7684 json \u6570\u636E\u3002</p><p><code>express.urlencoded({ extended: true })</code>\uFF1A\u89E3\u6790\u5BA2\u6237\u7AEF\u4F20\u9012\u8FC7\u6765\u7684 urlencoded \u6570\u636E\u3002</p><ul><li><code>{extended: true}</code>\uFF1A\u4E0D\u518D\u4F7F\u7528\u9ED8\u8BA4\u7684 querystring \u6A21\u5757\uFF0C\u800C\u662F\u4F7F\u7528\u7B2C\u4E09\u65B9\u6A21\u5757 qs \u6765\u89E3\u6790\u3002</li></ul><p><code>express.static(&#39;./build&#39;)</code>\uFF1A\u5C06\u6253\u5305\u540E\u7684\u6587\u4EF6\u5939\u4F5C\u4E3A\u9759\u6001\u8D44\u6E90\u3002</p><h2 id="\u4F7F\u7528\u7B2C\u4E09\u65B9\u4E2D\u95F4\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528\u7B2C\u4E09\u65B9\u4E2D\u95F4\u4EF6" aria-hidden="true">#</a> \u4F7F\u7528\u7B2C\u4E09\u65B9\u4E2D\u95F4\u4EF6</h2><h3 id="\u65E5\u5FD7\u8BB0\u5F55" tabindex="-1"><a class="header-anchor" href="#\u65E5\u5FD7\u8BB0\u5F55" aria-hidden="true">#</a> \u65E5\u5FD7\u8BB0\u5F55</h3><p><code>morgan</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> morgan <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;morgan&#39;</span><span class="token punctuation">)</span> <span class="token comment">// npm install morgan</span>

<span class="token comment">// \u5E94\u7528\u7B2C\u4E09\u65B9\u65E5\u5FD7\u4E2D\u95F4\u4EF6</span>
<span class="token keyword">const</span> writeStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">&#39;./logs/access.log&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">flags</span><span class="token operator">:</span> <span class="token string">&#39;a+&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">morgan</span><span class="token punctuation">(</span><span class="token string">&#39;combined&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">stream</span><span class="token operator">:</span> writeStream <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u89E3\u6790-formdata" tabindex="-1"><a class="header-anchor" href="#\u89E3\u6790-formdata" aria-hidden="true">#</a> \u89E3\u6790 formdata</h3><p><code>multer</code>\uFF08\u6587\u4EF6\u4E0A\u4F20\u4E5F\u9700\u8981\u6B64\u6A21\u5757\uFF09</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;multer&#39;</span><span class="token punctuation">)</span> <span class="token comment">// npm install multer</span>

<span class="token comment">// \u89E3\u6790\u5BA2\u6237\u7AEF\u4F20\u9012\u8FC7\u6765\u7684form-data\u8868\u5355\u6570\u636E</span>
<span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// app.use(formData.any())</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/avatar&#39;</span><span class="token punctuation">,</span> formData<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;\u6587formdata\u89E3\u6790\u6210\u529F!&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5904\u7406\u53C2\u6570\u89E3\u6790" tabindex="-1"><a class="header-anchor" href="#\u5904\u7406\u53C2\u6570\u89E3\u6790" aria-hidden="true">#</a> \u5904\u7406\u53C2\u6570\u89E3\u6790</h2><p><code>queryString</code>\u53C2\u6570\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/home/list&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> queryInfo <span class="token operator">=</span> req<span class="token punctuation">.</span>query
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>queryInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;data list \u6570\u636E&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>params</code>\u53C2\u6570\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/users/:id/:name&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//params\u91CC\u9762\u6709id\u3001name</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">\u83B7\u53D6\u5230</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\u7684\u6570\u636E</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u8DEF\u7531\u63A5\u53E3" tabindex="-1"><a class="header-anchor" href="#\u8DEF\u7531\u63A5\u53E3" aria-hidden="true">#</a> \u8DEF\u7531\u63A5\u53E3</h2><p>router \u5C42\uFF08\u7C7B\u4F3C\u4E8E Controller \u5C42\uFF0C\u4E13\u95E8\u7BA1\u7406\u63A5\u53E3\uFF09</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// router/userRouter.js</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// mini-app</span>
<span class="token comment">// 1.\u521B\u5EFA\u8DEF\u7531\u5BF9\u8C61</span>
<span class="token keyword">const</span> UserRouter <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 2.\u5B9A\u4E49\u8DEF\u7531\u5BF9\u8C61\u4E2D\u7684\u6620\u5C04</span>
UserRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string">&#39;\u83B7\u53D6\u7528\u6237\u5217\u8868&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
UserRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/:id&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string">&#39;\u83B7\u53D6\u67D0\u4E2A\u7528\u6237id\u4E3A&#39;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
UserRouter<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string">&#39;\u521B\u5EFA\u7528\u6237\u6210\u529F&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
UserRouter<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&#39;/:id&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string">&quot;\u5220\u9664\u7528\u6237\u6210\u529F&quot;</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 3.\u5C06\u8DEF\u7531\u5BFC\u51FA</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> UserRouter
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u4F7F\u7528</span>
<span class="token keyword">const</span> UserRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./router/userRouter&#39;</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&#39;/user&#39;</span><span class="token punctuation">,</span> UserRouter<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u4E2D\u95F4\u4EF6\u5339\u914D\u7EC3\u4E60" tabindex="-1"><a class="header-anchor" href="#\u4E2D\u95F4\u4EF6\u5339\u914D\u7EC3\u4E60" aria-hidden="true">#</a> \u4E2D\u95F4\u4EF6\u5339\u914D\u7EC3\u4E60</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u666E\u901A\u4E2D\u95F4\u4EF61&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u666E\u901A\u4E2D\u95F4\u4EF62&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/home&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;/home get \u4E2D\u95F4\u4EF61&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;/home get \u4E2D\u95F4\u4EF62&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;/login post \u4E2D\u95F4\u4EF6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u666E\u901A\u4E2D\u95F4\u4EF63&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u666E\u901A\u4E2D\u95F4\u4EF64&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">&#39;8000&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;express\u670D\u52A1\u5668\u542F\u52A8\u6210\u529F&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u767B\u5F55\u6848\u4F8B" tabindex="-1"><a class="header-anchor" href="#\u767B\u5F55\u6848\u4F8B" aria-hidden="true">#</a> \u767B\u5F55\u6848\u4F8B</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// \u5C06\u516C\u5171\u7684\u4EE3\u7801\u62BD\u53D6app.user\u4E2D</span>
<span class="token comment">// app.use((req, res, next) =&gt; {</span>
<span class="token comment">//   if(req.headers[&#39;content-type&#39;] === &#39;application/json&#39;) {</span>
<span class="token comment">//     req.on(&#39;data&#39;, (data) =&gt; {</span>
<span class="token comment">//       const jsonInfo = JSON.parse(data.toString())</span>
<span class="token comment">//       req.body = jsonInfo</span>
<span class="token comment">//     })</span>

<span class="token comment">//     req.on(&#39;end&#39;, () =&gt;{</span>
<span class="token comment">//       next()</span>
<span class="token comment">//     })</span>
<span class="token comment">//   } else {</span>
<span class="token comment">//     next()</span>
<span class="token comment">//   }</span>
<span class="token comment">// })</span>

<span class="token comment">// \u76F4\u63A5\u7528express\u63D0\u4F9B\u7684\u4E2D\u95F4\u4EF6\u4EE3\u66FF\u4E0A\u9762\u7684\u4EE3\u7801\uFF08\u89E3\u6790\u5BA2\u6237\u7AEF\u4F20\u9012\u8FC7\u6765\u7684json\uFF09</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// \u6848\u4F8B\u4E00\uFF1A\u7528\u6237\u767B\u5F55\u7684\u8BF7\u6C42\u5904\u7406\uFF1A/login =&gt; username/password</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;\u767B\u5F55\u6210\u529F&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// \u6848\u4F8B\u4E8C\uFF1A\u7528\u6237\u6CE8\u518C\u7684\u8BF7\u6C42\u5904\u7406\uFF1A/register =&gt; username/password</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/register&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;\u6CE8\u518C\u6210\u529F\uFF01&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">&#39;8000&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;express\u670D\u52A1\u5668\u542F\u52A8\u6210\u529F&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u6587\u4EF6\u4E0A\u4F20" tabindex="-1"><a class="header-anchor" href="#\u6587\u4EF6\u4E0A\u4F20" aria-hidden="true">#</a> \u6587\u4EF6\u4E0A\u4F20</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;multer&#39;</span><span class="token punctuation">)</span> <span class="token comment">// npm install multer</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> uploads <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// \u5355\u6587\u4EF6\u4E0A\u4F20\u5B58\u653E\u4F4D\u7F6E</span>
  <span class="token comment">// dest: &#39;./uploads&#39;</span>
  <span class="token literal-property property">storage</span><span class="token operator">:</span> multer<span class="token punctuation">.</span><span class="token function">diskStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// \u5B58\u653E\u4F4D\u7F6E</span>
    <span class="token function-variable function">destination</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&#39;./uploads&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">filename</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u81EA\u5B9A\u4E49\u540D\u79F0\u6DFB\u52A0\u540E\u7F00\u540D</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;-&#39;</span> <span class="token operator">+</span> file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// \u4E0A\u4F20\u5355\u6587\u4EF6\uFF1Asingle\u65B9\u6CD5</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/avatar&#39;</span><span class="token punctuation">,</span> uploads<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">&#39;avatar&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// req.file: \u4E0A\u4F20\u7684\u6587\u4EF6\u4FE1\u606F</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;\u5355\u6587\u4EF6\u4E0A\u4F20\u6210\u529F!&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// \u4E0A\u4F20\u591A\u6587\u4EF6\uFF1Aarray\u65B9\u6CD5</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/photos&#39;</span><span class="token punctuation">,</span> uploads<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token string">&#39;photos&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;\u591A\u6587\u4EF6\u4E0A\u4F20\u6210\u529F!&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">&#39;8000&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;express\u670D\u52A1\u5668\u542F\u52A8\u6210\u529F&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u9519\u8BEF\u4FE1\u606F\u5904\u7406" tabindex="-1"><a class="header-anchor" href="#\u9519\u8BEF\u4FE1\u606F\u5904\u7406" aria-hidden="true">#</a> \u9519\u8BEF\u4FE1\u606F\u5904\u7406</h2><p>\u901A\u8FC7<code>next(err)</code>\u4E2D\u7684<code>err</code>\u53C2\u6570\u5B9E\u73B0\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u62BD\u79BB\u9519\u8BEF\u4FE1\u606F</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.\u83B7\u53D6\u767B\u5F55\u4F20\u5165\u7684\u7528\u6237\u540D\u548C\u5BC6\u7801</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>username<span class="token punctuation">,</span> password<span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body

  <span class="token comment">// 2.\u5BF9\u7528\u6237\u540D\u548C\u5BC6\u7801\u8FDB\u884C\u5224\u65AD</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>username <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// next\u53C2\u6570\u53EA\u80FD\u4E3Aerr</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1001</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>username <span class="token operator">!==</span> <span class="token string">&#39;admin&#39;</span> <span class="token operator">||</span> password <span class="token operator">!==</span> <span class="token string">&#39;123&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1002</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;\u767B\u5F55\u6210\u529F\uFF01\uFF01&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">token</span><span class="token operator">:</span> <span class="token string">&#39;231321er54qer38&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// \u9519\u8BEF\u5904\u7406\u7684\u4E2D\u95F4\u4EF6</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">errCode<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>errCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> code <span class="token operator">=</span> errCode
  <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token string">&#39;\u672A\u77E5\u7684\u9519\u8BEF\u4FE1\u606F&#39;</span>

  <span class="token keyword">switch</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token operator">-</span><span class="token number">1001</span><span class="token operator">:</span>
      message <span class="token operator">=</span> <span class="token string">&quot;\u6CA1\u6709\u8F93\u5165\u7528\u6237\u540D\u6216\u5BC6\u7801&quot;</span>
      <span class="token keyword">break</span>
    <span class="token keyword">case</span> <span class="token operator">-</span><span class="token number">1002</span><span class="token operator">:</span>
      message <span class="token operator">=</span> <span class="token string">&quot;\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF&quot;</span>
      <span class="token keyword">break</span>
  <span class="token punctuation">}</span>

  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> code<span class="token punctuation">,</span> message <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u6E90\u7801" tabindex="-1"><a class="header-anchor" href="#\u6E90\u7801" aria-hidden="true">#</a> \u6E90\u7801</h2><p>\u5BFC\u5165\u7684<code>express</code> \u672C\u8D28\u4E0A\u662F <code>createApplication</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> createApplication<span class="token punctuation">;</span> <span class="token comment">// 28</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5C01\u88C5\u4E00\u4E2A\u53D8\u91CF\uFF0C\u53D8\u91CF\u662F\u4E00\u4E2A\u51FD\u6570\u5BF9\u8C61</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">app</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 39</span>
  app<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5BF9\u51FD\u6570\u5BF9\u8C61\u8FDB\u884C\u6DF7\u5165\uFF08\u6DF7\u5165 EventEmitter \u7684\u65B9\u6CD5\uFF1Aon\u3001emit\uFF09</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">mixin</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//44</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u6DF7\u5165\u7684\u662F use/listen \u65B9\u6CD5\u7B49</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">mixin</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> proto<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//46</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>proto\uFF08<code>var proto = require(&#39;./application&#39;)</code>\uFF09</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// app\u91CC\u9762\u52A0\u7684\u4E1C\u897F\u90FD\u4F1A\u653E\u5728{}\u5BF9\u8C61\u91CC\u9762</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">//45</span>
<span class="token comment">//....</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>listen \u65B9\u6CD5\uFF08\u672C\u8D28\u662F\u521B\u5EFA http\uFF09</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function-variable function">listen</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// this\u5C31\u662F\u5728\u6709\u7F51\u7EDC\u8BF7\u6C42\u7684\u65F6\u5019\u6267\u884C\u7684\u56DE\u8C03\u51FD\u6570</span>
  <span class="token comment">// this\u5C31\u662Fapp\uFF08this\u7684\u9690\u5F0F\u7ED1\u5B9A\uFF09=&gt; app\u662F\u4E2A\u51FD\u6570\uFF08express.js\u4E2D\u768439\u884C\uFF09</span>
  <span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>use \u65B9\u6CD5\u4F5C\u7528</p><ul><li>\u4F20\u5165\u4E09\u4E2A\u4E2D\u95F4\u4EF6</li><li>\u76EE\u7684\uFF1A\u5F53\u6709\u4E00\u4E2A\u7F51\u7EDC\u8BF7\u6C42\u7684\u65F6\u5019\uFF0C\u5339\u914D\u548C\u6267\u884C\u4E2D\u95F4\u4EF6</li><li>\u672C\u8D28\uFF1A <ul><li>\u5C06\u4F20\u5165\u7684\u4E09\u4E2A\u51FD\u6570\u4FDD\u5B58\u5728\u4E00\u4E2A\u6570\u7EC4\u4E2D\uFF08<code>fns = [fn1, fn2, fn3]</code>\uFF09</li><li>\u76D1\u542C\u7F51\u7EDC\u8BF7\u6C42\u7684 path/method \u53BB\u5339\u914D\u4E09\u4E2A\u51FD\u6570\u3002</li></ul></li></ul><p><img src="https://secure2.wostatic.cn/static/mPxX1Kt7zYRZGbfcNrGgVR/image.png?auth_key=1690640426-89Z73hDRPxJNzHdpFbA7QD-0-cbc30ddffc1693fad053db3815960c3f" alt=""></p><p>\uFF08<code>this.lazyrouter</code>\u662F\u9ED8\u8BA4\u8DEF\u7531\uFF09</p><p><img src="https://secure2.wostatic.cn/static/v5YpkCxvrMas4wewUm1iDX/image.png?auth_key=1690640426-jwtCoeLE3CN8MTNcBeUbsK-0-87d5cf56c20e3e604a492962845288b2" alt=""></p><p><img src="https://secure2.wostatic.cn/static/7zPv1CgHABPJWomCqm4aRt/image.png?auth_key=1690640426-oqTV2Y3UCUYkLmCXNaWJJ4-0-27e4bb8b040652ab04f85c3b24b1cadf" alt=""></p><ul><li>\u5F53\u53D1\u751F\u7F51\u7EDC\u8BF7\u6C42\u65F6\uFF0C\u4F1A\u8C03\u7528</li></ul><p><img src="https://secure2.wostatic.cn/static/dVFLiW6YPx5t7Fw8hpaBGQ/image.png?auth_key=1690640427-sSuTGHNgMQ9eCxFaXD8ihe-0-8a669ebc8a0f1c41a5cf7b7efde11bdd" alt=""></p><p><img src="https://secure2.wostatic.cn/static/56FLtZbzq13c7hej8mFfB4/image.png?auth_key=1690640426-ac3CGYcpedhjpyUqMukDGE-0-2643fe2f42472a2daa58b0ee6db4cf64" alt=""></p><p><img src="https://secure2.wostatic.cn/static/r3abCfQ6eDU4bapN43kSiE/image.png?auth_key=1690640427-qQGi3zdCNf1wWSZvFjbfmy-0-638ff1e6b9eec208f2ca5d23019cc47f" alt=""></p><p><img src="https://secure2.wostatic.cn/static/sUBq64ixukdMCA7ugErtC9/image.png?auth_key=1690640427-9UxiDQ4YKCmmhpL9UbJWx9-0-c9fe51611a64065652bb122a2661f4cd" alt=""></p><p><img src="https://secure2.wostatic.cn/static/jWbTB47KBDqe4aWoMvcXx4/image.png?auth_key=1690640427-gvTbGMo2TiwVNZDRDRFcY1-0-33fb87ac3de94c339bd43a3ee7e1e9de" alt=""></p><p><img src="https://secure2.wostatic.cn/static/duUkxTBed7V5Ls1e1Nfjam/image.png?auth_key=1690640428-ruoTWjdEkpzhzTudtKtt3s-0-dce12d35e64fccc4471ddc6fbe9698de" alt=""></p></li></ul>`,64),o=[e];function c(i,l){return s(),a("div",null,o)}const k=n(t,[["render",c],["__file","koa.html.vue"]]);export{k as default};
