import{_ as n}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as a,e as t}from"./app.fa9421e3.js";const p={},o=t(`<h2 id="\u6D4F\u89C8\u5668\u4E8B\u4EF6\u5FAA\u73AF" tabindex="-1"><a class="header-anchor" href="#\u6D4F\u89C8\u5668\u4E8B\u4EF6\u5FAA\u73AF" aria-hidden="true">#</a> \u6D4F\u89C8\u5668\u4E8B\u4EF6\u5FAA\u73AF</h2><p>JS \u662F\u5355\u7EBF\u7A0B\u7684\u3001\u975E\u963B\u585E\u7684\u3002\u901A\u8FC7\u4E8B\u4EF6\u5FAA\u73AF\u89E3\u51B3\u4E86\u5355\u7EBF\u7A0B\u4F1A\u963B\u585E\u7684\u95EE\u9898\u3002<strong>JS \u5B9E\u73B0\u5F02\u6B65\u7684\u6838\u5FC3\u5C31\u662F\u4E8B\u4EF6\u5FAA\u73AF</strong>\u3002\uFF08\u8FDB\u7A0B\u662F\u7EBF\u7A0B\u7684\u5BB9\u5668\u3002\u6BD4\u55BB\uFF1A\u64CD\u4F5C\u7CFB\u7EDF\u662F\u5DE5\u5382\uFF0C\u8FDB\u7A0B\u662F\u8F66\u95F4\uFF0C\u7EBF\u7A0B\u662F\u5DE5\u4EBA\uFF09</p><p>\u65E9\u671F\u7684 JS \u4F5C\u4E3A\u6D4F\u89C8\u5668\u811A\u672C\u8BED\u8A00\uFF0C\u4E3A\u4E86\u9632\u6B62 DOM \u6E32\u67D3\u51B2\u7A81\u7684\u95EE\u9898\u3001\u7B80\u5316\u7F16\u7A0B\uFF0C\u88AB\u8BBE\u8BA1\u4E3A\u5355\u7EBF\u7A0B\u8BED\u8A00\u3002</p><p>\u5982\u4ECA\uFF0C\u4E3A\u4E86\u5145\u5206\u53D1\u6325 CPU \u7684\u8BA1\u7B97\u80FD\u529B\uFF0CHTML5 \u63D0\u51FA Web Worker \u6807\u51C6\uFF0C\u5141\u8BB8 JS \u811A\u672C\u521B\u5EFA\u591A\u4E2A\u7EBF\u7A0B\uFF0C\u4F46\u662F\u5B50\u7EBF\u7A0B\u5B8C\u5168\u53D7\u4E3B\u7EBF\u7A0B\u63A7\u5236\uFF0C\u4E14\u4E0D\u5F97\u64CD\u4F5C DOM\uFF0C\u6240\u4EE5 Web Worker \u672C\u8D28\u4E0A\u4ECD\u662F\u901A\u8FC7\u5355\u7EBF\u7A0B\u6A21\u62DF\u591A\u7EBF\u7A0B\u3002</p><p>\u603B\u7ED3\uFF1A\u4F18\u70B9\u662F\u7B80\u5316\u7F16\u7A0B\uFF0C\u7F3A\u70B9\u662F\u65E0\u6CD5\u53D1\u6325 CPU \u7684\u5168\u90E8\u6027\u80FD\uFF08\u53EF\u4EE5\u4F7F\u7528 HTML5 \u65B0\u6807\u51C6 Web Worker\u5B9E\u73B0\u591A\u7EBF\u7A0B\uFF09</p><h3 id="\u5FAE\u4EFB\u52A1\u4E0E\u5B8F\u4EFB\u52A1\u5206\u7C7B" tabindex="-1"><a class="header-anchor" href="#\u5FAE\u4EFB\u52A1\u4E0E\u5B8F\u4EFB\u52A1\u5206\u7C7B" aria-hidden="true">#</a> \u5FAE\u4EFB\u52A1\u4E0E\u5B8F\u4EFB\u52A1\u5206\u7C7B</h3><p>\u6D4F\u89C8\u5668\u3001Node \u73AF\u5883\u4E0B\u7684\u5FAE\u4EFB\u52A1\u4E0E\u5B8F\u4EFB\u52A1\u5206\u7C7B\uFF1A</p><p>\u5FAE\u4EFB\u52A1\uFF08microTask\uFF09\uFF1A<code>promise then</code>\u3001<code>async/await</code>\u3001<code>MutationObserver</code>\uFF08H5 \u65B0\u7279\u6027\uFF09\u3001<code>queueMicrotask</code>\u3001<code>process.nextTick</code></p><p>\u5B8F\u4EFB\u52A1\uFF08macroTask\uFF09\uFF1A<code>main script</code>(\u4E3B\u7EBF\u7A0B\u4EE3\u7801)\u3001<code>setTimeout</code>\u3001<code>setInterval</code>\u3001<code>setImmediate</code>\u3001<code>requestAnimationFrame</code>\u3001<code>I/O</code>\u4E8B\u4EF6\u3001<code>DOM</code> \u76D1\u542C\u4E8B\u4EF6\u3001<code>AJAX</code> \u8BF7\u6C42\u3001<code>UI</code> \u9875\u9762\u6E32\u67D3</p><h3 id="\u6267\u884C\u987A\u5E8F" tabindex="-1"><a class="header-anchor" href="#\u6267\u884C\u987A\u5E8F" aria-hidden="true">#</a> \u6267\u884C\u987A\u5E8F</h3><ol><li>main script\u4E3B\u7EBF\u7A0B\u4EE3\u7801\u9996\u5148\u6267\u884C</li><li>\u6267\u884C\u5FAE\u4EFB\u52A1</li><li>DOM \u6E32\u67D3\uFF08\u82E5\u6709\u5219\u6E32\u67D3\uFF0C\u65E0\u5219\u8DF3\u8FC7\uFF09\uFF08\u5FAE\u4EFB\u52A1\u4F1A\u963B\u585E\u9875\u9762\u7684\u6E32\u67D3\uFF0C\u5B8F\u4EFB\u52A1\u4E0D\u4F1A\uFF09</li><li>\u6267\u884C\u5B8F\u4EFB\u52A1\uFF1A\u5728\u6B64\u4E4B\u524D\uFF0C\u5148\u67E5\u770B\u5FAE\u4EFB\u52A1\u961F\u5217\u662F\u5426\u4E3A\u7A7A\uFF0C\u4E0D\u4E3A\u7A7A\u5219\u7EE7\u7EED\u6267\u884C\u5FAE\u4EFB\u52A1\uFF08<strong>\u5148\u5FAE\u540E\u5B8F</strong>\uFF09\u5373\uFF1A\u82E5\u5FAE\u4EFB\u52A1\u5728\u6267\u884C\u8FC7\u7A0B\u4E2D\u4EA7\u751F\u4E86\u65B0\u7684\u5FAE\u4EFB\u52A1\uFF0C\u5219\u7EE7\u7EED\u6267\u884C\u5FAE\u4EFB\u52A1\uFF0C\u5FAE\u4EFB\u52A1\u6267\u884C\u5B8C\u6BD5\u540E\uFF0C\u518D\u56DE\u5230\u5B8F\u4EFB\u52A1\u4E2D\u8FDB\u884C\u4E0B\u4E00\u8F6E\u5FAE\u4EFB\u52A1\u961F\u5217\u3002</li></ol><p><img src="https://nevermore-picbed-1304219157.cos.ap-guangzhou.myqcloud.com/20220705015157.png" alt="\u6267\u884C\u987A\u5E8F"></p><h3 id="\u4F8B\u9898\u4E00" tabindex="-1"><a class="header-anchor" href="#\u4F8B\u9898\u4E00" aria-hidden="true">#</a> \u4F8B\u9898\u4E00</h3><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// \u5B8F1</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;3&#39;</span><span class="token punctuation">)</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;4&#39;</span><span class="token punctuation">)</span> <span class="token comment">// \u4EA7\u751F\u4E86\u65B0\u7684\u5FAE\u4EFB\u52A1\uFF0C\u653E\u5165\u7B2C\u4E8C\u8F6E\u5FAE\u4EFB\u52A1</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// \u7B2C\u4E00\u8F6E \u5FAE\u4EFB\u52A1</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;2&#39;</span><span class="token punctuation">)</span> <span class="token comment">// \u5148\u5FAE\u540E\u5B8F</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;5&#39;</span><span class="token punctuation">)</span> <span class="token comment">// \u5B8F2\uFF0C\u5728\u6267\u884C\u5B8F\u4EFB\u52A1\u524D\uFF0C\u5148\u67E5\u770B\u5FAE\u4EFB\u52A1\u961F\u5217\u662F\u5426\u4E3A\u7A7A\uFF0C\u4E0D\u4E3A\u7A7A\u5219\u7EE7\u7EED\u6267\u884C\u5FAE\u4EFB\u52A1</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="\u4F8B\u9898\u4E8C" tabindex="-1"><a class="header-anchor" href="#\u4F8B\u9898\u4E8C" aria-hidden="true">#</a> \u4F8B\u9898\u4E8C</h3><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;async1 start&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
  <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// \u540C\u6B65\u6267\u884C async2</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;async1 end&#39;</span><span class="token punctuation">)</span> <span class="token comment">// await \u7684\u4E0B\u8FB9\u4EE3\u7801\u8FDB\u5165\u5FAE\u4EFB\u52A1\u961F\u5217 \uFF08\u5FAE1\uFF09 6</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;async2&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;script start&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//\uFF08\u5B8F1\uFF09 8</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;setTimeout&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u521D\u59CB\u5316 Promise\uFF0C\u4F20\u5165\u7684\u51FD\u6570\u540C\u6B65\u6267\u884C</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;promise1&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 4</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \uFF08\u5FAE2\uFF09 7 \uFF08\u5FAE\u4EFB\u52A1\u6267\u884C\u5B8C\u6BD5\uFF0C\u63A5\u7740\u6267\u884C\u5B8F\u4EFB\u52A1\uFF09</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;promise2&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;script end&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 5 \uFF08\u540C\u6B65\u4EE3\u7801\u6267\u884C\u5B8C\u6BD5\uFF0C\u63A5\u7740\u6267\u884C\u5FAE\u4EFB\u52A1\uFF09</span>
</code></pre></div><p>await \u4E0E Promise \u7684\u7B49\u4EF7\u66FF\u6362\uFF1A</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;3&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;2&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u7B49\u4EF7\u4E8E</span>
<span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6267\u884C async2 \u7684\u8FD4\u56DE\u503C\u653E\u5165 resolve \u91CC</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;3&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u7D27\u8DDF\u7740 await \u540E\u9762\u7684\u8BED\u53E5\u76F8\u5F53\u4E8E\u653E\u5728\u4E86 new Promise \u4E2D</span>
<span class="token comment">// \u4E0B\u4E00\u884C\u53CA\u4E4B\u540E\u7684\u8BED\u53E5\u76F8\u5F53\u4E8E\u653E\u5728\u4E8E Promise.then \u4E2D</span>
</code></pre></div><h3 id="\u4F8B\u9898\u4E09" tabindex="-1"><a class="header-anchor" href="#\u4F8B\u9898\u4E09" aria-hidden="true">#</a> \u4F8B\u9898\u4E09</h3><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token comment">// \u6574\u4E2A setTimeout \u7684\u56DE\u8C03\u51FD\u6570\u653E\u5165\u5B8F\u4EFB\u52A1\u961F\u5217\uFF08\u5B8F1\uFF09\uFF0C\u5FAE\u4EFB\u52A1\u7ED3\u675F\u518D\u6267\u884C</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;setTimeout1&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 7</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5B8F1 \u5F15\u5165\u4E86\u65B0\u7684\u5FAE\u4EFB\u52A1\uFF0C\u653E\u5165\u7B2C\u4E8C\u8F6E\u7684\u5FAE\u4EFB\u52A1\u961F\u5217\u4E2D\uFF0C\u5148\u628A\u5FAE\u4EFB\u52A1\u961F\u5217\u6267\u884C\u5B8C\u540E\uFF0C\u518D\u6267\u884C\u5B8F2</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u653E\u5165\u7B2C\u4E09\u8F6E\u5FAE\u4EFB\u52A1\u961F\u5217\u4E2D</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;then4&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 9</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;then3&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 8 \u540C\u6B65\u6267\u884C</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;promise1&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;then1&#39;</span><span class="token punctuation">)</span> <span class="token comment">// \uFF08\u5FAE1\uFF094</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;setTimeout2&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 10</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// \uFF08\u5B8F2\uFF09</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>

<span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;queueMicrotask&#39;</span><span class="token punctuation">)</span> <span class="token comment">// \uFF08\u5FAE2\uFF095</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;promise2&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;then2&#39;</span><span class="token punctuation">)</span> <span class="token comment">// \uFF08\u5FAE3\uFF096 \uFF08\u7B2C\u4E00\u8F6E\u5FAE\u4EFB\u52A1\u6267\u884C\u5B8C\u6BD5\uFF0C\u6267\u884C\u5B8F1\uFF09</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// promise1</span>
<span class="token comment">// 2</span>
<span class="token comment">// promise2</span>
<span class="token comment">// then1</span>
<span class="token comment">// queueMicrotask</span>
<span class="token comment">// then2</span>
<span class="token comment">// setTimeout1</span>
<span class="token comment">// then3</span>
<span class="token comment">// then4</span>
<span class="token comment">// setTimeout2</span>
</code></pre></div><p>\u56FE\u89E3\uFF1A</p><p><img src="https://nevermore-picbed-1304219157.cos.ap-guangzhou.myqcloud.com/\u4E8B\u4EF6\u5FAA\u73AF\u4F8B\u9898.png" alt=""></p><h2 id="node-\u4E8B\u4EF6\u5FAA\u73AF" tabindex="-1"><a class="header-anchor" href="#node-\u4E8B\u4EF6\u5FAA\u73AF" aria-hidden="true">#</a> Node \u4E8B\u4EF6\u5FAA\u73AF</h2><p>Nodejs \u4E8B\u4EF6\u5FAA\u73AF\u673A\u5236\u5206\u4E3A 6 \u4E2A\u9636\u6BB5\uFF1A</p><ol><li>timers\uFF08\u5B9A\u65F6\u5668\u9636\u6BB5\uFF09\uFF1A\u6267\u884C <code>setTimeout</code>\u3001<code>setInterval</code> \u7684\u56DE\u8C03</li><li>pending callbacks\uFF08\u5F85\u5B9A\u56DE\u8C03\u9636\u6BB5\uFF09\uFF1A\u6267\u884C\u5EF6\u8FDF\u5230\u4E0B\u4E00\u4E2A\u5FAA\u73AF\u8FED\u4EE3\u7684 I/O \u56DE\u8C03\uFF08\u6267\u884C\u7CFB\u7EDF\u64CD\u4F5C\u7684\u56DE\u8C03\uFF09</li><li>idle, prepare\uFF08\u95F2\u7F6E\u9636\u6BB5\uFF09\uFF1A\u4EC5 Node \u5185\u90E8\u4F7F\u7528</li><li>poll\uFF08\u8F6E\u8BE2\u9636\u6BB5\uFF09\uFF1A\u68C0\u7D22\u65B0\u7684 I/O \u4E8B\u4EF6</li><li>check\uFF08\u68C0\u67E5\u9636\u6BB5\uFF09\uFF1A\u6267\u884C <code>setImmediate</code> \u7684\u56DE\u8C03</li><li>close callbacks\uFF08\u5173\u95ED\u4E8B\u4EF6\u56DE\u8C03\u9636\u6BB5\uFF09\uFF1A\u6267\u884C\u5173\u95ED\u4E8B\u4EF6\u7684\u56DE\u8C03\uFF0C\u5982 <code>socket.on(&#39;close&#39;, ...)</code></li></ol><p>\u91CD\u70B9\u9636\u6BB5\u4E3A\uFF1A</p><ol><li>timers\uFF1A\u6267\u884C <code>setTimeout</code>\u3001<code>setInterval</code> \u7684\u56DE\u8C03</li><li>poll\uFF1A\u5904\u7406\u8F6E\u8BE2\u961F\u5217\u7684\u4E8B\u4EF6\uFF0C\u5F53\u6709\u5DF2\u8D85\u65F6\u7684 timer\uFF0C\u6267\u884C\u5B83\u7684\u56DE\u8C03\u51FD\u6570\uFF08\u82E5\u6CA1\u6709\u5F02\u6B65\u4EFB\u52A1\uFF0C\u5219\u505C\u7559\u5728\u6B64\u9636\u6BB5\uFF09</li><li>check\uFF1A\u7ACB\u5373\u6267\u884C <code>setImmediate</code> \u7684\u56DE\u8C03</li></ol><h3 id="\u6267\u884C\u987A\u5E8F-1" tabindex="-1"><a class="header-anchor" href="#\u6267\u884C\u987A\u5E8F-1" aria-hidden="true">#</a> \u6267\u884C\u987A\u5E8F</h3><p>\u5FAE\u4EFB\u52A1\u961F\u5217\uFF1A</p><ul><li>next tick microtask queue\uFF1A<code>process.nextTick</code></li><li>other microtask queue\uFF1A<code>Promise then \u56DE\u8C03</code>\u3001<code>queueMicrotask</code></li></ul><p>\u5B8F\u4EFB\u52A1\u961F\u5217\uFF1A</p><ul><li>timer queue\uFF1A<code>setTimeout</code>\u3001<code>setInterval</code></li><li>poll queue\uFF1AI/O \u4E8B\u4EF6</li><li>check queue\uFF1A<code>setImmediate</code></li><li>close queue\uFF1Aclose \u4E8B\u4EF6</li></ul><p>\u5728\u6BCF\u4E00\u6B21\u4E8B\u4EF6\u5FAA\u73AF\u7684tick\u4E2D\uFF0C\u4EE3\u7801\u6267\u884C\u987A\u5E8F\uFF1A</p><ol><li>next tick microtask queue</li><li>other microtask queue</li><li>timer queue</li><li>poll queue</li><li>check queue</li><li>close queue</li></ol><h3 id="\u4F8B\u9898" tabindex="-1"><a class="header-anchor" href="#\u4F8B\u9898" aria-hidden="true">#</a> \u4F8B\u9898</h3><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;2&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;9&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;3&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;11&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;13&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>

<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;12&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;7&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;4&#39;</span><span class="token punctuation">)</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;5&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;10&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;6&#39;</span><span class="token punctuation">)</span>
</code></pre></div><p>\u56FE\u89E3\uFF1A</p><p><img src="https://nevermore-picbed-1304219157.cos.ap-guangzhou.myqcloud.com/node\u4E8B\u4EF6\u5FAA\u73AF\u4F8B\u9898.png" alt=""></p>`,38),c=[o];function e(u,l){return s(),a("div",null,c)}const r=n(p,[["render",e],["__file","eventLoop.html.vue"]]);export{r as default};
