<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.51" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://github.com/xumingyu2018/projects/vue/cms.html"><meta property="og:site_name" content="Nevermore毓 的学习笔记"><meta property="og:title" content="后台管理项目"><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-08-22T15:12:26.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="前端项目"><meta property="article:tag" content="Vue项目"><meta property="article:modified_time" content="2023-08-22T15:12:26.000Z"><link rel="icon" href="/favicon.svg"><title>后台管理项目 | Nevermore毓 的学习笔记</title><meta name="description" content="">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.b2b1ec9b.css">
    <link rel="modulepreload" href="/assets/app.8c0e81d7.js"><link rel="modulepreload" href="/assets/cms.html.6acf1298.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/cms.html.4d75d971.js"><link rel="prefetch" href="/assets/index.html.9dde4bd2.js"><link rel="prefetch" href="/assets/about.html.5a0f50be.js"><link rel="prefetch" href="/assets/Java-basic.html.0164d0b8.js"><link rel="prefetch" href="/assets/Java-collection.html.309cb236.js"><link rel="prefetch" href="/assets/Java-thread.html.cbc6a6e0.js"><link rel="prefetch" href="/assets/Java8-new-features.html.66204cc9.js"><link rel="prefetch" href="/assets/photoSql.html.7d37c784.js"><link rel="prefetch" href="/assets/mysql.html.a945b3c3.js"><link rel="prefetch" href="/assets/vite.html.5030f75a.js"><link rel="prefetch" href="/assets/webpack.html.5f12a7c6.js"><link rel="prefetch" href="/assets/OOP.html.395cce12.js"><link rel="prefetch" href="/assets/index.html.a8391e16.js"><link rel="prefetch" href="/assets/arrow-function.html.0138f0ab.js"><link rel="prefetch" href="/assets/async-await.html.9cafbd5f.js"><link rel="prefetch" href="/assets/closure.html.c64e056c.js"><link rel="prefetch" href="/assets/deepClone.html.89a81437.js"><link rel="prefetch" href="/assets/es6.html.3f714dc6.js"><link rel="prefetch" href="/assets/eventLoop.html.260b5440.js"><link rel="prefetch" href="/assets/executing-principle.html.86e74f70.js"><link rel="prefetch" href="/assets/executing-process.html.4459ddee.js"><link rel="prefetch" href="/assets/extend.html.af8d544d.js"><link rel="prefetch" href="/assets/functional-programming.html.717ff7df.js"><link rel="prefetch" href="/assets/intro.html.7565a10e.js"><link rel="prefetch" href="/assets/iterator-generator.html.b1c6950f.js"><link rel="prefetch" href="/assets/promise-implement.html.fceadaf6.js"><link rel="prefetch" href="/assets/promise.html.09ba9755.js"><link rel="prefetch" href="/assets/prototype.html.68ccaf7b.js"><link rel="prefetch" href="/assets/this.html.210b88d8.js"><link rel="prefetch" href="/assets/with-eval-strict.html.2441d651.js"><link rel="prefetch" href="/assets/express.html.bc7f1238.js"><link rel="prefetch" href="/assets/koa.html.a8ee489d.js"><link rel="prefetch" href="/assets/node-basic.html.961273b0.js"><link rel="prefetch" href="/assets/node-other.html.151eccdc.js"><link rel="prefetch" href="/assets/node-sql.html.eb28900f.js"><link rel="prefetch" href="/assets/index.html.3cb4aa07.js"><link rel="prefetch" href="/assets/class.html.7d1cf5d5.js"><link rel="prefetch" href="/assets/dataType.html.d30ede64.js"><link rel="prefetch" href="/assets/demo.html.b41c6ca5.js"><link rel="prefetch" href="/assets/function.html.fb71326b.js"><link rel="prefetch" href="/assets/generics.html.0a578b34.js"><link rel="prefetch" href="/assets/interface.html.ca442670.js"><link rel="prefetch" href="/assets/variable.html.edbcdd6e.js"><link rel="prefetch" href="/assets/index.html.8696e0b0.js"><link rel="prefetch" href="/assets/TabBar-demo.html.0844564d.js"><link rel="prefetch" href="/assets/componentized.html.544a354a.js"><link rel="prefetch" href="/assets/pinia.html.409c254b.js"><link rel="prefetch" href="/assets/slot.html.2d679c77.js"><link rel="prefetch" href="/assets/vue-cli.html.a2a31bf5.js"><link rel="prefetch" href="/assets/vue-router.html.c879ebec.js"><link rel="prefetch" href="/assets/vue2-advanced.html.a8389b87.js"><link rel="prefetch" href="/assets/vue2-basic.html.1f35d7e9.js"><link rel="prefetch" href="/assets/vue3-basic.html.a7687cf4.js"><link rel="prefetch" href="/assets/vuex.html.f997a7b5.js"><link rel="prefetch" href="/assets/index.html.f81ebb3d.js"><link rel="prefetch" href="/assets/gulimall-demo.html.c39bdc23.js"><link rel="prefetch" href="/assets/nowcoder.html.45bed2ff.js"><link rel="prefetch" href="/assets/coderhub.html.d17adb3b.js"><link rel="prefetch" href="/assets/trip-site.html.dedffa11.js"><link rel="prefetch" href="/assets/browser-render.html.69c4a6eb.js"><link rel="prefetch" href="/assets/BFC.html.039ce767.js"><link rel="prefetch" href="/assets/align-center.html.60458cdc.js"><link rel="prefetch" href="/assets/basic.html.ad03494e.js"><link rel="prefetch" href="/assets/box.html.061f50fb.js"><link rel="prefetch" href="/assets/css-priority.html.66dfebf5.js"><link rel="prefetch" href="/assets/css-triangle.html.782d5ac5.js"><link rel="prefetch" href="/assets/flex.html.3199230b.js"><link rel="prefetch" href="/assets/intro.html.720112a2.js"><link rel="prefetch" href="/assets/less.html.c1145826.js"><link rel="prefetch" href="/assets/responsive.html.b4ac3faf.js"><link rel="prefetch" href="/assets/html5.html.637e9c1a.js"><link rel="prefetch" href="/assets/intro.html.d66b0f0d.js"><link rel="prefetch" href="/assets/tag.html.e8c082ed.js"><link rel="prefetch" href="/assets/cookie-session.html.5be16140.js"><link rel="prefetch" href="/assets/http-cache.html.8f0da6eb.js"><link rel="prefetch" href="/assets/http.html.f150f8e8.js"><link rel="prefetch" href="/assets/same-origin-policy.html.97090126.js"><link rel="prefetch" href="/assets/tcp.html.e16cf5f7.js"><link rel="prefetch" href="/assets/404.html.ecbcb5e7.js"><link rel="prefetch" href="/assets/index.html.6d697fae.js"><link rel="prefetch" href="/assets/index.html.36893461.js"><link rel="prefetch" href="/assets/index.html.4cc6530c.js"><link rel="prefetch" href="/assets/index.html.7062aee5.js"><link rel="prefetch" href="/assets/index.html.bd64629d.js"><link rel="prefetch" href="/assets/index.html.a8054ecf.js"><link rel="prefetch" href="/assets/index.html.58c2d96e.js"><link rel="prefetch" href="/assets/index.html.1a4f3a30.js"><link rel="prefetch" href="/assets/index.html.0eb7bc03.js"><link rel="prefetch" href="/assets/index.html.916b1fb1.js"><link rel="prefetch" href="/assets/index.html.69ad796c.js"><link rel="prefetch" href="/assets/index.html.822e2c3b.js"><link rel="prefetch" href="/assets/index.html.98d4bbf1.js"><link rel="prefetch" href="/assets/index.html.f93d2dfa.js"><link rel="prefetch" href="/assets/index.html.3c380501.js"><link rel="prefetch" href="/assets/index.html.e8cda796.js"><link rel="prefetch" href="/assets/index.html.cd08bdd6.js"><link rel="prefetch" href="/assets/index.html.a04d4857.js"><link rel="prefetch" href="/assets/index.html.138680c2.js"><link rel="prefetch" href="/assets/index.html.a01b29dd.js"><link rel="prefetch" href="/assets/index.html.1c91f667.js"><link rel="prefetch" href="/assets/index.html.82944efe.js"><link rel="prefetch" href="/assets/index.html.5abe7a12.js"><link rel="prefetch" href="/assets/index.html.9e4878f3.js"><link rel="prefetch" href="/assets/index.html.50513093.js"><link rel="prefetch" href="/assets/index.html.8025e42b.js"><link rel="prefetch" href="/assets/index.html.6be6938b.js"><link rel="prefetch" href="/assets/index.html.046fde74.js"><link rel="prefetch" href="/assets/index.html.edbba14a.js"><link rel="prefetch" href="/assets/index.html.e0b0475d.js"><link rel="prefetch" href="/assets/index.html.c8934920.js"><link rel="prefetch" href="/assets/about.html.301f6e7f.js"><link rel="prefetch" href="/assets/Java-basic.html.870a6e79.js"><link rel="prefetch" href="/assets/Java-collection.html.da7cb481.js"><link rel="prefetch" href="/assets/Java-thread.html.370151d5.js"><link rel="prefetch" href="/assets/Java8-new-features.html.6482e1bc.js"><link rel="prefetch" href="/assets/photoSql.html.fade0ae6.js"><link rel="prefetch" href="/assets/mysql.html.c04de8f4.js"><link rel="prefetch" href="/assets/vite.html.ace14501.js"><link rel="prefetch" href="/assets/webpack.html.ac033bb0.js"><link rel="prefetch" href="/assets/OOP.html.d688d356.js"><link rel="prefetch" href="/assets/index.html.4455612d.js"><link rel="prefetch" href="/assets/arrow-function.html.a6e19609.js"><link rel="prefetch" href="/assets/async-await.html.318ec109.js"><link rel="prefetch" href="/assets/closure.html.55eab928.js"><link rel="prefetch" href="/assets/deepClone.html.13dacc25.js"><link rel="prefetch" href="/assets/es6.html.ff3ac647.js"><link rel="prefetch" href="/assets/eventLoop.html.25512de0.js"><link rel="prefetch" href="/assets/executing-principle.html.0f474f9f.js"><link rel="prefetch" href="/assets/executing-process.html.91b0de49.js"><link rel="prefetch" href="/assets/extend.html.1a0697aa.js"><link rel="prefetch" href="/assets/functional-programming.html.ddcebc2c.js"><link rel="prefetch" href="/assets/intro.html.9a7c5bda.js"><link rel="prefetch" href="/assets/iterator-generator.html.4bec3c37.js"><link rel="prefetch" href="/assets/promise-implement.html.b61fc15c.js"><link rel="prefetch" href="/assets/promise.html.874422f2.js"><link rel="prefetch" href="/assets/prototype.html.37160d13.js"><link rel="prefetch" href="/assets/this.html.f4611507.js"><link rel="prefetch" href="/assets/with-eval-strict.html.4d8f2e30.js"><link rel="prefetch" href="/assets/express.html.017de4dd.js"><link rel="prefetch" href="/assets/koa.html.40d7d862.js"><link rel="prefetch" href="/assets/node-basic.html.5f6461e1.js"><link rel="prefetch" href="/assets/node-other.html.d5b691c9.js"><link rel="prefetch" href="/assets/node-sql.html.a8d19a2d.js"><link rel="prefetch" href="/assets/index.html.25fe28d2.js"><link rel="prefetch" href="/assets/class.html.332caac3.js"><link rel="prefetch" href="/assets/dataType.html.69eaa265.js"><link rel="prefetch" href="/assets/demo.html.88893bbf.js"><link rel="prefetch" href="/assets/function.html.08135e98.js"><link rel="prefetch" href="/assets/generics.html.e809c679.js"><link rel="prefetch" href="/assets/interface.html.cfd387c1.js"><link rel="prefetch" href="/assets/variable.html.9e840687.js"><link rel="prefetch" href="/assets/index.html.bb4651b2.js"><link rel="prefetch" href="/assets/TabBar-demo.html.eaf4697b.js"><link rel="prefetch" href="/assets/componentized.html.4b717a09.js"><link rel="prefetch" href="/assets/pinia.html.a215a38e.js"><link rel="prefetch" href="/assets/slot.html.bca0129e.js"><link rel="prefetch" href="/assets/vue-cli.html.c315d057.js"><link rel="prefetch" href="/assets/vue-router.html.e6f0e53b.js"><link rel="prefetch" href="/assets/vue2-advanced.html.563ad2be.js"><link rel="prefetch" href="/assets/vue2-basic.html.843dc44e.js"><link rel="prefetch" href="/assets/vue3-basic.html.aa5d3065.js"><link rel="prefetch" href="/assets/vuex.html.f36199a3.js"><link rel="prefetch" href="/assets/index.html.ee6948ad.js"><link rel="prefetch" href="/assets/gulimall-demo.html.3ac3b14d.js"><link rel="prefetch" href="/assets/nowcoder.html.93cbd450.js"><link rel="prefetch" href="/assets/coderhub.html.b24132ea.js"><link rel="prefetch" href="/assets/trip-site.html.bf9db1c3.js"><link rel="prefetch" href="/assets/browser-render.html.85cd5970.js"><link rel="prefetch" href="/assets/BFC.html.e677ffaa.js"><link rel="prefetch" href="/assets/align-center.html.214f15f1.js"><link rel="prefetch" href="/assets/basic.html.4d4fe7fa.js"><link rel="prefetch" href="/assets/box.html.52aef087.js"><link rel="prefetch" href="/assets/css-priority.html.3ed419de.js"><link rel="prefetch" href="/assets/css-triangle.html.180c4b41.js"><link rel="prefetch" href="/assets/flex.html.90d4e62e.js"><link rel="prefetch" href="/assets/intro.html.a61d5264.js"><link rel="prefetch" href="/assets/less.html.fd62915c.js"><link rel="prefetch" href="/assets/responsive.html.4f4d0a5f.js"><link rel="prefetch" href="/assets/html5.html.1fa654dd.js"><link rel="prefetch" href="/assets/intro.html.4b646c4e.js"><link rel="prefetch" href="/assets/tag.html.cc1ab65e.js"><link rel="prefetch" href="/assets/cookie-session.html.272dacd3.js"><link rel="prefetch" href="/assets/http-cache.html.0fa21a07.js"><link rel="prefetch" href="/assets/http.html.2dd8c15e.js"><link rel="prefetch" href="/assets/same-origin-policy.html.9a7a091f.js"><link rel="prefetch" href="/assets/tcp.html.449eb68e.js"><link rel="prefetch" href="/assets/404.html.a5a1c351.js"><link rel="prefetch" href="/assets/index.html.271482bf.js"><link rel="prefetch" href="/assets/index.html.6dd2c7dd.js"><link rel="prefetch" href="/assets/index.html.506c8bec.js"><link rel="prefetch" href="/assets/index.html.5a2430ec.js"><link rel="prefetch" href="/assets/index.html.328fe220.js"><link rel="prefetch" href="/assets/index.html.d09d3328.js"><link rel="prefetch" href="/assets/index.html.7a50f152.js"><link rel="prefetch" href="/assets/index.html.416c9ed4.js"><link rel="prefetch" href="/assets/index.html.e51d2ea6.js"><link rel="prefetch" href="/assets/index.html.f96b348a.js"><link rel="prefetch" href="/assets/index.html.8a9326e5.js"><link rel="prefetch" href="/assets/index.html.e6dd3b46.js"><link rel="prefetch" href="/assets/index.html.2acf6a77.js"><link rel="prefetch" href="/assets/index.html.92031ea7.js"><link rel="prefetch" href="/assets/index.html.2db527e4.js"><link rel="prefetch" href="/assets/index.html.67fdafa0.js"><link rel="prefetch" href="/assets/index.html.9ec9b51b.js"><link rel="prefetch" href="/assets/index.html.6a77b65b.js"><link rel="prefetch" href="/assets/index.html.c7bd63b7.js"><link rel="prefetch" href="/assets/index.html.4d191c5a.js"><link rel="prefetch" href="/assets/index.html.ec7e38ef.js"><link rel="prefetch" href="/assets/index.html.e1eef949.js"><link rel="prefetch" href="/assets/index.html.e11b427a.js"><link rel="prefetch" href="/assets/index.html.24358f2c.js"><link rel="prefetch" href="/assets/index.html.fa1570ac.js"><link rel="prefetch" href="/assets/index.html.75fe2a2d.js"><link rel="prefetch" href="/assets/index.html.2fafefdc.js"><link rel="prefetch" href="/assets/index.html.af74342c.js"><link rel="prefetch" href="/assets/index.html.f6294095.js"><link rel="prefetch" href="/assets/index.html.fa42bcdb.js"><link rel="prefetch" href="/assets/giscus.15440425.js"><link rel="prefetch" href="/assets/highlight.esm.d982e650.js"><link rel="prefetch" href="/assets/markdown.esm.832a189d.js"><link rel="prefetch" href="/assets/math.esm.a3f84b6f.js"><link rel="prefetch" href="/assets/notes.esm.3c361cb7.js"><link rel="prefetch" href="/assets/reveal.esm.b96f05d8.js"><link rel="prefetch" href="/assets/search.esm.80da4a02.js"><link rel="prefetch" href="/assets/zoom.esm.8514a202.js"><link rel="prefetch" href="/assets/photoswipe.esm.382b1873.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container no-sidebar has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><img class="logo" src="/favicon.svg" alt="Nevermore毓 的学习笔记"><!----><span class="site-name hide-in-pad">Nevermore毓 的学习笔记</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="主页"><span class="icon iconfont icon-home"></span>主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/back-end/Java-basic.html" class="nav-link" aria-label="后端开发"><span class="icon iconfont icon-note"></span>后端开发<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="前端开发"><span class="title"><span class="icon iconfont icon-flow"></span>前端开发</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/front-end/webpage/html/intro.html" class="nav-link" aria-label="网页"><span class="icon iconfont icon-html"></span>网页<!----></a></li><li class="dropdown-item"><a href="/front-end/javascript/intro.html" class="nav-link" aria-label="JavaScript"><span class="icon iconfont icon-javascript"></span>JavaScript<!----></a></li><li class="dropdown-item"><a href="/front-end/typescript/demo.html" class="nav-link" aria-label="TypeScript"><span class="icon iconfont icon-typescript"></span>TypeScript<!----></a></li><li class="dropdown-item"><a href="/front-end/node/node-basic.html" class="nav-link" aria-label="Node"><span class="icon iconfont icon-javascript"></span>Node<!----></a></li><li class="dropdown-item"><a href="/front-end/vue/vue2-basic.html" class="nav-link" aria-label="Vue"><span class="icon iconfont icon-vue"></span>Vue<!----></a></li><li class="dropdown-item"><a href="/front-end/builder/webpack.html" class="nav-link" aria-label="构建工具"><span class="icon iconfont icon-build"></span>构建工具<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="项目源码"><span class="title"><span class="icon iconfont icon-proposal"></span>项目源码</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Java项目</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/projects/java/nowcoder.html" class="nav-link" aria-label="仿牛客网项目"><span class="icon iconfont icon-java"></span>仿牛客网项目<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Vue项目</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/projects/vue/trip-site.html" class="nav-link" aria-label="移动端旅游项目"><span class="icon iconfont icon-vue"></span>移动端旅游项目<!----></a></li><li class="dropdown-subitem"><a aria-current="page" href="/projects/vue/cms.html" class="router-link-active router-link-exact-active nav-link active" aria-label="后台管理项目"><span class="icon iconfont icon-vue"></span>后台管理项目<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Node项目</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/projects/node/coderhub.html" class="nav-link" aria-label="coderhub项目"><span class="icon iconfont icon-javascript"></span>coderhub项目<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="项目资源"><span class="title"><span class="icon iconfont icon-proposal"></span>项目资源</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/sql/photoSql.html" class="nav-link" aria-label="摄影约拍sql"><span class="icon iconfont icon-edit"></span>摄影约拍sql<!----></a></li></ul></button></div></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/xumingyu2018/xumingyu2018.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="icon iconfont icon-edit"></span>后台管理项目</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down" localizeddate="2023年8月22日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://github.com/xumingyu2018" target="_blank" rel="noopener noreferrer">Nevermore毓</a></span><span property="author" content="Nevermore毓"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2023年8月22日</span><meta property="datePublished" content="2023-08-22T15:12:26.000Z"></span><span class="category-info" aria-label="分类🌈" data-balloon-pos="down" localizeddate="2023年8月22日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li class="category category2 clickable" role="navigation">Vue</li><meta property="articleSection" content="Vue"></ul></span><span aria-label="标签🏷" data-balloon-pos="down" localizeddate="2023年8月22日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li class="tag tag7 clickable" role="navigation">前端项目</li><li class="tag tag7 clickable" role="navigation">Vue项目</li></ul><meta property="keywords" content="前端项目,Vue项目"></span><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down" localizeddate="2023年8月22日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 74 分钟</span><meta property="timeRequired" content="PT74M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#项目初始化" class="router-link-active router-link-exact-active toc-link level2">项目初始化</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#按需引入-element-plus" class="router-link-active router-link-exact-active toc-link level2">按需引入 Element-Plus</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现登录页面" class="router-link-active router-link-exact-active toc-link level2">实现登录页面</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#设置-app-宽高铺满屏幕" class="router-link-active router-link-exact-active toc-link level3">设置 App 宽高铺满屏幕</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#搭建后台管理帐号登录页面" class="router-link-active router-link-exact-active toc-link level3">搭建后台管理帐号登录页面</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现点击登录按钮逻辑" class="router-link-active router-link-exact-active toc-link level3">实现点击登录按钮逻辑</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现记住密码" class="router-link-active router-link-exact-active toc-link level3">实现记住密码</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现获取登录用户详细信息-包括角色权限菜单" class="router-link-active router-link-exact-active toc-link level3">实现获取登录用户详细信息（包括角色权限菜单）</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现主页左侧导航栏" class="router-link-active router-link-exact-active toc-link level2">实现主页左侧导航栏</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#整体容器布局" class="router-link-active router-link-exact-active toc-link level3">整体容器布局</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现左侧导航栏静态布局" class="router-link-active router-link-exact-active toc-link level3">实现左侧导航栏静态布局</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现左侧导航栏动态展示效果" class="router-link-active router-link-exact-active toc-link level3">实现左侧导航栏动态展示效果</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#导航栏图标的动态组件-细节处理" class="router-link-active router-link-exact-active toc-link level3">导航栏图标的动态组件（细节处理）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#导航栏注册所有静态路由-有缺陷" class="router-link-active router-link-exact-active toc-link level3">导航栏注册所有静态路由（有缺陷）</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现主页头部面包屑" class="router-link-active router-link-exact-active toc-link level2">实现主页头部面包屑</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#搭建整体布局" class="router-link-active router-link-exact-active toc-link level3">搭建整体布局</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现头部左侧图标点击折叠功能" class="router-link-active router-link-exact-active toc-link level3">实现头部左侧图标点击折叠功能</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现头部右侧个人信息功能" class="router-link-active router-link-exact-active toc-link level3">实现头部右侧个人信息功能</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#动态路由" class="router-link-active router-link-exact-active toc-link level2">动态路由</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#安装自动化生成路由配置信息和-vue-页面的工具" class="router-link-active router-link-exact-active toc-link level3">安装自动化生成路由配置信息和 vue 页面的工具</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#使用-coderwhy-工具" class="router-link-active router-link-exact-active toc-link level3">使用 coderwhy 工具</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#编写菜单映射路由工具类" class="router-link-active router-link-exact-active toc-link level3">编写菜单映射路由工具类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#有弊端-登录时调用工具类" class="router-link-active router-link-exact-active toc-link level3">(有弊端)登录时调用工具类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#改进-使用全局加载数据方法" class="router-link-active router-link-exact-active toc-link level3">(改进)使用全局加载数据方法</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#进入主页时匹配第一个菜单" class="router-link-active router-link-exact-active toc-link level3">进入主页时匹配第一个菜单</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#刷新页面时-菜单默认值问题" class="router-link-active router-link-exact-active toc-link level3">刷新页面时，菜单默认值问题</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现面包屑功能" class="router-link-active router-link-exact-active toc-link level2">实现面包屑功能</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#搭建面包屑页面" class="router-link-active router-link-exact-active toc-link level3">搭建面包屑页面</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#路由映射面包屑工具类" class="router-link-active router-link-exact-active toc-link level3">路由映射面包屑工具类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#解决点击面包屑跳到目录下的第一个子目录问题" class="router-link-active router-link-exact-active toc-link level3">解决点击面包屑跳到目录下的第一个子目录问题</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现主页中部-main-页面" class="router-link-active router-link-exact-active toc-link level2">实现主页中部 main 页面</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现-search-表单搜索框界面" class="router-link-active router-link-exact-active toc-link level3">实现 search 表单搜索框界面</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现展示用户列表功能" class="router-link-active router-link-exact-active toc-link level3">实现展示用户列表功能</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现分页功能" class="router-link-active router-link-exact-active toc-link level3">实现分页功能</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现查询用户功能" class="router-link-active router-link-exact-active toc-link level3">实现查询用户功能</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现删除用户功能" class="router-link-active router-link-exact-active toc-link level3">实现删除用户功能</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现新增用户功能" class="router-link-active router-link-exact-active toc-link level3">实现新增用户功能</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现编辑用户功能" class="router-link-active router-link-exact-active toc-link level3">实现编辑用户功能</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#高级复用性代码抽取" class="router-link-active router-link-exact-active toc-link level2">高级复用性代码抽取</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#封装网络请求" class="router-link-active router-link-exact-active toc-link level3">封装网络请求</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#封装表单搜索组件" class="router-link-active router-link-exact-active toc-link level3">封装表单搜索组件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#封装表格内容组件" class="router-link-active router-link-exact-active toc-link level3">封装表格内容组件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#封装模态框组件" class="router-link-active router-link-exact-active toc-link level3">封装模态框组件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#页面公共逻辑的-hooks-抽取" class="router-link-active router-link-exact-active toc-link level3">页面公共逻辑的 hooks 抽取</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现菜单管理功能" class="router-link-active router-link-exact-active toc-link level2">实现菜单管理功能</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现树形子树的展示" class="router-link-active router-link-exact-active toc-link level3">实现树形子树的展示</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现新增、编辑模态框功能以及删除功能" class="router-link-active router-link-exact-active toc-link level3">实现新增、编辑模态框功能以及删除功能</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现角色管理中的权限分配-难点" class="router-link-active router-link-exact-active toc-link level2">实现角色管理中的权限分配（难点）</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#创建角色的菜单树展示" class="router-link-active router-link-exact-active toc-link level3">创建角色的菜单树展示</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#创建角色携带菜单树的权限数据" class="router-link-active router-link-exact-active toc-link level3">创建角色携带菜单树的权限数据</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#编辑时角色菜单权限回显" class="router-link-active router-link-exact-active toc-link level3">编辑时角色菜单权限回显</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#新增时角色菜单权限回显重置" class="router-link-active router-link-exact-active toc-link level3">新增时角色菜单权限回显重置</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现登录用户的权限功能" class="router-link-active router-link-exact-active toc-link level2">实现登录用户的权限功能</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#封装菜单映射按钮权限工具" class="router-link-active router-link-exact-active toc-link level3">封装菜单映射按钮权限工具</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#获取登录用户的所有按钮权限" class="router-link-active router-link-exact-active toc-link level3">获取登录用户的所有按钮权限</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#封装权限-hooks" class="router-link-active router-link-exact-active toc-link level3">封装权限 hooks</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#编写-page-content-组件" class="router-link-active router-link-exact-active toc-link level3">编写 Page-content 组件</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#细节处理-新增编辑删除操作重置-current-分页" class="router-link-active router-link-exact-active toc-link level2">(细节处理)新增编辑删除操作重置 current 分页</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现数据统计页面" class="router-link-active router-link-exact-active toc-link level2">实现数据统计页面</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现顶部卡片组件页面" class="router-link-active router-link-exact-active toc-link level3">实现顶部卡片组件页面</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#顶部卡片中的数据递增动画实现" class="router-link-active router-link-exact-active toc-link level3">顶部卡片中的数据递增动画实现</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现顶部卡片响应式布局" class="router-link-active router-link-exact-active toc-link level3">实现顶部卡片响应式布局</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现-echart-可视化" class="router-link-active router-link-exact-active toc-link level2">实现 echart 可视化</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#初步搭建可视化页面" class="router-link-active router-link-exact-active toc-link level3">初步搭建可视化页面</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#三层组件封装-echart" class="router-link-active router-link-exact-active toc-link level3">三层组件封装 echart</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#获取请求数据用于-echarts-显示" class="router-link-active router-link-exact-active toc-link level3">获取请求数据用于 ECharts 显示</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现各种-echart-图动态数据展示" class="router-link-active router-link-exact-active toc-link level3">实现各种 Echart 图动态数据展示</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/projects/vue/cms.html#实现-echart-地图数据展示" class="router-link-active router-link-exact-active toc-link level3">实现 echart 地图数据展示</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h2 id="项目初始化" tabindex="-1"><a class="header-anchor" href="#项目初始化" aria-hidden="true">#</a> 项目初始化</h2><p>搭建 vue3 脚手架</p><p><code>npm init vue@latest</code></p><p>安装依赖</p><p><code>npm install</code></p><p>css 样式重置（略）</p><p>配置路由（略）</p><p>配置 pinia 状态管理（略）</p><p>配置 axios 网络请求 ts 写法</p><div class="language-TypeScript ext-TypeScript line-numbers-mode"><pre class="language-TypeScript"><code>// service/request/index.ts
import axios from &#39;axios&#39;
import type { AxiosInstance, AxiosRequestConfig, AxiosResponse } from &#39;axios&#39;

interface HYInstanceInterceptors&lt;T = AxiosResponse&gt; {
  requestInterceptor?: (config: AxiosRequestConfig) =&gt; AxiosRequestConfig
  requestInterceptorCatch?: (err: any) =&gt; any
  responseInterceptor?: (res: T) =&gt; T
  responseInterceptorCatch?: (err: any) =&gt; any
}

interface HYRequestConfig&lt;T = AxiosResponse&gt; extends AxiosRequestConfig {
  interceptors?: HYInstanceInterceptors&lt;T&gt;
}

class HYRequest {
  instance: AxiosInstance

  constructor(config: HYRequestConfig) {
    this.instance = axios.create(config)

    // 全局的拦截器
    this.instance.interceptors.request.use(
      (config) =&gt; {
        return config
      },
      (err) =&gt; {
        return err
      }
    )

    this.instance.interceptors.response.use(
      (res) =&gt; {
        return res.data
      },
      (err) =&gt; {
        return err
      }
    )

    // 实例的拦截器
    this.instance.interceptors.request.use(
      config.interceptors?.requestInterceptor,
      config.interceptors?.requestInterceptorCatch
    )
    this.instance.interceptors.response.use(
      config.interceptors?.responseInterceptor,
      config.interceptors?.responseInterceptorCatch
    )
  }

  request&lt;T = any&gt;(config: HYRequestConfig&lt;T&gt;) {
    if (config.interceptors?.requestInterceptor) {
      config = config.interceptors.requestInterceptor(config)
    }

    return new Promise&lt;T&gt;((resolve, reject) =&gt; {
      this.instance
        .request&lt;any, T&gt;(config)
        .then((res) =&gt; {
          if (config.interceptors?.responseInterceptor) {
            res = config.interceptors.responseInterceptor(res)
          }
          resolve(res)
        })
        .catch((err: any) =&gt; {
          if (config.interceptors?.responseInterceptorCatch) {
            err = config.interceptors.responseInterceptorCatch(err)
          }
          reject(err)
        })
    })
  }

  get&lt;T = any&gt;(config: HYRequestConfig&lt;T&gt;) {
    return this.request&lt;T&gt;({ ...config, method: &#39;GET&#39; })
  }

  post&lt;T = any&gt;(config: HYRequestConfig&lt;T&gt;) {
    return this.request&lt;T&gt;({ ...config, method: &#39;POST&#39; })
  }

  delete&lt;T = any&gt;(config: HYRequestConfig&lt;T&gt;) {
    return this.request&lt;T&gt;({ ...config, method: &#39;DELETE&#39; })
  }

  patch&lt;T = any&gt;(config: HYRequestConfig&lt;T&gt;) {
    return this.request&lt;T&gt;({ ...config, method: &#39;PATCH&#39; })
  }
}

export default HYRequest

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-TypeScript ext-TypeScript line-numbers-mode"><pre class="language-TypeScript"><code>// service/index.ts
import HYRequest from &#39;./request&#39;
import { BASE_URL1, TIME_OUT1 } from &#39;./config&#39;
import { localCache } from &#39;@/utils/cache&#39;

const hyRequest = new HYRequest({
  baseURL: BASE_URL1,
  timeout: TIME_OUT1,
  interceptors: {
    requestInterceptor: (config) =&gt; {
      const token = localCache.getCache(&#39;token&#39;)
      if (token &amp;&amp; config.headers) {
        config.headers.Authorization = `Bearer ${token}`
      }
      return config
    },
    requestInterceptorCatch: (err) =&gt; {
      return err
    },
    responseInterceptor: (res) =&gt; {
      return res
    },
    responseInterceptorCatch: (err) =&gt; {
      return err
    }
  }
})

export default hyRequest

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-TypeScript ext-TypeScript line-numbers-mode"><pre class="language-TypeScript"><code>// service/config/index.ts
export const BASE_URL1 = &#39;http://152.136.185.210:5000&#39;
export const TIME_OUT1 = 10000
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置生产环境和开发环境（略）</p><h2 id="按需引入-element-plus" tabindex="-1"><a class="header-anchor" href="#按需引入-element-plus" aria-hidden="true">#</a> 按需引入 Element-Plus</h2><p>安装插件<code>npm install -D unplugin-vue-components unplugin-auto-import</code></p><p>然后把下列代码插入到你的 Vite 或 Webpack 的配置文件中</p><p><strong>Vite</strong></p><div class="language-TypeScript ext-TypeScript line-numbers-mode"><pre class="language-TypeScript"><code>// vite.config.ts
import { defineConfig } from &#39;vite&#39;
import AutoImport from &#39;unplugin-auto-import/vite&#39;
import Components from &#39;unplugin-vue-components/vite&#39;
import { ElementPlusResolver } from &#39;unplugin-vue-components/resolvers&#39;

export default defineConfig({
  // ...
  plugins: [
    // ...
    AutoImport({
      resolvers: [ElementPlusResolver()],
    }),
    Components({
      resolvers: [ElementPlusResolver()],
    }),
  ],
})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Webpack</strong></p><div class="language-TypeScript ext-TypeScript line-numbers-mode"><pre class="language-TypeScript"><code>// webpack.config.js
const AutoImport = require(&#39;unplugin-auto-import/webpack&#39;)
const Components = require(&#39;unplugin-vue-components/webpack&#39;)
const { ElementPlusResolver } = require(&#39;unplugin-vue-components/resolvers&#39;)

module.exports = {
  // ...
  plugins: [
    AutoImport({
      resolvers: [ElementPlusResolver()],
    }),
    Components({
      resolvers: [ElementPlusResolver()],
    }),
  ],
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="实现登录页面" tabindex="-1"><a class="header-anchor" href="#实现登录页面" aria-hidden="true">#</a> 实现登录页面</h2><p><img src="https://secure2.wostatic.cn/static/hEmsB97qM1Pqq5HXqCahJc/image.png?auth_key=1692714182-myJuyHE6qti9wzkRprRRBu-0-fd1929b0a826ccee7cdac4d32098762e" alt=""></p><h3 id="设置-app-宽高铺满屏幕" tabindex="-1"><a class="header-anchor" href="#设置-app-宽高铺满屏幕" aria-hidden="true">#</a> 设置 App 宽高铺满屏幕</h3><p>注意这里不能用%号</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>&lt;style scoped&gt;
.app {
  /* 不能使用%，因为相对于父元素；vh相对于视口 */
  width: 100vw;
  height: 100vh;
  background-color: skyblue;
}
&lt;/style&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="搭建后台管理帐号登录页面" tabindex="-1"><a class="header-anchor" href="#搭建后台管理帐号登录页面" aria-hidden="true">#</a> 搭建后台管理帐号登录页面</h3><h4 id="login-父组件设置背景及位置" tabindex="-1"><a class="header-anchor" href="#login-父组件设置背景及位置" aria-hidden="true">#</a> Login 父组件设置背景及位置</h4><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>&lt;!-- Login.vue --&gt;
&lt;template&gt;
  &lt;div class=&quot;login&quot;&gt;
    &lt;login-panel /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import loginPanel from &#39;./cpns/login-panel.vue&#39;
&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;
.login {
  display: flex;
  justify-content: center;
  align-items: center;

  width: 100%;
  height: 100%;

  background: url(../../assets/img/login-bg.svg);
}
&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="全局图标及-elmessage-组件等样式引入" tabindex="-1"><a class="header-anchor" href="#全局图标及-elmessage-组件等样式引入" aria-hidden="true">#</a> 全局图标及 ElMessage 组件等样式引入</h4><p>图标引入安装：<code>npm install @element-plus/icons-vue</code></p><p>ElMessage 组件等样式引入安装：</p><div class="language-TypeScript ext-TypeScript line-numbers-mode"><pre class="language-TypeScript"><code>// 图标的全局注册
// global/register-icons.ts
import * as ElementPlusIconsVue from &#39;@element-plus/icons-vue&#39;
import type { App } from &#39;vue&#39;

function registerIcons(app: App) {
  for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
    app.component(key, component)
  }
}

export default registerIcons

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>main.ts 中进行注册</p><div class="language-TypeScript ext-TypeScript line-numbers-mode"><pre class="language-TypeScript"><code>import { createApp } from &#39;vue&#39;
import App from &#39;./App.vue&#39;
import &#39;normalize.css&#39;
import router from &#39;./router&#39;
import pinia from &#39;./store&#39;
import registerIcons from &#39;./global/register-icons&#39;

// 针对ElMessage和ElLoading等组件引入样式(手动按需引入)
import &#39;element-plus/theme-chalk/el-message.css&#39;

// 全局注册element-plus
// import ElementPlus from &#39;element-plus&#39;
// import &#39;element-plus/dist/index.css&#39;

// 安装vite-plugin-style-import/consola并配置vite.config.ts（自动按需引入样式）

createApp(App).use(router).use(pinia).use(registerIcons).mount(&#39;#app&#39;)

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="实现登录面板父组件" tabindex="-1"><a class="header-anchor" href="#实现登录面板父组件" aria-hidden="true">#</a> 实现登录面板父组件</h4><p>涉及到的 Element-Plus 组件有<code>el-tabs(选项卡)</code>、<code>el-check(记住密码勾选框)</code>、<code>el-button(立即登录)</code>、<code>el-link(记住密码/忘记密码)</code>、<code>el-icon(选项卡图标)</code></p><p>tabs 中插入图标需要用到<code>label</code>插槽<code>&lt;template #label&gt;...&lt;/template&gt;</code></p><p>tabs 中通过 v-model 绑定选项卡的 name</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>&lt;!-- login-panel.vue --&gt;
&lt;template&gt;
  &lt;div class=&quot;login-panel&quot;&gt;
    &lt;!-- 顶部标题 --&gt;
    &lt;h1 class=&quot;title&quot;&gt;后台管理系统&lt;/h1&gt;

    &lt;!-- tabs标签页 --&gt;
    &lt;div class=&quot;tabs&quot;&gt;
      &lt;el-tabs v-model=&quot;activeName&quot; type=&quot;border-card&quot; stretch=&quot;true&quot;&gt;
        &lt;el-tab-pane label=&quot;帐号登录&quot; name=&quot;account&quot;&gt;

          &lt;!-- 图标插槽 --&gt;
          &lt;template #label&gt;
            &lt;div class=&quot;label&quot;&gt;
              &lt;el-icon&gt;&lt;UserFilled /&gt;&lt;/el-icon&gt;
              &lt;span class=&quot;text&quot;&gt;帐号登录&lt;/span&gt;
            &lt;/div&gt;
          &lt;/template&gt;

          &lt;!-- pane-account子组件 --&gt;
          &lt;pane-account ref=&quot;accountRef&quot;/&gt;
        &lt;/el-tab-pane&gt;

        &lt;el-tab-pane label=&quot;手机登录&quot; name=&quot;phone&quot;&gt;
          &lt;!-- 图标插槽 --&gt;
          &lt;template #label&gt;
            &lt;div class=&quot;label&quot;&gt;
              &lt;el-icon&gt;&lt;Cellphone /&gt;&lt;/el-icon&gt;
              &lt;div class=&quot;text&quot;&gt;手机登录&lt;/div&gt;
            &lt;/div&gt;
          &lt;/template&gt;
          &lt;div&gt;手机登录&lt;/div&gt;
          &lt;div&gt;验证码&lt;/div&gt;
        &lt;/el-tab-pane&gt;
      &lt;/el-tabs&gt;
    &lt;/div&gt;

    &lt;!-- 底部区域 --&gt;
    &lt;div class=&quot;controls&quot;&gt;
      &lt;el-checkbox v-model=&quot;isRemPwd&quot; label=&quot;记住密码&quot; size=&quot;large&quot;&gt;&lt;/el-checkbox&gt;
      &lt;el-link type=&quot;primary&quot; href=&quot;&quot;&gt;忘记密码&lt;/el-link&gt;
    &lt;/div&gt;

    &lt;el-button class=&quot;login-btn&quot; type=&quot;primary&quot; size=&quot;large&quot; @click=&quot;handleLoginBtnClick&quot;&gt;
      立即登录
    &lt;/el-button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import { ref } from &#39;vue&#39;
import paneAccount from &#39;./pane-account.vue&#39;

const activeName = ref(&#39;account&#39;)
const isRemPwd = ref(false)
const accountRef = ref&lt;InstanceType&lt;typeof paneAccount&gt;&gt;()

// 按钮监听
const handleLoginBtnClick = () =&gt; {
  if (activeName.value === &#39;account&#39;) {
    // 父组件调用子组件方法
    accountRef.value?.loginAction()
  } else {
    console.log(&#39;手机登录&#39;)
  }
}
&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;
.login-panel {
  width: 330px;

  .title {
    text-align: center;
  }

  .label {
    display: flex;

    .text {
      margin-left: 5px;
    }
  }

  .controls {
    display: flex;
    justify-content: space-between;
  }

  .login-btn {
    margin-top: 10px;
    width: 100%;
  }
}
&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="封装面板中登录表单子组件" tabindex="-1"><a class="header-anchor" href="#封装面板中登录表单子组件" aria-hidden="true">#</a> 封装面板中登录表单子组件</h4><p>涉及到的 Element-Plus 组件有<code>el-form</code>、<code>el-input</code>、<code>el-message</code></p><p><code>form</code>的校验规则需要使用到<code>FormRules</code></p><p><code>form</code>的通过验证需要使用<code>formRef.value.validate()</code></p><p><code>defineExpose</code>将子组件的用户名/密码暴露给父组件，从而实现登录逻辑（涉及 pinia、axios）</p><div class="language-TypeScript ext-TypeScript line-numbers-mode"><pre class="language-TypeScript"><code>&lt;!-- pane-account.vue --&gt;
&lt;template&gt;
  &lt;div class=&quot;account&quot;&gt;
    &lt;el-form :model=&quot;account&quot; label-width=&quot;60px&quot; size=&quot;large&quot; :rules=&quot;accountRules&quot; status-icon ref=&quot;formRef&quot;&gt;
        &lt;el-form-item label=&quot;帐号&quot; prop=&quot;username&quot;&gt;
            &lt;el-input v-model=&quot;account.username&quot; placeholder=&quot;请输入帐号&quot;&gt;&lt;/el-input&gt;
        &lt;/el-form-item&gt;
        &lt;el-form-item label=&quot;密码&quot; prop=&quot;password&quot;&gt;
            &lt;el-input v-model=&quot;account.password&quot; placeholder=&quot;请输入密码&quot; show-password&gt;&lt;/el-input&gt;
        &lt;/el-form-item&gt;
    &lt;/el-form&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import { reactive, ref } from &quot;vue&quot;
import type { ElForm, FormRules } from &#39;element-plus&#39;
import { ElMessage } from &#39;element-plus&#39;
import useLoginStore from &#39;@/store/login/login&#39;
import type { IAccount } from &#39;@/types&#39;

// 定义account数据
const account = reactive&lt;IAccount&gt;({
  username: &#39;&#39;,
  password: &#39;&#39;
})

// 定义校验规则
const accountRules: FormRules = {
  username: [
    { required: true, message: &#39;必须输入用户名&#39;, trigger: &#39;blur&#39; },
    { pattern: /^[a-z0-9]{6,20}$/, message: &#39;必须是6～20位以小写字母或数字开头&#39;, trigger: &#39;blur&#39; },
  ],
  password: [
    { required: true, message: &#39;必须输入密码&#39;, trigger: &#39;blur&#39;},
    { min: 3, max: 11, message: &#39;长度必须在3~11个字符&#39;, trigger: &#39;blur&#39;}
  ]
}

// 执行帐号登录逻辑
const formRef = ref&lt;InstanceType&lt;typeof ElForm&gt;&gt;()
const loginStore = useLoginStore()
function loginAction() {
  formRef.value?.validate((valid: any) =&gt; {
    if(valid) {
        const username = account.username
        const password = account.password

        loginStore.loginAccountAction({ username, password })
    } else {
        ElMessage.error(&#39;Oops, 请输入正确的格式.&#39;)
    }
  })
}
// 暴露给父组件
defineExpose({
    loginAction
})

&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;

&lt;/style&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现点击登录按钮逻辑" tabindex="-1"><a class="header-anchor" href="#实现点击登录按钮逻辑" aria-hidden="true">#</a> 实现点击登录按钮逻辑</h3><h4 id="封装-iaccount-对象类型" tabindex="-1"><a class="header-anchor" href="#封装-iaccount-对象类型" aria-hidden="true">#</a> 封装 IAccount 对象类型</h4><div class="language-TypeScript ext-TypeScript line-numbers-mode"><pre class="language-TypeScript"><code>// types/login.ts
export interface IAccount {
    username: string,
    password: string
}

// types/index.ts(统一导出)
export * from &#39;./login&#39;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="封装-axios-登录请求" tabindex="-1"><a class="header-anchor" href="#封装-axios-登录请求" aria-hidden="true">#</a> 封装 axios 登录请求</h4><div class="language-TypeScript ext-TypeScript line-numbers-mode"><pre class="language-TypeScript"><code>import hyRequest from &quot;..&quot;
import type { IAccount } from &quot;@/types&quot;

export function accountLoginRequest(account: IAccount) {
    return hyRequest.post({
        url: &#39;/login&#39;,
        data: account
    })
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="使用-pinia-存储请求数据-在pane-account组件中调用" tabindex="-1"><a class="header-anchor" href="#使用-pinia-存储请求数据-在pane-account组件中调用" aria-hidden="true">#</a> 使用 pinia 存储请求数据(在<code>pane-account</code>组件中调用)</h4><div class="language-TypeScript ext-TypeScript line-numbers-mode"><pre class="language-TypeScript"><code>// store/index.ts
// 初始化pinia
import { createPinia } from &quot;pinia&quot;;

const pinia = createPinia()

export default pinia
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-TypeScript ext-TypeScript line-numbers-mode"><pre class="language-TypeScript"><code>// store/login/login.ts
import { defineStore } from &quot;pinia&quot;;
import { accountLoginRequest } from &#39;@/service/login/login&#39;
import type { IAccount } from &quot;@/types&quot;;
import { localCache } from &quot;@/utils/cache&quot;;

const useLoginStore = defineStore(&#39;login&#39;, {
    state: () =&gt; ({
        id: &#39;&#39;,
        // token: localStorage.getItem(&#39;token&#39;) ?? &#39;&#39;,
        token: localCache.getCache(&#39;token&#39;) ?? &#39;&#39;,
        username: &#39;&#39;
    }),

    actions: {
        async loginAccountAction(account: IAccount) {
            const loginResult = await accountLoginRequest(account)
            console.log(&quot;登录成功&quot;);
            this.id = loginResult.data.id
            this.token = loginResult.data.token
            this.username = loginResult.data.username

            // 进行本地缓存
            // localStorage.setItem(&#39;token&#39;, this.token)
            localCache.setCache(&#39;token&#39;, this.token)
        }
    }
})

export default useLoginStore
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="封装本地缓存-token-工具-localstorage、sessionstorage" tabindex="-1"><a class="header-anchor" href="#封装本地缓存-token-工具-localstorage、sessionstorage" aria-hidden="true">#</a> 封装本地缓存 token 工具（localStorage、sessionStorage）</h4><div class="language-TypeScript ext-TypeScript line-numbers-mode"><pre class="language-TypeScript"><code>// utils/cache.ts
enum CacheType {
  local = &#39;local&#39;,
  session = &#39;session&#39;
}

class MyCache {
  storage: Storage

  // 判断是localStorage还是sessionStorage
  constructor(type: CacheType) {
    this.storage = type === CacheType.local ? localStorage : sessionStorage
  }

  setCache(key: string, value: any) {
    this.storage.setItem(key, JSON.stringify(value))
  }

  getCache(key: string) {
    const value = this.storage.getItem(key)
    if (value) {
      return JSON.parse(value)
    }
  }

  deleteCache(key: string) {
    this.storage.removeItem(key)
  }

  clearCache() {
    this.storage.clear()
  }
}

const localCache = new MyCache(CacheType.local)
const sessionCache = new MyCache(CacheType.session)

export { localCache, sessionCache }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="登录拦截-路由导航守卫" tabindex="-1"><a class="header-anchor" href="#登录拦截-路由导航守卫" aria-hidden="true">#</a> 登录拦截（路由导航守卫）</h4><p><code>router.beforeEach(to, from)</code></p><div class="language-TypeScript ext-TypeScript line-numbers-mode"><pre class="language-TypeScript"><code>// router/index.ts
import { localCache } from &#39;@/utils/cache&#39;
import { createRouter, createWebHashHistory } from &#39;vue-router&#39;

const router = createRouter({
  // ...
})

router.beforeEach((to, from) =&gt; {
  const token = localCache.getCache(&#39;token&#39;)

  if(to.path === &#39;/main&#39; &amp;&amp; !token) {
      return &#39;/login&#39;
  }
})

export default router
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现记住密码" tabindex="-1"><a class="header-anchor" href="#实现记住密码" aria-hidden="true">#</a> 实现记住密码</h3><p>父组件将<code>isRemPwd</code>作为参数传入子组件登录逻辑，判断<code>isRemPwd</code>的布尔值，来选择是否存入或删除<code>LocalStore</code>本地缓存，再获取本地缓存将值赋值给初始化的<code>username</code>和<code>password</code>进行回显。将勾选框是否选中也作为<code>LocalStore</code>缓存存入。</p><div class="language-TypeScript ext-TypeScript line-numbers-mode"><pre class="language-TypeScript"><code>// 父组件login-panel
// ...
const isRemPwd = ref&lt;boolean&gt;(localCache.getCache(&#39;isRemPwd&#39;) ?? false)
watch(isRemPwd, (newValue) =&gt; {
  localCache.setCache(&#39;isRemPwd&#39;, newValue)
})

// ...
// 按钮监听
const handleLoginBtnClick = () =&gt; {
  if (activeName.value === &#39;account&#39;) {
    // 父组件调用子组件方法
    accountRef.value?.loginAction(isRemPwd.value)
  } else {
    console.log(&#39;手机登录&#39;)
  }
}
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-TypeScript ext-TypeScript line-numbers-mode"><pre class="language-TypeScript"><code>
// 定义account数据
const account = reactive&lt;IAccount&gt;({
  username: localCache.getCache(&#39;username&#39;) ?? &#39;&#39;,
  password: localCache.getCache(&#39;password&#39;) ?? &#39;&#39;
})

// 执行帐号登录逻辑
// ...
function loginAction(isRemPwd: boolean) {
  formRef.value?.validate((valid: any) =&gt; {
    if(valid) {
        const username = account.username
        const password = account.password

        // 调用store中的loginAccountAction(pinia)
        loginStore.loginAccountAction({ username, password }).then((res) =&gt; {
          // 登录成功后记住密码
          if(isRemPwd) {
            localCache.setCache(&#39;username&#39;, username)
            localCache.setCache(&#39;password&#39;, password)
          } else {
            localCache.deleteCache(&#39;username&#39;)
            localCache.deleteCache(&#39;password&#39;)
          }
        })
    } else {
        ElMessage.error(&#39;错误, 请输入正确的格式！&#39;)
    }
  })
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现获取登录用户详细信息-包括角色权限菜单" tabindex="-1"><a class="header-anchor" href="#实现获取登录用户详细信息-包括角色权限菜单" aria-hidden="true">#</a> 实现获取登录用户详细信息（包括角色权限菜单）</h3><h4 id="封装-axios-接口请求" tabindex="-1"><a class="header-anchor" href="#封装-axios-接口请求" aria-hidden="true">#</a> 封装 axios 接口请求</h4><div class="language-TypeScript ext-TypeScript line-numbers-mode"><pre class="language-TypeScript"><code>// 获取用户详细信息
export function getUserInfoById(id: number) {
    return hyRequest.get({
        url: `/users/${id}`,
        // headers: {
        //     Authorization: &#39;Bearer &#39; + localCache.getCache(&#39;token&#39;)
        // }
    })
}

// 获取角色权限信息
export function getUserMenusByRoleId(id: number) {
    return hyRequest.get({
        url: `/role/${id}/menu`,
    })
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="使用-pinia-存储请求数据" tabindex="-1"><a class="header-anchor" href="#使用-pinia-存储请求数据" aria-hidden="true">#</a> 使用 pinia 存储请求数据</h4><div class="language-TypeScript ext-TypeScript line-numbers-mode"><pre class="language-TypeScript"><code>interface ILoginState {
    token: string,
    userInfo: any,
    userMenus: any
}

const useLoginStore = defineStore(&#39;login&#39;, {
    state: (): ILoginState =&gt; ({
        token: localCache.getCache(&#39;token&#39;) ?? &#39;&#39;,
        userInfo: {},
        userMenus: {}
    }),

    actions: {
        async loginAccountAction(account: IAccount) {
            // 1. 帐号登录，axios获取token等信息
            const loginResult = await accountLogin(account)
            const id = loginResult.data.id
            this.token = loginResult.data.token

            // 2. 进行本地缓存（使用封装的cache工具）
            localCache.setCache(&#39;token&#39;, this.token)

            // 3.获取登录用户的详细信息（role角色信息）
            const userInfoResult = await getUserInfoById(id)
            this.userInfo = userInfoResult.data

            // 4.根据角色请求用户的权限（菜单menus）
            const userMenusResult = await getUserMenusByRoleId(this.userInfo.role.id)
            this.userMenus = userMenusResult.data

            //  页面跳转
            router.push(&#39;/main&#39;)
        }
    }
})

export default useLoginStore
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="实现主页左侧导航栏" tabindex="-1"><a class="header-anchor" href="#实现主页左侧导航栏" aria-hidden="true">#</a> 实现主页左侧导航栏</h2><p><img src="https://secure2.wostatic.cn/static/k1FTgme1ezTAH36tihiQ15/image.png?auth_key=1692714258-eBCxE2MWbDGHuwFKHMNuTS-0-d6c434ac984a7a4498961fa74809b3f0" alt=""></p><h3 id="整体容器布局" tabindex="-1"><a class="header-anchor" href="#整体容器布局" aria-hidden="true">#</a> 整体容器布局</h3><p>使用<code>el-container</code>包裹侧边栏容器<code>el-aside</code>以及包裹<code>el-header</code>顶栏容器和<code>el-main</code>主要区域容器。</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>&lt;template&gt;
  &lt;div class=&quot;main&quot;&gt;
    &lt;el-container class=&quot;main-content&quot;&gt;
      // 左侧导航栏
      &lt;el-aside width=&quot;210px&quot;&gt;
        &lt;main-menu/&gt;
      &lt;/el-aside&gt;
      &lt;el-container&gt;
        &lt;el-header height=&quot;50px&quot;&gt;Header&lt;/el-header&gt;
        &lt;el-main&gt;
          // 路由占位
          &lt;router-view/&gt;
        &lt;/el-main&gt;
      &lt;/el-container&gt;
    &lt;/el-container&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style lang=&quot;less&quot; scoped&gt;
.main {
  color: red;
  height: 100%;

  .main-content {
    height: 100%;

    .el-aside {
      overflow-x: hidden;
      overflow-y: auto;
      line-height: 200px;
      text-align: left;
      cursor: pointer;
      background-color: #001529;
      transition: width 0.3s linear;
      scrollbar-width: none; /* firefox */
      -ms-overflow-style: none; /* IE 10+ */

      &amp;::-webkit-scrollbar {
        display: none;
      }
    }

    .el-main {
      background-color: #f0f2f5;
    }
  }
}
&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现左侧导航栏静态布局" tabindex="-1"><a class="header-anchor" href="#实现左侧导航栏静态布局" aria-hidden="true">#</a> 实现左侧导航栏静态布局</h3><p>使用<code>elementUI</code>中菜单<code>menu</code>组件由<code>el-menu</code>、<code>el-sub-menu</code>（需要使用插槽）、<code>el-menu-item</code>组成。</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>&lt;template&gt;
  &lt;div class=&quot;main-menu&quot;&gt;
    &lt;div class=&quot;logo&quot;&gt;
      &lt;img class=&quot;img&quot; src=&quot;@/assets/img/logo.svg&quot; alt=&quot;图标&quot; /&gt;
      &lt;h2 class=&quot;title&quot;&gt;后台管理系统&lt;/h2&gt;
    &lt;/div&gt;
    &lt;div class=&quot;menu&quot;&gt;
      &lt;el-menu
        :default-active=&quot;defaultValue&quot;
        :collapse=&quot;isFold&quot;
        text-color=&quot;#b7bdc3&quot;
        active-text-color=&quot;#fff&quot;
        background-color=&quot;#001529&quot;
      &gt;
        &lt;el-sub-menu index=&quot;1&quot;&gt;
          &lt;!-- 插槽 --&gt;
          &lt;template #title&gt;
            &lt;el-icon&gt;&lt;Monitor /&gt;&lt;/el-icon&gt;
            &lt;span&gt;系统总览&lt;/span&gt;
          &lt;/template&gt;
          &lt;el-menu-item&gt;核心技术&lt;/el-menu-item&gt;
          &lt;el-menu-item&gt;商品统计&lt;/el-menu-item&gt;
        &lt;/el-sub-menu&gt;

        &lt;el-sub-menu index=&quot;2&quot;&gt;
          &lt;template #title&gt;
            &lt;el-icon&gt;&lt;location /&gt;&lt;/el-icon&gt;
            &lt;span&gt;系统管理&lt;/span&gt;
          &lt;/template&gt;
          &lt;el-menu-item&gt;用户管理&lt;/el-menu-item&gt;
          &lt;el-menu-item&gt;部门管理&lt;/el-menu-item&gt;
          &lt;el-menu-item&gt;菜单管理&lt;/el-menu-item&gt;
          &lt;el-menu-item&gt;角色管理&lt;/el-menu-item&gt;
        &lt;/el-sub-menu&gt;
      &lt;/el-menu&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;
.main-menu {
  height: 100%;
  background-color: #001529;

  .logo {
    display: flex;
    height: 28px;
    padding: 12px 10px 8px 10px;
    flex-direction: row;
    justify-content: flex-start;
    align-items: center;
    overflow: hidden;

    .img {
      height: 100%;
      margin: 0 10px;
    }

    .title {
      font-size: 16px;
      font-weight: 700;
      color: white;
      white-space: nowrap;
    }
  }
}

.el-menu {
  border-right: none;
  user-select: none;
}

.el-sub-menu {
  .el-menu-item {
    padding-left: 50px !important;
    background-color: #0c2135;
  }

  .el-menu-item:hover {
    color: #fff;
  }

  .el-menu-item.is-active {
    background-color: #0a60bd;
  }
}
&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现左侧导航栏动态展示效果" tabindex="-1"><a class="header-anchor" href="#实现左侧导航栏动态展示效果" aria-hidden="true">#</a> 实现左侧导航栏动态展示效果</h3><p>首先将用户详细信息，权限信息缓存处理（刷新时依然存在），然后使用<code>&lt;template v-for=&quot;&quot;&gt;</code>、<code>mustache</code>表达式动态遍历即可。</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>// 登录时store缓存用户权限信息
state: (): ILoginState =&gt; ({
    // ...
    userInfo: localCache.getCache(&#39;userInfo&#39;) ?? {},
    userMenus: localCache.getCache(&#39;userMenus&#39;) ?? []
}),
actions: {
    async loginAccountAction(account: IAccount) {
        // ....
        // 进行用户权限信息缓存
        localCache.setCache(&#39;userInfo&#39;, this.userInfo)
        localCache.setCache(&#39;userMenus&#39;, this.userMenus)

        //  页面跳转
        router.push(&#39;/main&#39;)
    }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>&lt;template&gt;
  &lt;div class=&quot;main-menu&quot;&gt;
    &lt;div class=&quot;logo&quot;&gt;
      &lt;img class=&quot;img&quot; src=&quot;@/assets/img/logo.svg&quot; alt=&quot;图标&quot; /&gt;
      &lt;h2 class=&quot;title&quot;&gt;后台管理系统&lt;/h2&gt;
    &lt;/div&gt;
    &lt;div class=&quot;menu&quot;&gt;
      &lt;el-menu
        :default-active=&quot;defaultValue&quot;
        :collapse=&quot;isFold&quot;
        text-color=&quot;#b7bdc3&quot;
        active-text-color=&quot;#fff&quot;
        background-color=&quot;#001529&quot;
      &gt;
        &lt;template v-for=&quot;item in userMenus&quot; :key=&quot;item.id&quot;&gt;
          &lt;!-- 子菜单 --&gt;
          &lt;el-sub-menu :index=&quot;item.id + &#39;&#39;&quot;&gt;
            &lt;template #title&gt;
              &lt;span&gt;{{ item.name }}&lt;/span&gt;
            &lt;/template&gt;

            &lt;!-- 子菜单的每一项 --&gt;
            &lt;template v-for=&quot;subItem in item.children&quot; :key=&quot;subItem.id&quot;&gt;
              &lt;el-menu-item :index=&quot;subItem.id + &#39;&#39;&quot; @click=&quot;handleItemClick(subItem)&quot;&gt;{{ subItem.name }}&lt;/el-menu-item&gt;
            &lt;/template&gt;
          &lt;/el-sub-menu&gt;
        &lt;/template&gt;
      &lt;/el-menu&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import useLoginStore from &#39;@/store/login/login&#39;;

const loginStore = useLoginStore();
const userMenus = loginStore.userMenus

function handleItemClick(subItem: any) {
  const url = subItem.url
  router.push(url)
}
&lt;/script&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="导航栏图标的动态组件-细节处理" tabindex="-1"><a class="header-anchor" href="#导航栏图标的动态组件-细节处理" aria-hidden="true">#</a> 导航栏图标的动态组件（细节处理）</h3><p>服务器返回的是字符串<code>el-icon-monitor</code>，需要使用动态组件<code>componet</code>来处理图标字符串并且使用<code>split</code>函数分隔字符串。</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>&lt;!-- 子菜单 --&gt;
&lt;el-sub-menu :index=&quot;item.id + &#39;&#39;&quot;&gt;
  &lt;template #title&gt;
    &lt;el-icon&gt;
      &lt;component :is=&quot;item.icon.split(&#39;-icon-&#39;)[1]&quot;/&gt;
    &lt;/el-icon&gt;
    &lt;span&gt;{{ item.name }}&lt;/span&gt;
  &lt;/template&gt;
  // .......
&lt;/el-sub-menu&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="导航栏注册所有静态路由-有缺陷" tabindex="-1"><a class="header-anchor" href="#导航栏注册所有静态路由-有缺陷" aria-hidden="true">#</a> 导航栏注册所有静态路由（有缺陷）</h3><p>当用户没有权限时，可以手动在地址栏输入 url 去访问没有权限的页面。后面使用动态路由。</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>{
  path: &#39;/main&#39;,
  component: () =&gt; import(&#39;../views/main/Main.vue&#39;),
  children: [
    {
      path: &#39;/main/analysis/overview&#39;,
      component: () =&gt; import(&#39;../views/main/analysis/overview/overview.vue&#39;)
    },
    {
      path: &#39;/main/analysis/dashboard&#39;,
      component: () =&gt; import(&#39;../views/main/analysis/dashboard/dashboard.vue&#39;)
    },
    {
      path: &#39;/main/system/role&#39;,
      component: () =&gt; import(&#39;../views/main/system/role/role.vue&#39;)
    },
    {
      path: &#39;/main/system/user&#39;,
      component: () =&gt; import(&#39;../views/main/system/user/user.vue&#39;)
    },
    // ...
  ]
},
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="实现主页头部面包屑" tabindex="-1"><a class="header-anchor" href="#实现主页头部面包屑" aria-hidden="true">#</a> 实现主页头部面包屑</h2><p><img src="https://secure2.wostatic.cn/static/qtx8xmpZnWgke1ogQXaq5n/image.png" alt=""></p><h3 id="搭建整体布局" tabindex="-1"><a class="header-anchor" href="#搭建整体布局" aria-hidden="true">#</a> 搭建整体布局</h3><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>&lt;template&gt;
  &lt;div class=&quot;main-header&quot;&gt;
    &lt;div class=&quot;menu-icon&quot; @click=&quot;handleMenuIconClick&quot;&gt;
      &lt;el-icon size=&quot;28px&quot;&gt;
        &lt;el-icon&gt;&lt;Fold /&gt;&lt;/el-icon&gt;
      &lt;/el-icon&gt;
    &lt;/div&gt;
    &lt;div class=&quot;content&quot;&gt;
      &lt;div class=&quot;breadcrumb&quot;&gt;面包屑&lt;/div&gt;
      &lt;div class=&quot;info&quot;&gt;个人信息&lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style lang=&quot;less&quot; scoped&gt;
.main-header {
  display: flex;
  align-items: center;
  flex: 1;
  height: 100%;

  .menu-icon {
    display: flex;
    align-items: center;
    cursor: pointer;
  }

  .content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex: 1;
    padding: 0 18px;
  }
}
&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现头部左侧图标点击折叠功能" tabindex="-1"><a class="header-anchor" href="#实现头部左侧图标点击折叠功能" aria-hidden="true">#</a> 实现头部左侧图标点击折叠功能</h3><p>由<code>main-header</code>子组件通过<code>defineEmits</code>将折叠状态<code>isFold</code>传入给父组件<code>main</code>中的<code>el-aside</code>从而控制其宽度。</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>// main-header.vue
&lt;template&gt;
  &lt;div class=&quot;main-header&quot;&gt;
    &lt;div class=&quot;menu-icon&quot; @click=&quot;handleMenuIconClick&quot;&gt;
      &lt;el-icon size=&quot;28px&quot;&gt;
        &lt;component :is=&quot;isFold ? &#39;Expand&#39; : &#39;Fold&#39;&quot;/&gt;
      &lt;/el-icon&gt;
    &lt;/div&gt;
    &lt;div class=&quot;content&quot;&gt;
      &lt;div class=&quot;breadcrumb&quot;&gt;面包屑&lt;/div&gt;
      &lt;div class=&quot;info&quot;&gt;个人信息&lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import { ref } from &quot;vue&quot;;

// 1.内部自定义事件
const emit = defineEmits([&#39;foldChange&#39;])

// 2.记录折叠状态
const isFold = ref(false)
function handleMenuIconClick() {
  // 3.子组件内部改变状态
  isFold.value = !isFold.value

  // 4.将事件和状态传递给父组件
  emit(&#39;foldChange&#39;, isFold.value)
}
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>父组件在定义<code>main-header</code>上通过<code>@fold-change</code>接收子组件传来的<code>emit(&#39;foldChange&#39;, isFold.value)</code>。</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>// main.vue
&lt;template&gt;
  &lt;div class=&quot;main&quot;&gt;
    &lt;el-container class=&quot;main-content&quot;&gt;
      &lt;el-aside :width=&quot;isFold ? &#39;60px&#39; : &#39;210px&#39;&quot;&gt;
        &lt;!-- 父传子（defineProps） --&gt;
        &lt;main-menu :is-fold=&quot;isFold&quot;/&gt;
      &lt;/el-aside&gt;

      &lt;el-container&gt;
        &lt;el-header height=&quot;50px&quot;&gt;
          &lt;!-- emit子传父（defineEmits） --&gt;
          &lt;main-header @fold-change=&quot;handleFoldChange&quot;/&gt;
        &lt;/el-header&gt;
        &lt;el-main&gt;Main&lt;/el-main&gt;
      &lt;/el-container&gt;
    &lt;/el-container&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import { localCache } from &#39;@/utils/cache&#39;;
import { useRouter } from &#39;vue-router&#39;;
import MainMenu from &#39;@/components/main-menu/main-menu.vue&#39;
import MainHeader from &#39;@/components/main-header/main-header.vue&#39;
import { ref } from &#39;vue&#39;;

const isFold = ref(false)
function handleFoldChange(isFoldValue: boolean) {
  isFold.value = isFoldValue
}
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>父组件通过子组件的<code>defineProps</code>将<code>:is-fold=&quot;isFold&quot;</code>折叠状态传入到<code>el-menu</code>的属性<code>:collapse</code>上，从而控制<code>menu</code>菜单的折叠。</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>// main-menu.vue
&lt;template&gt;
  &lt;div class=&quot;main-menu&quot;&gt;
    // ....
    &lt;div class=&quot;menu&quot;&gt;
      &lt;el-menu
        // ....
        :collapse=&quot;isFold&quot;
      &gt;
      // ....
      &lt;/el-menu&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script setup lang=&quot;ts&quot;&gt;
defineProps({
  isFold: {
    type: Boolean,
    default: false
  }
})
&lt;/script&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现头部右侧个人信息功能" tabindex="-1"><a class="header-anchor" href="#实现头部右侧个人信息功能" aria-hidden="true">#</a> 实现头部右侧个人信息功能</h3><h4 id="静态布局搭建-包含注销功能" tabindex="-1"><a class="header-anchor" href="#静态布局搭建-包含注销功能" aria-hidden="true">#</a> 静态布局搭建（包含注销功能）</h4><p>使用<code>el-dropdown</code>下拉菜单组件，这里要调节下拉框的样式需要加<code>:global</code>（原因：它不在 app 父组件下，它在与 app 同级的组件 el-popper-container 下）</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>&lt;template&gt;
  &lt;div class=&quot;header-info&quot;&gt;
    &lt;div class=&quot;operation&quot;&gt;
      &lt;span&gt;
        &lt;el-icon&gt;&lt;bell /&gt;&lt;/el-icon&gt;
      &lt;/span&gt;
      &lt;span&gt;
        &lt;el-icon&gt;&lt;ChatDotRound /&gt;&lt;/el-icon&gt;
      &lt;/span&gt;
      &lt;span&gt;
        &lt;span class=&quot;dot&quot;&gt;&lt;/span&gt;
        &lt;el-icon&gt;&lt;Postcard /&gt;&lt;/el-icon&gt;
      &lt;/span&gt;
    &lt;/div&gt;
    &lt;div class=&quot;info&quot;&gt;
      &lt;el-dropdown&gt;
        &lt;span class=&quot;user-info&quot;&gt;
          &lt;el-avatar :size=&quot;30&quot; class=&quot;avatar&quot; src=&quot;https://xumingyu2018.github.io/avatar.png&quot; /&gt;
          &lt;span class=&quot;name&quot;&gt;{{ loginStore.userInfo.name }}&lt;/span&gt;
        &lt;/span&gt;
        &lt;template #dropdown&gt;
          &lt;el-dropdown-menu&gt;
            &lt;el-dropdown-item @click=&quot;handleExitClick&quot;&gt;
              &lt;el-icon&gt;&lt;CircleCloseFilled /&gt;&lt;/el-icon&gt;
              注销
            &lt;/el-dropdown-item&gt;
            &lt;el-dropdown-item divided&gt;
              &lt;el-icon&gt;&lt;InfoFilled /&gt;&lt;/el-icon&gt;
              个人信息
            &lt;/el-dropdown-item&gt;
            &lt;el-dropdown-item&gt;
              &lt;el-icon&gt;&lt;Unlock /&gt;&lt;/el-icon&gt;
              修改密码
            &lt;/el-dropdown-item&gt;
          &lt;/el-dropdown-menu&gt;
        &lt;/template&gt;
      &lt;/el-dropdown&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { useRouter } from &#39;vue-router&#39;
import { localCache } from &#39;@/utils/cache&#39;
import useLoginStore from &#39;@/store/login/login&#39;

const router = useRouter()
function handleExitClick() {
  localCache.deleteCache(&#39;token&#39;)
  localCache.deleteCache(&#39;userInfo&#39;)
  localCache.deleteCache(&#39;userMenus&#39;)
  router.push(&#39;/login&#39;)
}

// 显示用户名称信息
const loginStore = useLoginStore()
&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;
.header-info {
  display: flex;
  align-items: center;
}

.operation {
  display: inline-flex;
  margin-right: 20px;
  span {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 35px;

    &amp;:hover {
      background: #f2f2f2;
    }

    i {
      font-size: 20px;
    }

    .dot {
      position: absolute;
      top: 3px;
      right: 3px;
      z-index: 10;
      width: 6px;
      height: 6px;
      background: red;
      border-radius: 100%;
    }
  }
}

.user-info {
  display: flex;
  align-items: center;
  cursor: pointer;

  .name {
    margin-left: 8px;
  }
}

.info {
  // 使用global的原因是因为它不在app父组件下，它在与app同级的组件el-popper-container下
  :global(.el-dropdown-menu__item) {
    line-height: 36px !important;
    padding: 6px 22px;
  }
}
&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="动态路由" tabindex="-1"><a class="header-anchor" href="#动态路由" aria-hidden="true">#</a> 动态路由</h2><p><img src="https://secure2.wostatic.cn/static/oFj2Q945VD4Dv4kdaW3sqn/image.png" alt=""></p><p>本文采用基于菜单的动态路由管理实现（结合 coderwhy 全局工具）。</p><h3 id="安装自动化生成路由配置信息和-vue-页面的工具" tabindex="-1"><a class="header-anchor" href="#安装自动化生成路由配置信息和-vue-页面的工具" aria-hidden="true">#</a> 安装自动化生成路由配置信息和 vue 页面的工具</h3><p><code>npm install coderwhy -g</code></p><h3 id="使用-coderwhy-工具" tabindex="-1"><a class="header-anchor" href="#使用-coderwhy-工具" aria-hidden="true">#</a> 使用 coderwhy 工具</h3><p>例：<code>coderwhy add3page_setup list -d src/views/main/story/list</code></p><p><code>add3page_setup</code>：针对 vue3 的 setup 语法。</p><p><code>-d</code>：生成指定文件的地址。</p><p><code>list</code>：生成的路由名字和 vue 页面名字。</p><h3 id="编写菜单映射路由工具类" tabindex="-1"><a class="header-anchor" href="#编写菜单映射路由工具类" aria-hidden="true">#</a> 编写菜单映射路由工具类</h3><ol><li>根据菜单映射对应的路由。</li><li>进入主页匹配第一个菜单的路由。</li></ol><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>// utils/map-menus.ts
import type { RouteRecordRaw } from &quot;vue-router&quot;

// 自动化加载所有的路由（也可以收到写死）
function loadLocalRoutes() {
  // 1.加载所有的模板
  const modules: Record&lt;string, any&gt; = i<wbr>mport.meta.glob(&#39;../router/main/**/*.ts&#39;, { eager: true })

  // 2.遍历所有的模板为路由对象
  const routes: RouteRecordRaw[] = []
  for (const key in modules) {
    const route = modules[key].default
    routes.push(route)
  }
  return routes
}

// 记录第一个菜单信息
export let firstMenu: any = null
/**
 * 映射菜单到路由
 * @param menus 菜单
 * @returns 路由
 */
export function mapMenuToRoutes(menus: any[]) {
    // 1.加载所有的路由对象
    const loadRoutes = loadLocalRoutes()

    // 2.根据菜单获取需要添加的路由对象
    const finalRoutes: RouteRecordRaw[] = []
    for(const menu of menus) {
        for(const submenu of menu.children) {
            const route = loadRoutes.find(route =&gt; route.path === submenu.url)
            if(route) finalRoutes.push(route)

            // 记录第一个被匹配菜单
            if(!firstMenu &amp;&amp; route) firstMenu = submenu
        }
    }

    return finalRoutes
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="有弊端-登录时调用工具类" tabindex="-1"><a class="header-anchor" href="#有弊端-登录时调用工具类" aria-hidden="true">#</a> (有弊端)登录时调用工具类</h3><p>在发送登录请求时，使用<code>router.addRoute(&#39;main&#39;, route)</code>将菜单信息<code>userMenus</code>里的路由和全部注册进<code>loadLocalRoutes</code>匹配时调用。</p><p>弊端：刷新时路由注册不了，代码重新执行时，动态路由就加载不了，因为只有点击登录按钮时才会执行该代码。</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>// store/login/login.ts
interface ILoginState {
    // ...
    userMenus: any
}

const useLoginStore = defineStore(&#39;login&#39;, {
    state: (): ILoginState =&gt; ({
        // ...
        userMenus: localCache.getCache(&#39;userMenus&#39;) ?? []
    }),

    actions: {
        async loginAccountAction(account: IAccount) {
            // ...
            // 6.根据菜单menu动态加载路由(使用工具类map-menus.ts)，刷新时这段代码不会重新执行，因为只有点击登录按钮时才会执行该代码。
            const routes = mapMenuToRoutes(this.userMenus)
            // 这里的&#39;main&#39;是根据路由里的name属性来的
            routes.forEach(route =&gt; router.addRoute(&#39;main&#39;, route))

            //  页面跳转
            router.push(&#39;/main&#39;)
        }
    }
})

export default useLoginStore
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>router.addRoute(&#39;main&#39;, route)</code>里的 main 是需要在路由表中设置<code>name</code>属性。</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>const router = createRouter({
  history: createWebHashHistory(),
  routes: [
    // ...
    {
      path: &#39;/main&#39;,
      name: &#39;main&#39;,
      component: () =&gt; import(&#39;@/views/main/Main.vue&#39;),
      // 以下替换成动态注册路由的方法(也可以不使用工具类，在这里全部路由写死)
      // children: [
      //   {
      //     path: &#39;/main/analysis/overview&#39;,
      //     component: () =&gt; import(&#39;../views/main/analysis/overview/overview.vue&#39;)
      //   },
      //   {
      //     path: &#39;/main/analysis/dashboard&#39;,
      //     component: () =&gt; import(&#39;../views/main/analysis/dashboard/dashboard.vue&#39;)
      //   },
      // ]
    },
    // ....
  ]
})
export default router
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="改进-使用全局加载数据方法" tabindex="-1"><a class="header-anchor" href="#改进-使用全局加载数据方法" aria-hidden="true">#</a> (改进)使用全局加载数据方法</h3><p>不再仅限于在登录时调用<code>mapMenuToRoutes</code>工具类，而在全局当刷新页面时调用。</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>const useLoginStore = defineStore(&#39;login&#39;, {
    state: (): ILoginState =&gt; ({
        token: &#39;&#39;,
        userInfo: {},
        userMenus: []
    }),

    actions: {
        async loginAccountAction(account: IAccount) {
            // ....
            router.push(&#39;/main&#39;)
        },

        // 解决刷新页面后，动态路由丢失的问题(不再是loginAccountAction登录时才执行)
        loadLocalDataAction() {
            // 用户进行刷新时默认加载数据
            const token = localCache.getCache(&#39;token&#39;)
            const userInfo = localCache.getCache(&#39;userInfo&#39;)
            const userMenus = localCache.getCache(&#39;userMenus&#39;)

            if(token &amp;&amp; userInfo &amp;&amp; userMenus) {
                this.token = token
                this.userInfo = userInfo
                this.userMenus = userMenus
                // 6.根据菜单menu动态加载路由(使用工具类map-menus.ts)
                const routes = mapMenuToRoutes(userMenus)
                // 这里的&#39;main&#39;是根据路由里的name属性来的
                routes.forEach(route =&gt; router.addRoute(&#39;main&#39;, route))
            }
        }
    }
})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 App 组件中调用<code>loadLocalDataAction</code>方法，注意：此方法一定要放在<code>app.router</code>之前执行。</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>// App.vue
const app = createApp(App)
app.use(pinia)
const loginStore = useLoginStore()
loginStore.loadLocalDataAction()

app.use(router)
app.use(registerIcons)
app.mount(&#39;#app&#39;)

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以将<code>loadLocalDataAction</code>方法封装进<code>pinia</code>导出的地方，从而使用<code>app.use()</code>方法注册进全局 App 组件。</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>//store/index.js
import { createPinia } from &quot;pinia&quot;;
import useLoginStore from &quot;./login/login&quot;;

const pinia = createPinia()

function registerStore(app: App&lt;Element&gt;) {
    app.use(pinia)

    // 加载本地缓存数据
    const loginStore = useLoginStore()
    loginStore.loadLocalDataAction()
}

export default registerStore

// App.vue
import store from &#39;./store&#39;

app.use(store)
app.use(router)
app.use(registerIcons)
app.mount(&#39;#app&#39;)

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="进入主页时匹配第一个菜单" tabindex="-1"><a class="header-anchor" href="#进入主页时匹配第一个菜单" aria-hidden="true">#</a> 进入主页时匹配第一个菜单</h3><p>从<code>mapMenuToRoutes</code>工具类中获取<code>firstMenu</code>第一个菜单，在路由导航守卫中判断。</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>import { firstMenu } from &#39;@/utils/map-menus&#39;

const router = createRouter({
  history: createWebHashHistory(),
  routes: // ....
})

router.beforeEach((to, from) =&gt; {
  // ....
  if(to.path === &#39;/main&#39;) {
    return firstMenu.url
  }
})

export default router
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="刷新页面时-菜单默认值问题" tabindex="-1"><a class="header-anchor" href="#刷新页面时-菜单默认值问题" aria-hidden="true">#</a> 刷新页面时，菜单默认值问题</h3><p>根据路由的<code>url</code>路径，映射对应菜单<code>menu</code>（需要一个路由映射菜单的工具类），从而获得<code>menu</code>的<code>id</code>属性，将<code>el-menu</code>组件属性<code>:default-active=&quot;defaultValue&quot;</code>的<code>defaultValue</code>动态绑定给<code>menu.id</code>。</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>// utils/map-menus.ts
/**
 * 映射路由到菜单工具类
 * @param path 路由url
 * @param menus 菜单
 * @returns 菜单
 */
export function mapPathToMenu(menus: any[], path: string) {
    for (const menu of menus) {
      for (const submenu of menu.children) {
        if (path === submenu.url) return submenu
      }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>// main-menu.vue
&lt;template&gt;
  &lt;div class=&quot;main-menu&quot;&gt;
    // ....
    &lt;div class=&quot;menu&quot;&gt;
      &lt;el-menu
        :default-active=&quot;defaultValue&quot;
        // ....
      &gt;
      // .....
      &lt;/el-menu&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import { mapPathToMenu } from &#39;@/utils/map-menus&#39;;
// .....

// 1.存放动态的菜单
const loginStore = useLoginStore();
const userMenus = loginStore.userMenus

// 3.页面刷新时，根据当前的路由地址，设置默认选中的菜单项(默认值问题)
const route = useRoute()
const defaultValue = computed(() =&gt; {
  const currentMenu = mapPathToMenu(userMenus, route.path)
  return currentMenu.id + &#39;&#39;
})
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="实现面包屑功能" tabindex="-1"><a class="header-anchor" href="#实现面包屑功能" aria-hidden="true">#</a> 实现面包屑功能</h2><p><img src="https://secure2.wostatic.cn/static/97uxoUbD17xWuhYbrNVid1/image.png" alt=""></p><h3 id="搭建面包屑页面" tabindex="-1"><a class="header-anchor" href="#搭建面包屑页面" aria-hidden="true">#</a> 搭建面包屑页面</h3><p>使用<code>el-breadcrumb</code>搭建面包屑页面，使用工具类<code>mapPathToBreadCrumb</code>将菜单<code>menu</code>以及子菜单<code>submenu</code>放入<code>breadcrumb</code>数组，用于动态遍历<code>el-breadcrumb</code>。</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>// header-crumb.vue
&lt;template&gt;
  &lt;div class=&quot;header-crumb&quot;&gt;
    &lt;el-breadcrumb separator-icon=&quot;ArrowRight&quot;&gt;
        &lt;template v-for=&quot;(item, index) in breadcrumb&quot; :key=&quot;index&quot;&gt;
            &lt;el-breadcrumb-item :to=item.url&gt;{{ item.name }}&lt;/el-breadcrumb-item&gt;
        &lt;/template&gt;
    &lt;/el-breadcrumb&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { mapPathToBreadCrumb } from &#39;@/utils/map-menus&#39;
import { useRoute } from &#39;vue-router&#39;
import useLoginStore from &#39;@/store/login/login&#39;
import { computed } from &#39;vue&#39;

const route = useRoute()
const loginStore = useLoginStore()

// 路径改变时，重新计算面包屑
const breadcrumb = computed(() =&gt; {
    return mapPathToBreadCrumb(loginStore.userMenus, route.path)
})
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="路由映射面包屑工具类" tabindex="-1"><a class="header-anchor" href="#路由映射面包屑工具类" aria-hidden="true">#</a> 路由映射面包屑工具类</h3><p><code>mapPathToBreadCrumb</code>工具类</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>// map-menus.ts
export function mapPathToBreadCrumb(menus: any[], path: string) {
    const breadCrumb: any[] = []

    for (const menu of menus) {
      for (const submenu of menu.children) {
        if (path === submenu.url){
            breadCrumb.push(menu)
            breadCrumb.push(submenu)
            return breadCrumb
        }
      }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="解决点击面包屑跳到目录下的第一个子目录问题" tabindex="-1"><a class="header-anchor" href="#解决点击面包屑跳到目录下的第一个子目录问题" aria-hidden="true">#</a> 解决点击面包屑跳到目录下的第一个子目录问题</h3><p><code>el-breadcrumb</code>的<code>:to=item.url</code>属性问题，修改工具类<code>mapMenuToRoutes</code>将根目录路径重定向到根目录下的第一个子目录。</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>export function mapMenuToRoutes(menus: any[]) {
    // ...
    const finalRoutes: RouteRecordRaw[] = []
    for(const menu of menus) {
        for(const submenu of menu.children) {
            // ....
            if(route) {
                // 给route的顶层菜单增加重定向功能（但是只需要添加一次即可）
                if(!finalRoutes.find((item) =&gt; item.path === route.path)) {
                    finalRoutes.push({ path: menu.url, redirect: route})
                }
                finalRoutes.push(route)
            }
            // 记录第一个被匹配菜单
            if(!firstMenu &amp;&amp; route) firstMenu = submenu
        }
    }

    return finalRoutes
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="实现主页中部-main-页面" tabindex="-1"><a class="header-anchor" href="#实现主页中部-main-页面" aria-hidden="true">#</a> 实现主页中部 main 页面</h2><p>主体页面<code>main</code>中包括三个部分表达搜索框<code>search</code>、内容部分的头部及表格数据。</p><h3 id="实现-search-表单搜索框界面" tabindex="-1"><a class="header-anchor" href="#实现-search-表单搜索框界面" aria-hidden="true">#</a> 实现 search 表单搜索框界面</h3><p><img src="https://secure2.wostatic.cn/static/oeywjBVRfpkUuQSiZSgj8M/image.png" alt=""></p><h4 id="搭建静态-search-表单搜索框界面" tabindex="-1"><a class="header-anchor" href="#搭建静态-search-表单搜索框界面" aria-hidden="true">#</a> 搭建静态 search 表单搜索框界面</h4><p>通过<code>layout</code>布局组件中的<code>el-row</code>和<code>el-col</code>对每行每列做布局，使用<code>el-form</code>表单组件包含的<code>el-input</code>输入框、<code>el-select</code>下拉选择以及<code>el-date-picker</code>日期选择器实现。</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>// user/cpns/user-search.vue
&lt;template&gt;
  &lt;div class=&quot;search&quot;&gt;
    &lt;el-form label-width=&quot;120px&quot; size=&quot;large&quot;&gt;
        &lt;el-row :gutter=&quot;20&quot;&gt;
            &lt;el-col :span=&quot;8&quot;&gt;
                &lt;el-form-item label=&quot;用户名&quot;&gt;
                    &lt;el-input placeholder=&quot;请输入查询的用户名&quot;&gt;&lt;/el-input&gt;
                &lt;/el-form-item&gt;
            &lt;/el-col&gt;
            &lt;el-col :span=&quot;8&quot;&gt;
                &lt;el-form-item label=&quot;真实姓名&quot;&gt;
                    &lt;el-input placeholder=&quot;请输入查询的真实姓名&quot;&gt;&lt;/el-input&gt;
                &lt;/el-form-item&gt;
            &lt;/el-col&gt;
            &lt;el-col :span=&quot;8&quot;&gt;
                &lt;el-form-item label=&quot;电话号码&quot;&gt;
                    &lt;el-input placeholder=&quot;请输入查询的电话号码&quot;&gt;&lt;/el-input&gt;
                &lt;/el-form-item&gt;
            &lt;/el-col&gt;

            &lt;!-- 另起一行 --&gt;
            &lt;el-col :span=&quot;8&quot;&gt;
                &lt;el-form-item label=&quot;状态&quot;&gt;
                    &lt;el-select placeholder=&quot;请选择查询的状态&quot; style=&quot;width: 100%;&quot;&gt;
                        &lt;el-option label=&quot;启用&quot; :value=&quot;1&quot; /&gt;
                        &lt;el-option label=&quot;禁用&quot; :value=&quot;0&quot; /&gt;
                    &lt;/el-select&gt;
                &lt;/el-form-item&gt;
            &lt;/el-col&gt;
            &lt;el-col :span=&quot;8&quot;&gt;
                &lt;el-form-item label=&quot;创建时间&quot;&gt;
                    &lt;el-date-picker
                        type=&quot;daterange&quot;
                        range-separator=&quot;-&quot;
                        start-placeholder=&quot;开始时间&quot;
                        end-placeholder=&quot;结束时间&quot;
                    /&gt;
                &lt;/el-form-item&gt;
            &lt;/el-col&gt;
        &lt;/el-row&gt;
    &lt;/el-form&gt;

    &lt;div class=&quot;btns&quot;&gt;
        &lt;el-button icon=&quot;Refresh&quot; size=&quot;large&quot;&gt;重置&lt;/el-button&gt;
        &lt;el-button icon=&quot;Search&quot; size=&quot;large&quot; type=&quot;primary&quot;&gt;搜索&lt;/el-button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;

&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;
.search {
    background-color: #fff;
    padding: 20px;

    .el-form-item {
        padding: 20px;
        margin-bottom: 0;
    }

    .btns {
        text-align: right;
        padding: 0 50px 10px 0;
    }
}
&lt;/style&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对日期选择器里的日期实现国际化。<a href="https://element-plus.gitee.io/zh-CN/guide/i18n.html" target="_blank" rel="noopener noreferrer">Element Plus<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 提供了一个 Vue 组件 <a href="https://element-plus.gitee.io/en-US/component/config-provider.html" target="_blank" rel="noopener noreferrer">ConfigProvider<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> （<code>el-config-provider</code>）用于全局配置国际化的设置。（需要包裹 App 组件）并在<code>env.d.ts</code>中声明<code>.mjs</code>文件</p><div class="language-Vue ext-Vue line-numbers-mode"><pre class="language-Vue"><code>// App.vue
&lt;template&gt;
    &lt;div class=&quot;app&quot;&gt;
      &lt;!-- 国际化配置（将组件中的英文转为中文-&gt;日期组件） --&gt;
      &lt;el-config-provider :locale=&quot;zhCn&quot;&gt;
        &lt;router-view /&gt;
      &lt;/el-config-provider&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import zhCn from &#39;element-plus/dist/locale/zh-cn.mjs&#39;
&lt;/script&gt;

// env.d.ts
declare module &#39;*.vue&#39; {
    import { DefineComponent } from &#39;vue&#39;
    const component: DefineComponent
    export default component
}

// 声明国际化配置文件mjs
declare module &#39;*.mjs&#39;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="实现重置功能" tabindex="-1"><a class="header-anchor" href="#实现重置功能" aria-hidden="true">#</a> 实现重置功能</h4><p><code>el-form</code>表单组件要想输入值，需要使用<code>reactive()</code>和<code>:model</code>绑定值，并且在相应的组件如<code>el-input</code>使用<code>v-model</code>绑定<code>reactive</code>里面对应的值。重置值调用<code>formRef.value?.resetFields()</code>方法（<code>formRef</code>绑定到<code>el-form</code>上，<code>el-form-item</code>上添加属性<code>prop=&quot;xxx&quot;</code>即可实现）</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;template&gt;
  &lt;div class=&quot;search&quot;&gt;
    &lt;el-form **:model=&quot;searchForm&quot; ref=&quot;formRef&quot;** label-width=&quot;120px&quot; size=&quot;large&quot;&gt;
        &lt;el-row :gutter=&quot;20&quot;&gt;
            &lt;el-col :span=&quot;8&quot;&gt;
                &lt;el-form-item label=&quot;用户名&quot; prop=&quot;name&quot;&gt;
                    &lt;el-input **v-model=&quot;searchForm.name&quot;** placeholder=&quot;请输入查询的用户名&quot;&gt;&lt;/el-input&gt;
                &lt;/el-form-item&gt;
            &lt;/el-col&gt;
       &lt;/el-row&gt;
    &lt;/el-form&gt;
    // ....
    &lt;div class=&quot;btns&quot;&gt;
        &lt;el-button icon=&quot;Refresh&quot; size=&quot;large&quot; @click=&quot;handleResetClick()&quot;&gt;重置&lt;/el-button&gt;
        &lt;el-button icon=&quot;Search&quot; size=&quot;large&quot; type=&quot;primary&quot;&gt;搜索&lt;/el-button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import { reactive, ref } from &quot;vue&quot;;
import type { ElForm } from &quot;element-plus&quot;;

const searchForm = reactive({
    name: &#39;&#39;,
    realname: &#39;&#39;,
    cellphone: &#39;&#39;,
    enable: 1,
    createAt: &#39;&#39;
})

// 重置功能
const formRef = ref&lt;InstanceType&lt;typeof ElForm&gt;&gt;()
function handleResetClick() {
    // 方法一
    // searchForm.name = &#39;&#39;
    // searchForm.realname = &#39;&#39;
    // searchForm.cellphone = &#39;&#39;
    // searchForm.enable = 1
    // searchForm.createAt = &#39;&#39;

    // 方法二
    formRef.value?.resetFields()
}
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现展示用户列表功能" tabindex="-1"><a class="header-anchor" href="#实现展示用户列表功能" aria-hidden="true">#</a> 实现展示用户列表功能</h3><p><img src="https://secure2.wostatic.cn/static/hvmWHgnMCqqF1hKgZT64pQ/image.png" alt=""></p><h4 id="使用-pinia-发起获取用户数据请求" tabindex="-1"><a class="header-anchor" href="#使用-pinia-发起获取用户数据请求" aria-hidden="true">#</a> 使用 pinia 发起获取用户数据请求</h4><p>编写<code>axios</code>请求接口（使用了<code>hyRequest</code>进行了封装，直接调用即可）</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>import hyRequest from &quot;@/service&quot;;

// 获取用户列表数据
export function getUserListData() {
    return hyRequest.post({
        url: &#39;/users/list&#39;,
        data: {
            offset: 0,
            size: 10
        }
    })
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编写<code>pinia</code>进行数据存储</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>import { getUserListData } from &quot;@/service/main/system/system&quot;;
import { defineStore } from &quot;pinia&quot;;
import type { ISystemState } from &quot;./type&quot;;

const useSystemStore = defineStore(&#39;system&#39;, {
    // 使用typescript进行类型限制
    state: (): **ISystemState** =&gt; ({
        usersList: [],
        usersTotalCount: 0
    }),
    actions: {
        async getUsersListAction() {
            // 调用axios请求
            const userListResult = await getUserListData()
            const { totalCount, list } = userListResult.data
            // 存入store中
            this.usersList = list
            this.usersTotalCount = totalCount
        }
    }
})

export default useSystemStore
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用<code>typescript</code>进行类型限制</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// type.ts
export interface IUser {
    id: number
    name: string
    realname: string
    cellphone: number
    enable: number
    departmentId: number
    roleId: number
    createAt: string
    updateAt: string
}

export interface ISystemState {
    usersList: IUser[]
    usersTotalCount: number
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用户列表页面（<code>user-content.vue</code>）中调用<code>pinia</code>中的<code>getUsersListAction</code>，从而发起请求。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// user-content.vue
&lt;script setup&gt;
import useSystemStore from &#39;@/store/main/system/system&#39;;
import { storeToRefs } from &#39;pinia&#39;;

// 1.发起action，请求usersList数据
const systemStore = useSystemStore()
systemStore.getUsersListAction()

// 2.获取usersList数据(响应式数据：上面代码是异步的，当数据还没拿到是，这一句不起作用，需要用storeToRefs)
const { usersList } = storeToRefs(systemStore)
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="初步搭建表格数据页面" tabindex="-1"><a class="header-anchor" href="#初步搭建表格数据页面" aria-hidden="true">#</a> 初步搭建表格数据页面</h4><p>使用<code>el-table</code>及<code>el-table-column</code>搭建表格数据页面，<code>prop</code>对应请求数据中相应的属性，<code>type</code>为<code>selection</code>展示勾选框，<code>type</code>为<code>index</code>展示索引值。<code>el-table-column</code>可作为插槽传入其它组件，<code>:data</code>传入请求返回的数据。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;template&gt;
    &lt;div class=&quot;content&quot;&gt;
      &lt;div class=&quot;header&quot;&gt;
        &lt;h2 class=&quot;title&quot;&gt;用户列表&lt;/h2&gt;
        &lt;el-button type=&quot;primary&quot;&gt;新建用户&lt;/el-button&gt;
      &lt;/div&gt;
      &lt;div class=&quot;table&quot;&gt;
        &lt;el-table :data=&quot;usersList&quot; border style=&quot;width: 100%&quot;&gt;
            &lt;!-- 勾选框 --&gt;
            &lt;el-table-column align=&quot;center&quot; type=&quot;selection&quot; width=&quot;50px&quot;/&gt;
            &lt;!-- 序号 --&gt;
            &lt;el-table-column align=&quot;center&quot; type=&quot;index&quot; label=&quot;序号&quot; width=&quot;60px&quot;/&gt;

            &lt;el-table-column align=&quot;center&quot; prop=&quot;name&quot; label=&quot;用户名&quot; width=&quot;150px&quot; /&gt;
            &lt;el-table-column align=&quot;center&quot; prop=&quot;realname&quot; label=&quot;真实姓名&quot; width=&quot;150px&quot;/&gt;
            &lt;el-table-column align=&quot;center&quot; prop=&quot;cellphone&quot; label=&quot;电话号码&quot; width=&quot;150px&quot;/&gt;
            &lt;el-table-column align=&quot;center&quot; prop=&quot;enable&quot; label=&quot;状态&quot; width=&quot;100px&quot;/&gt;
            &lt;el-table-column align=&quot;center&quot; prop=&quot;createAt&quot; label=&quot;创建时间&quot; /&gt;
            &lt;el-table-column align=&quot;center&quot; prop=&quot;updateAt&quot; label=&quot;更新时间&quot; /&gt;

            &lt;el-table-column align=&quot;center&quot; label=&quot;操作&quot; width=&quot;150px&quot;&gt;
                &lt;el-button type=&quot;primary&quot; icon=&quot;Edit&quot; size=&quot;small&quot; text&gt;编辑&lt;/el-button&gt;
                &lt;el-button type=&quot;danger &quot; icon=&quot;Delete&quot; size=&quot;small&quot; text&gt;删除&lt;/el-button&gt;
            &lt;/el-table-column&gt;
        &lt;/el-table&gt;
      &lt;/div&gt;
      &lt;div class=&quot;pagination&quot;&gt;分页&lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import useSystemStore from &#39;@/store/main/system/system&#39;;
import { storeToRefs } from &#39;pinia&#39;;

// 1.发起action，请求usersList数据
const systemStore = useSystemStore()
systemStore.getUsersListAction()

// 2.获取usersList数据(响应式数据：上面代码是异步的，当数据还没拿到是，这一句不起作用，需要用storeToRefs)
const { usersList } = storeToRefs(systemStore)
console.log(usersList);
&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;
.content {
    margin-top: 20px;
    padding: 20px;
    background-color: #fff;
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;

    .title {
        font-size: 22px;
    }
}

.table {
    :deep(.el-table__cell) {
        padding: 12px 0;
    }

    .el-button {
        margin-left: 0;
        padding: 5px 8px;
    }
}

&lt;/style&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="使用作用域插槽处理表格数据中的状态以及时间格式化" tabindex="-1"><a class="header-anchor" href="#使用作用域插槽处理表格数据中的状态以及时间格式化" aria-hidden="true">#</a> 使用作用域插槽处理表格数据中的状态以及时间格式化</h4><p>科普：作用域插槽（子组件提供内容（数据），在父组件中展示，延伸了子组件的作用域），插槽（父组件提供内容，在子组件中展示）</p><p><strong>处理状态属性</strong></p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// ....
&lt;el-table-column align=&quot;center&quot; prop=&quot;enable&quot; label=&quot;状态&quot; width=&quot;100px&quot;&gt;
    &lt;!-- 作用域插槽 --&gt;
    &lt;template #default=&quot;{ row }&quot;&gt;
        &lt;el-button size=&quot;small&quot; :type=&quot;row.enable ? &#39;primary&#39; : &#39;danger&#39;&quot; plain&gt;
            {{ row.enable ? &#39;启用&#39; : &#39;禁用&#39; }}
        &lt;/el-button&gt;
    &lt;/template&gt;
    //&lt;template #default=&quot;scope&quot;&gt;
    //    &lt;el-button size=&quot;small&quot; :type=&quot;scope.row.enable ? &#39;primary&#39; : &#39;danger&#39;&quot; plain&gt;
    //        {{ scope.row.enable ? &#39;启用&#39; : &#39;禁用&#39; }}
    //    &lt;/el-button&gt;
    //&lt;/template&gt;
&lt;/el-table-column&gt;
// ....
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>处理时间格式</strong></p><p>安装 dayjs：<code>npm install dayjs</code></p><p>封装时间格式化工具<code>format.ts</code></p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>import dayjs from &#39;dayjs&#39;
import utc from &#39;dayjs/plugin/utc&#39;

dayjs.extend(utc)

export function formatUTC(utcString: string, format = &#39;YYYY-MM-DD HH:mm:ss&#39;) {
    // utcOffset东八区偏移8小时
    return dayjs.utc(utcString).utcOffset(8).format(format)
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在作用域插槽中使用<code>formatUTC</code></p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// ...
&lt;el-table-column align=&quot;center&quot; prop=&quot;createAt&quot; label=&quot;创建时间&quot; &gt;
    &lt;template #default=&quot;scope&quot;&gt;
        {{ formatUTC(scope.row.createAt) }}
    &lt;/template&gt;
&lt;/el-table-column&gt;
// ...
&lt;script&gt;
import { formatUTC } from &#39;@/utils/format&#39;;
// ...
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现分页功能" tabindex="-1"><a class="header-anchor" href="#实现分页功能" aria-hidden="true">#</a> 实现分页功能</h3><p><img src="https://secure2.wostatic.cn/static/wdmWHB3M9KTmPDFXj5Wve6/image.png" alt=""></p><h4 id="从请求接口中获取offset和size分页数据。" tabindex="-1"><a class="header-anchor" href="#从请求接口中获取offset和size分页数据。" aria-hidden="true">#</a> 从请求接口中获取<code>offset</code>和<code>size</code>分页数据。</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>import hyRequest from &quot;@/service&quot;;

// 获取用户列表数据
export function getUserListData(queryInfo: any) {
    return hyRequest.post({
        url: &#39;/users/list&#39;,
        data: queryInfo
    })
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="参数传递" tabindex="-1"><a class="header-anchor" href="#参数传递" aria-hidden="true">#</a> 参数传递</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>const useSystemStore = defineStore(&#39;system&#39;, {
    // ...
    actions: {
        async getUsersListAction(queryInfo: any) {
            // 调用axios请求
            const userListResult = await getUserListData(queryInfo)
            const { totalCount, list } = userListResult.data
            // ...
        }
    }
})
export default useSystemStore
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="使用el-pagination完成页面搭建。" tabindex="-1"><a class="header-anchor" href="#使用el-pagination完成页面搭建。" aria-hidden="true">#</a> 使用<code>el-pagination</code>完成页面搭建。</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// user-content.vue
// ....
&lt;div class=&quot;pagination&quot;&gt;
  &lt;el-pagination
      v-model:current-page=&quot;currentPage&quot;
      v-model:page-size=&quot;pageSize&quot;
      :page-sizes=&quot;[10, 20, 30]&quot;
      :small=&quot;small&quot;
      layout=&quot;sizes, prev, pager, next, jumper, total&quot;
      :total=&quot;usersTotalCount&quot;
      @size-change=&quot;handleSizeChange&quot;
      @current-change=&quot;handleCurrentChange&quot;
  /&gt;
&lt;/div&gt;

&lt;script setup&gt;
import { ref } from &#39;vue&#39;;

// 1.发起action，请求usersList和分页数据
const systemStore = useSystemStore()
const currentPage = ref(1)
const pageSize = ref(10)
fetchUserListData()

// 2.获取usersList和usersTotalCount数据(响应式数据：上面代码是异步的，当数据还没拿到是，这一句不起作用，需要用storeToRefs)
const { usersList, usersTotalCount } = storeToRefs(systemStore)

// 3.分页功能
function handleSizeChange() {
    fetchUserListData()
}

function handleCurrentChange() {
    fetchUserListData()
}

// 4.定义函数，用于发送网络请求
function fetchUserListData() {
    const size = pageSize.value
    const offset = (currentPage.value - 1) * size
    const info = { size, offset}

    // 发起网络请求
    systemStore.getUsersListAction(info)
}
&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;
.pagination {
    display: flex;
    justify-content: flex-end;
    margin-top: 10px;
}
&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现查询用户功能" tabindex="-1"><a class="header-anchor" href="#实现查询用户功能" aria-hidden="true">#</a> 实现查询用户功能</h3><p><img src="https://secure2.wostatic.cn/static/ZU6FzP3sKV8Sdjrqc8PYh/image.png" alt=""></p><h4 id="通过事件将表单内容传递给父组件" tabindex="-1"><a class="header-anchor" href="#通过事件将表单内容传递给父组件" aria-hidden="true">#</a> 通过事件将表单内容传递给父组件</h4><p>子传父：使用<code>const emit = defineEmits(&#39;xxx&#39;)</code>，<code>emit(&#39;xxx&#39;)</code></p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// user-search.vue
&lt;template&gt;
    // ...
    &lt;div class=&quot;btns&quot;&gt;
        &lt;el-button icon=&quot;Refresh&quot; size=&quot;large&quot; @click=&quot;handleResetClick()&quot;&gt;重置&lt;/el-button&gt;
        &lt;el-button icon=&quot;Search&quot; size=&quot;large&quot; type=&quot;primary&quot; @click = &quot;handleQueryClick()&quot;&gt;搜索&lt;/el-button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import { reactive, ref } from &quot;vue&quot;;
import type { ElForm } from &quot;element-plus&quot;;

const emit = defineEmits([&#39;queryClick&#39;, &#39;resetClick&#39;])

const searchForm = reactive({
    name: &#39;&#39;,
    realname: &#39;&#39;,
    cellphone: &#39;&#39;,
    enable: 1,
    createAt: &#39;&#39;
})
// 重置功能
// ...

// 搜索功能
function handleQueryClick() {
    // 通过事件抛出（子传父）
    emit(&#39;queryClick&#39;, searchForm)
}
&lt;/script&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="父组件接受事件并调用另一个子组件暴露的函数" tabindex="-1"><a class="header-anchor" href="#父组件接受事件并调用另一个子组件暴露的函数" aria-hidden="true">#</a> 父组件接受事件并调用另一个子组件暴露的函数</h4><p>子传父也可以用<code>defineExpose()</code>，这里<code>user-content</code>子组件使用此函数接受父组件（由<code>user-search</code>传过来）传过来的<code>searchForm</code>信息。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// user.vue
&lt;template&gt;
  &lt;div class=&quot;user&quot;&gt;
    &lt;user-search @query-click=&quot;handleQueryClick&quot; @reset-click=&quot;handleResetClick&quot;/&gt;
    &lt;user-content ref=&quot;contentRef&quot;/&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import { ref } from &#39;vue&#39;
import userContent from &#39;./cpns/user-content.vue&#39;
import userSearch from &#39;./cpns/user-search.vue&#39;

const contentRef = ref&lt;InstanceType&lt;typeof userContent&gt;&gt;()
function handleQueryClick(searchInfo: any) {
  contentRef.value?.fetchUserListData(searchInfo)
}

function handleResetClick() {
  contentRef.value?.fetchUserListData()
}
&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;

&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;template&gt;
  // ...
&lt;/template&gt;

&lt;script setup&gt;
// ...
// 4.定义函数，用于发送网络请求
function fetchUserListData(formData: any = {}) {
    const size = pageSize.value
    const offset = (currentPage.value - 1) * size
    const pageInfo = { size, offset}

    const queryInfo = { ...formData, ...pageInfo }
    // 发起网络请求
    systemStore.getUsersListAction(queryInfo)
}

// 暴露函数给父组件
defineExpose({
    fetchUserListData
})
&lt;/script&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现删除用户功能" tabindex="-1"><a class="header-anchor" href="#实现删除用户功能" aria-hidden="true">#</a> 实现删除用户功能</h3><p><img src="https://secure2.wostatic.cn/static/aX3DHhVE3tdWi7KgXFukZ6/image.png" alt=""></p><p>通过作用域插槽获取当前点击删除按钮那一行的用户<code>id</code>，即<code>scope.row.id</code>，将<code>id</code>传入用户删除接口。</p><h4 id="封装删除用户数据接口" tabindex="-1"><a class="header-anchor" href="#封装删除用户数据接口" aria-hidden="true">#</a> 封装删除用户数据接口</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>import hyRequest from &quot;@/service&quot;;
// ...
// 删除用户数据
export function deleteUserData(id: number) {
    return hyRequest.delete({
        url: `/users/${id}`
    })
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="pinia-中调用接口的-actions" tabindex="-1"><a class="header-anchor" href="#pinia-中调用接口的-actions" aria-hidden="true">#</a> pinia 中调用接口的 actions</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>const useSystemStore = defineStore(&#39;system&#39;, {
    state: (): ISystemState =&gt; ({
        // ...
    }),
    actions: {
        // ...
        // 删除用户数据
        async deleteUserDataAction(id: number) {
            // 调用axios请求
            const res = await deleteUserData(id)
            // 重新请求数据刷新页面
            this.getUsersListAction({ offset: 0, size: 10 })
        }
    }
})

export default useSystemStore
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="页面中获取-id-传入-actions" tabindex="-1"><a class="header-anchor" href="#页面中获取-id-传入-actions" aria-hidden="true">#</a> 页面中获取 id 传入 actions</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;template&gt;
    &lt;div class=&quot;content&quot;&gt;
      // ...
      &lt;div class=&quot;table&quot;&gt;
        &lt;el-table :data=&quot;usersList&quot; border style=&quot;width: 100%&quot;&gt;
            // ...
            &lt;el-table-column align=&quot;center&quot; label=&quot;操作&quot; width=&quot;150px&quot;&gt;
                &lt;template #default=&quot;scope&quot;&gt;
                    &lt;el-button type=&quot;primary&quot; icon=&quot;Edit&quot; size=&quot;small&quot; text&gt;编辑&lt;/el-button&gt;
                    &lt;el-button type=&quot;danger&quot; icon=&quot;Delete&quot; size=&quot;small&quot; text @click=&quot;handleDeleteClick(scope.row.id)&quot;&gt;删除&lt;/el-button&gt;
                &lt;/template&gt;
            &lt;/el-table-column&gt;
        &lt;/el-table&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import useSystemStore from &#39;@/store/main/system/system&#39;;
// ...
const systemStore = useSystemStore()

// 删除用户数据
function handleDeleteClick(id) {
    systemStore.deleteUserDataAction(id)
}

&lt;/script&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现新增用户功能" tabindex="-1"><a class="header-anchor" href="#实现新增用户功能" aria-hidden="true">#</a> 实现新增用户功能</h3><p><img src="https://secure2.wostatic.cn/static/kiR4cMYTVrkxP3VvGP72Rz/image.png" alt=""></p><p>由于新建用户按钮在<code>user-content.vue</code>页面中，与<code>user-modal.vue</code>是兄弟组件，需要用到组件通信，由<code>user-content.vue</code>发起事件<code>defineEmits()</code></p><h4 id="初步搭建模态框页面" tabindex="-1"><a class="header-anchor" href="#初步搭建模态框页面" aria-hidden="true">#</a> 初步搭建模态框页面</h4><p>使用<code>el-dialog</code>组件实现，<code>v-model</code>绑定模态框的<code>dialogVisible</code>可见值，封装到函数中，将其暴露给父组件。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// user-modal.vue
&lt;template&gt;
  &lt;div class=&quot;modal&quot;&gt;
    &lt;el-dialog v-model=&quot;dialogVisible&quot; title=&quot;新建用户&quot; width=&quot;30%&quot; center&gt;
    &lt;div class=&quot;form&quot;&gt;
        &lt;el-form :model=&quot;formData&quot; label-width=&quot;80px&quot; size=&quot;large&quot;&gt;
            &lt;el-form-item label=&quot;用户名&quot; prop=&quot;name&quot;&gt;
                &lt;el-input v-model=&quot;formData.name&quot; placeholder=&quot;请输入用户名&quot;&gt;&lt;/el-input&gt;
            &lt;/el-form-item&gt;
            &lt;el-form-item label=&quot;真实姓名&quot; prop=&quot;realname&quot;&gt;
                &lt;el-input v-model=&quot;formData.realname&quot; placeholder=&quot;请输入真实姓名&quot;&gt;&lt;/el-input&gt;
            &lt;/el-form-item&gt;
            &lt;el-form-item label=&quot;密码&quot; prop=&quot;password&quot;&gt;
                &lt;el-input v-model=&quot;formData.password&quot; placeholder=&quot;请输入密码&quot; show-password&gt;&lt;/el-input&gt;
            &lt;/el-form-item&gt;
            &lt;el-form-item label=&quot;电话号码&quot; prop=&quot;cellphone&quot;&gt;
                &lt;el-input v-model=&quot;formData.cellphone&quot; placeholder=&quot;请输入电话号码&quot;&gt;&lt;/el-input&gt;
            &lt;/el-form-item&gt;
            &lt;el-form-item label=&quot;选择角色&quot; prop=&quot;roleId&quot;&gt;
                &lt;el-select v-model=&quot;formData.roleId&quot; placeholder=&quot;请选择角色&quot; style=&quot;width: 100%&quot;&gt;&lt;/el-select&gt;
            &lt;/el-form-item&gt;
            &lt;el-form-item label=&quot;选择部门&quot; prop=&quot;departmentId&quot;&gt;
                &lt;el-select v-model=&quot;formData.departmentId&quot; placeholder=&quot;请选择部门&quot; style=&quot;width: 100%&quot;&gt;&lt;/el-select&gt;
            &lt;/el-form-item&gt;
        &lt;/el-form&gt;
    &lt;/div&gt;
    &lt;template #footer&gt;
      &lt;span class=&quot;dialog-footer&quot;&gt;
        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取消&lt;/el-button&gt;
        &lt;el-button type=&quot;primary&quot; @click=&quot;dialogVisible = false&quot;&gt;确定&lt;/el-button&gt;
      &lt;/span&gt;
    &lt;/template&gt;
  &lt;/el-dialog&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import { reactive, ref } from &quot;vue&quot;;

const dialogVisible = ref(false)
const formData = reactive({
    name: &#39;&#39;,
    realname: &#39;&#39;,
    password: &#39;&#39;,
    cellphone: &#39;&#39;,
    roleId: &#39;&#39;,
    departmentId: &#39;&#39;
})

function setDialogVisible() {
  dialogVisible.value = true
}

defineExpose({
    setDialogVisible
})
&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;

&lt;/style&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>点击新建用户按钮发起组件通信</strong></p><p>使用<code>defineEmits</code>发起点击事件传递给父组件<code>user.vue</code>。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// user-content.vue
&lt;template&gt;
    &lt;div class=&quot;content&quot;&gt;
      &lt;div class=&quot;header&quot;&gt;
        &lt;h2 class=&quot;title&quot;&gt;用户列表&lt;/h2&gt;
        &lt;el-button type=&quot;primary&quot; @click=&quot;handleNewData&quot;&gt;新建用户&lt;/el-button&gt;
      &lt;/div&gt;
      &lt;div class=&quot;table&quot;&gt;
        &lt;el-table :data=&quot;usersList&quot; border style=&quot;width: 100%&quot;&gt;
           // ...
        &lt;/el-table&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
// ...
const emit = defineEmits([&#39;newDataClick&#39;])

// 6.新建用户功能
function handleNewData() {
    emit(&#39;newDataClick&#39;)
}
&lt;/script&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>父组件获取事件</strong></p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// user.vue
&lt;template&gt;
  &lt;div class=&quot;user&quot;&gt;
    // ...
    &lt;user-content ref=&quot;contentRef&quot; @new-data-click=&quot;handleNewDataClick&quot;/&gt;
    &lt;user-modal ref=&quot;modalRef&quot;/&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import userModal from &#39;./cpns/user-modal.vue&#39;

const modalRef = ref&lt;InstanceType&lt;typeof userModal&gt;&gt;()

// 新增用户功能
function handleNewDataClick() {
  modalRef.value?.setDialogVisible()
}
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="全局封装获取角色和部门的请求接口数据" tabindex="-1"><a class="header-anchor" href="#全局封装获取角色和部门的请求接口数据" aria-hidden="true">#</a> 全局封装获取角色和部门的请求接口数据</h4><p><code>service</code>层使用<code>hyRequest</code>封装接口。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// serivce/main.ts
import hyRequest from &quot;..&quot;;

export function getEntireRoles() {
    return hyRequest.post({
        url: &quot;/role/list&quot;
    })
}

export function getEntireDepartments() {
    return hyRequest.post({
        url: &quot;/department/list&quot;
    })
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>pinia</code>调用接口存储在本地<code>store</code>。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// store/main.ts
import { getEntireDepartments, getEntireRoles } from &quot;@/service/main/main&quot;;
import { defineStore } from &quot;pinia&quot;;

interface IMainState {
    entireRoles: any[]
    entireDepartments: any[]
}

const useMainStore = defineStore(&#39;main&#39;, {
    state: (): IMainState =&gt; ({
        entireRoles: [],
        entireDepartments: []
    }),
    actions: {
        async fetchEntireDataAction() {
            const rolesResult = await getEntireRoles()
            const departmentResult = await getEntireDepartments()
            this.entireRoles = rolesResult.data.list
            this.entireDepartments = departmentResult.data.list
        }
    }
})
export default useMainStore
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在登录<code>actions</code>中发起调用。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// store/login.ts
import useMainStore from &quot;../main/main&quot;;

interface ILoginState {
    token: string,
    userInfo: any,
    userMenus: any[]
}

const useLoginStore = defineStore(&#39;login&#39;, {
    state: (): ILoginState =&gt; ({
        token: &#39;&#39;,
        userInfo: {},
        userMenus: []
    }),
    actions: {
        async loginAccountAction(account: IAccount) {
            // ...

            // 6.请求所有roles/department数据(刷新时数据会消失)
            const mainStore = useMainStore()
            mainStore.fetchEntireDataAction()

            //  页面跳转
            router.push(&#39;/main&#39;)
        },

        // 解决刷新页面后，动态路由丢失的问题(不再是loginAccountAction登录时才执行)
        loadLocalDataAction() {
            // ...
            if(token &amp;&amp; userInfo &amp;&amp; userMenus) {
                // ...
                // 请求所有roles/department数据(刷新时数据不会消失，经常变化，不放缓存，刷新时请求最新的)
                const mainStore = useMainStore()
                mainStore.fetchEntireDataAction()
                // ...
            }
        }
    }
})

export default useLoginStore
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="处理角色和部门下拉框" tabindex="-1"><a class="header-anchor" href="#处理角色和部门下拉框" aria-hidden="true">#</a> 处理角色和部门下拉框</h4><p>在<code>el-select</code>中使用<code>v-for</code>循环遍历<code>el-option</code>，动态回显到<code>label</code>属性中。角色和部门数据从<code>pinia</code>中获取。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;template&gt;
  &lt;div class=&quot;modal&quot;&gt;
    &lt;el-dialog v-model=&quot;dialogVisible&quot; title=&quot;新建用户&quot; width=&quot;30%&quot; center&gt;
    &lt;div class=&quot;form&quot;&gt;
        &lt;el-form :model=&quot;formData&quot; label-width=&quot;80px&quot; size=&quot;large&quot;&gt;
            // ...
            &lt;el-form-item label=&quot;选择角色&quot; prop=&quot;roleId&quot;&gt;
                &lt;el-select v-model=&quot;formData.roleId&quot; placeholder=&quot;请选择角色&quot; style=&quot;width: 100%&quot;&gt;
                    &lt;template v-for=&quot;item in entireRoles&quot; :key=&quot;item.id&quot;&gt;
                        &lt;el-option :label=&quot;item.name&quot; :value=&quot;item.id&quot;/&gt;
                    &lt;/template&gt;
                &lt;/el-select&gt;
            &lt;/el-form-item&gt;
            &lt;el-form-item label=&quot;选择部门&quot; prop=&quot;departmentId&quot;&gt;
                &lt;el-select v-model=&quot;formData.departmentId&quot; placeholder=&quot;请选择部门&quot; style=&quot;width: 100%&quot;&gt;
                    &lt;template v-for=&quot;item in entireDepartments&quot; :key=&quot;item.id&quot;&gt;
                        &lt;el-option :label=&quot;item.name&quot; :value=&quot;item.id&quot;/&gt;
                    &lt;/template&gt;
                &lt;/el-select&gt;
            &lt;/el-form-item&gt;
        &lt;/el-form&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import useMainStore from &quot;@/store/main/main&quot;;
import { storeToRefs } from &quot;pinia&quot;;
// ...

// 获取roles/departments数据
const mainStore = useMainStore()
const { entireRoles, entireDepartments } = storeToRefs(mainStore)
// ...
&lt;/script&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="封装新建用户请求接口并调用" tabindex="-1"><a class="header-anchor" href="#封装新建用户请求接口并调用" aria-hidden="true">#</a> 封装新建用户请求接口并调用</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>//sevice/main/system/system.ts
import hyRequest from &quot;@/service&quot;;
// 获取用户列表数据...

// 删除用户数据...

// 新建用户数据
export function newUserData(userInfo: any) {
    return hyRequest.post({
        url: &#39;/users&#39;,
        data: userInfo
    })
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>import { deleteUserData, getUserListData, newUserData } from &quot;@/service/main/system/system&quot;;
// ...
const useSystemStore = defineStore(&#39;system&#39;, {
    state: (): ISystemState =&gt; ({
        usersList: [],
        usersTotalCount: 0
    }),
    actions: {
        // 获取用户数据列表...

        // 删除用户数据...

        // 新增用户数据
        async newUserDataAction(userInfo: any) {
            // 创建新的用户
            const newResult =  await newUserData(userInfo)
            // 重新发送请求数据刷新页面
            this.getUsersListAction({ offset: 0, size: 10 })
        }
    }
})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;template&gt;
  &lt;div class=&quot;modal&quot;&gt;
    &lt;el-dialog v-model=&quot;dialogVisible&quot; title=&quot;新建用户&quot; width=&quot;30%&quot; center&gt;
        &lt;div class=&quot;form&quot;&gt;
            // ...
        &lt;/div&gt;
        &lt;template #footer&gt;
            &lt;span class=&quot;dialog-footer&quot;&gt;
                &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取消&lt;/el-button&gt;
                &lt;el-button type=&quot;primary&quot; @click=&quot;handleConfirmClick&quot;&gt;确定&lt;/el-button&gt;
            &lt;/span&gt;
        &lt;/template&gt;
    &lt;/el-dialog&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script setup lang=&quot;ts&quot;&gt;
import useSystemStore from &quot;@/store/main/system/system&quot;;

const dialogVisible = ref(false)
const formData = reactive({
    name: &#39;&#39;,
    realname: &#39;&#39;,
    password: &#39;&#39;,
    cellphone: &#39;&#39;,
    roleId: &#39;&#39;,
    departmentId: &#39;&#39;
})

const systemStore = useSystemStore()
// ...

// dialog点击确定按钮逻辑
function handleConfirmClick() {
    // 关门dialog
    dialogVisible.value = false
    // 发送新建用户请求
    systemStore.newUserDataAction(formData)
}
&lt;/script&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现编辑用户功能" tabindex="-1"><a class="header-anchor" href="#实现编辑用户功能" aria-hidden="true">#</a> 实现编辑用户功能</h3><p><img src="https://secure2.wostatic.cn/static/2kTCgLjUXD2ooG3Tvr3TMx/image.png" alt=""></p><h4 id="封装修改用户请求接口" tabindex="-1"><a class="header-anchor" href="#封装修改用户请求接口" aria-hidden="true">#</a> 封装修改用户请求接口</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>import hyRequest from &quot;@/service&quot;;
// ...
// 编辑用户数据
export function editUserData(id: number, userInfo: any) {
    return hyRequest.patch({
        url: `/users/${id}`,
        data: userInfo
    })
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="pinia-中调用接口的-actions-1" tabindex="-1"><a class="header-anchor" href="#pinia-中调用接口的-actions-1" aria-hidden="true">#</a> pinia 中调用接口的 actions</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>import { deleteUserData, editUserData, getUserListData, newUserData } from &quot;@/service/main/system/system&quot;;

const useSystemStore = defineStore(&#39;system&#39;, {
    state: (): ISystemState =&gt; ({
        // ...
    }),
    actions: {
        // ...
        // 编辑用户数据
        async editUserDataAction(id: number, userInfo: any) {
            const editResult = await editUserData(id, userInfo)
            this.getUsersListAction({ offset: 0, size: 10 })
        }
    }
})

export default useSystemStore
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="实现点击编辑按钮弹出模态框" tabindex="-1"><a class="header-anchor" href="#实现点击编辑按钮弹出模态框" aria-hidden="true">#</a> 实现点击编辑按钮弹出模态框</h4><p>使用作用域插槽将子组件<code>user-content</code>的点击事件发送给父组件。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// user-content.vue
&lt;template&gt;
    &lt;div class=&quot;content&quot;&gt;
      // ...
      &lt;div class=&quot;table&quot;&gt;
        &lt;el-table :data=&quot;usersList&quot; border style=&quot;width: 100%&quot;&gt;
            // ...
            &lt;el-table-column align=&quot;center&quot; label=&quot;操作&quot; width=&quot;150px&quot;&gt;
                &lt;template #default=&quot;scope&quot;&gt;
                    &lt;el-button type=&quot;primary&quot; icon=&quot;Edit&quot; size=&quot;small&quot; text @click=&quot;handleEditClick(scope.row)&quot;&gt;编辑&lt;/el-button&gt;
                    &lt;el-button type=&quot;danger&quot; icon=&quot;Delete&quot; size=&quot;small&quot; text @click=&quot;handleDeleteClick(scope.row.id)&quot;&gt;删除&lt;/el-button&gt;
                &lt;/template&gt;
            &lt;/el-table-column&gt;
        &lt;/el-table&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
// ...
const emit = defineEmits([&#39;newDataClick&#39;, &#39;editDataClick&#39;])
// ...

// 7.编辑用户功能
function handleEditClick(itemData) {
    emit(&#39;editDataClick&#39;, itemData)
}
&lt;/script&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>父组件接受点击事件。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;template&gt;
  &lt;div class=&quot;user&quot;&gt;
    // ...
    &lt;user-content ref=&quot;contentRef&quot; @new-data-click=&quot;handleNewDataClick&quot; @edit-data-click=&quot;handleEditDataClick&quot;/&gt;
    &lt;user-modal ref=&quot;modalRef&quot;/&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import userModal from &#39;./cpns/user-modal.vue&#39;
// ...

const modalRef = ref&lt;InstanceType&lt;typeof userModal&gt;&gt;()
// ...
// 编辑用户功能
function handleEditDataClick(itemData: any) {
  // setDialogVisible由user-modal子组件暴露出来的方法
  modalRef.value?.setDialogVisible(false, itemData)
}
&lt;/script&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>子组件<code>user-modal</code>接受父组件传来的方法和参数。对模态框的表单内容进行判断，在编辑数据时除了密码，其它属性都进行回显，<code>title</code>变为编辑用户文本。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;template&gt;
  &lt;div class=&quot;modal&quot;&gt;
    &lt;el-dialog v-model=&quot;dialogVisible&quot; :title=&quot;isNewRef? &#39;新建用户&#39;: &#39;编辑用户&#39;&quot; width=&quot;30%&quot; center&gt;
        &lt;div class=&quot;form&quot;&gt;
            &lt;el-form :model=&quot;formData&quot; label-width=&quot;80px&quot; size=&quot;large&quot;&gt;
                // 编辑数据时密码不进行回显。
                &lt;el-form-item v-if=&quot;isNewRef&quot; label=&quot;密码&quot; prop=&quot;password&quot;&gt;
                    &lt;el-input v-model=&quot;formData.password&quot; placeholder=&quot;请输入密码&quot; show-password&gt;&lt;/el-input&gt;
                &lt;/el-form-item&gt;
                // ...
            &lt;/el-form&gt;
        &lt;/div&gt;
        &lt;template #footer&gt;
            &lt;span class=&quot;dialog-footer&quot;&gt;
                &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取消&lt;/el-button&gt;
                &lt;el-button type=&quot;primary&quot; @click=&quot;handleConfirmClick&quot;&gt;确定&lt;/el-button&gt;
            &lt;/span&gt;
        &lt;/template&gt;
    &lt;/el-dialog&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import useSystemStore from &quot;@/store/main/system/system&quot;;
// ...

const dialogVisible = ref(false)
// 编辑时密码不显示
const isNewRef = ref(false)
const editData = ref()

const formData = reactive&lt;any&gt;({
    name: &#39;&#39;,
    realname: &#39;&#39;,
    password: &#39;&#39;,
    cellphone: &#39;&#39;,
    roleId: &#39;&#39;,
    departmentId: &#39;&#39;
})

// ...
// 定义设置dialogVisible的方法
function setDialogVisible(isNew: boolean = true, itemData?: any) {
  dialogVisible.value = true
  isNewRef.value = isNew
  // 模态框表单回显
  if(!isNew &amp;&amp; itemData) {
    // 编辑数据
    for(const key in formData) {
        // key不一定在formData中,所以需要加类型判断any(reactive&lt;any&gt;)
        formData[key] = itemData[key]
    }
    editData.value = itemData
  } else {
    // 新增数据
    for(const key in formData) {
        formData[key] = &#39;&#39;
    }
    editData.value = null
  }
}

// dialog点击确定按钮逻辑
function handleConfirmClick() {
    // 关门dialog
    dialogVisible.value = false
    // isNewRef为false时，发送编辑用户请求
    if(!isNewRef.value &amp;&amp; editData.value) {
        systemStore.editUserDataAction(editData.value.id, formData)
    } else {
        // 否则发送新建用户请求
        systemStore.newUserDataAction(formData)
    }
}

// 暴露给父组件的方法
defineExpose({
    setDialogVisible
})
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="高级复用性代码抽取" tabindex="-1"><a class="header-anchor" href="#高级复用性代码抽取" aria-hidden="true">#</a> 高级复用性代码抽取</h2><p><strong>封装抽取成配置文件来实现，增强复用性。</strong></p><h3 id="封装网络请求" tabindex="-1"><a class="header-anchor" href="#封装网络请求" aria-hidden="true">#</a> 封装网络请求</h3><h4 id="抽取接口的公共特性" tabindex="-1"><a class="header-anchor" href="#抽取接口的公共特性" aria-hidden="true">#</a> 抽取接口的公共特性</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>/** 抽取公共页面接口 */
// 查询
export function getPageListData(pageName: string, queryInfo: any) {
    return hyRequest.post({
      url: `/${pageName}/list`,
      data: queryInfo
    })
}
// 删除
export function deletePageData(pageName: string, id: number) {
    return hyRequest.delete({
      url: `/${pageName}/${id}`
    })
}
// 新增
export function newPageData(pageName: string, dataInfo: any) {
  return hyRequest.post({
    url: `/${pageName}`,
    data: dataInfo
  })
}
// 修改
export function editPageData(pageName: string, id: number, dataInfo: any) {
  return hyRequest.patch({
    url: `/${pageName}/${id}`,
    data: dataInfo
  })
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="抽取-pinia-对应的-actions" tabindex="-1"><a class="header-anchor" href="#抽取-pinia-对应的-actions" aria-hidden="true">#</a> 抽取 pinia 对应的 actions</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>import { deleteUserData, editUserData, getUserListData, newUserData, deletePageData, editPageData, getPageListData, newPageData } from &quot;@/service/main/system/system&quot;;
import { defineStore } from &quot;pinia&quot;;
import type { ISystemState } from &quot;./type&quot;;

const useSystemStore = defineStore(&#39;system&#39;, {
    state: (): ISystemState =&gt; ({
        // 抽取公共页面数据
        pageList: [],
        pageTotalCount: 0
    }),
    actions: {
        // 抽取公共页面action
        async getPageListDataAction(pageName: string, queryInfo: any) {
            // 1.请求用户列表数据
            const pageListResult = await getPageListData(pageName, queryInfo)
            const { list, totalCount } = pageListResult.data
            this.pageList = list
            this.pageTotalCount = totalCount
        },
        async deletePageDataAction(pageName: string, id: number) {
            const res = await deletePageData(pageName, id)
            this.getPageListDataAction(pageName, { offset: 0, size: 10 })
        },
        async newPageDataAction(pageName: string, pageData: any) {
            const res = await newPageData(pageName, pageData)
            this.getPageListDataAction(pageName, { offset: 0, size: 10 })
        },
        async editPageDataAction(pageName: string, id: number, pageData: any) {
            const res = await editPageData(pageName, id, pageData)
            this.getPageListDataAction(pageName, { offset: 0, size: 10 })
        }

    }
})

export default useSystemStore
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>export interface ISystemState {
    // 抽取公共页面数据
    pageList: any[]
    pageTotalCount: number
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="封装表单搜索组件" tabindex="-1"><a class="header-anchor" href="#封装表单搜索组件" aria-hidden="true">#</a> 封装表单搜索组件</h3><p><img src="https://secure2.wostatic.cn/static/vwRrSUSNbjW7wAgWjK7gp9/image.png" alt=""></p><h4 id="编写表单搜索配置文件" tabindex="-1"><a class="header-anchor" href="#编写表单搜索配置文件" aria-hidden="true">#</a> 编写表单搜索配置文件</h4><p><code>search.config.ts</code></p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>const searchConfig = {
    labelWidth: &#39;120px&#39;,
    formItems: [
        {
            type: &#39;input&#39;,
            prop: &#39;name&#39;,
            label: &#39;部门名称&#39;,
            placeholder: &#39;请输入查询的部门名称&#39;
        },
        {
            type: &#39;input&#39;,
            prop: &#39;leader&#39;,
            label: &#39;部门领导&#39;,
            placeholder: &#39;请输入查询的领导名称&#39;,
            initialValue: &#39;张三&#39;
        },
        {
            type: &#39;select&#39;,
            prop: &#39;enable&#39;,
            label: &#39;状态&#39;,
            placeholder: &#39;请选择查询的状态&#39;,
            options: [
                { label: &#39;启用&#39;, value: 1 },
                { label: &#39;禁用&#39;, value: 0 }
            ]
        },
        {
            type: &#39;time&#39;,
            prop: &#39;createAt&#39;,
            label: &#39;创建时间&#39;
        }
    ]
}

export default searchConfig
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="重构表单搜索组件" tabindex="-1"><a class="header-anchor" href="#重构表单搜索组件" aria-hidden="true">#</a> 重构表单搜索组件</h4><p>将里面的具体的属性名称通过<code>search.config.ts</code>配置文件来动态遍历具体的属性和表单类型。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// page-search.vue
&lt;template&gt;
  &lt;div class=&quot;search&quot;&gt;
    &lt;el-form :model=&quot;searchForm&quot; ref=&quot;formRef&quot; :label-width=&quot;searchConfig.labelWidth ?? &#39;80px&#39;&quot; size=&quot;large&quot;&gt;
        &lt;el-row :gutter=&quot;20&quot;&gt;
            &lt;!-- 动态遍历配置config文件 --&gt;
            &lt;template v-for=&quot;item in searchConfig.formItems&quot; :key=&quot;item.prop&quot;&gt;
                &lt;el-col :span=&quot;8&quot;&gt;
                    &lt;el-form-item :label=&quot;item.label&quot; :prop=&quot;item.prop&quot;&gt;
                        &lt;template v-if=&quot;item.type === &#39;input&#39;&quot;&gt;
                            &lt;el-input v-model=&quot;searchForm[item.prop]&quot; :placeholder=&quot;item.placeholder&quot;&gt;&lt;/el-input&gt;
                        &lt;/template&gt;
                        &lt;template v-if=&quot;item.type === &#39;time&#39;&quot;&gt;
                            &lt;el-date-picker
                                v-model=&quot;searchForm[item.prop]&quot;
                                type=&quot;daterange&quot;
                                range-separator=&quot;-&quot;
                                start-placeholder=&quot;开始时间&quot;
                                end-placeholder=&quot;结束时间&quot;
                            /&gt;
                        &lt;/template&gt;
                        &lt;template v-if=&quot;item.type === &#39;select&#39;&quot;&gt;
                            &lt;el-select v-model=&quot;searchForm[item.prop]&quot; :placeholder=&quot;item.placeholder&quot; style=&quot;width: 100%&quot;&gt;
                                &lt;template v-for=&quot;option in item.options&quot; :key=&quot;option.value&quot;&gt;
                                    &lt;el-option :label=&quot;option.label&quot; :value=&quot;option.value&quot;&gt;&lt;/el-option&gt;
                                &lt;/template&gt;
                            &lt;/el-select&gt;
                        &lt;/template&gt;
                    &lt;/el-form-item&gt;
                &lt;/el-col&gt;
            &lt;/template&gt;
        &lt;/el-row&gt;
    &lt;/el-form&gt;

    &lt;div class=&quot;btns&quot;&gt;
        &lt;el-button icon=&quot;Refresh&quot; size=&quot;large&quot; @click=&quot;handleResetClick()&quot;&gt;重置&lt;/el-button&gt;
        &lt;el-button icon=&quot;Search&quot; size=&quot;large&quot; type=&quot;primary&quot; @click = &quot;handleQueryClick()&quot;&gt;搜索&lt;/el-button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import { reactive, ref } from &quot;vue&quot;;
import type { ElForm } from &quot;element-plus&quot;;

// 定义的参数需与配置文件中的参数一致
interface IProps {
    searchConfig: {
        labelWidth?: string,
        formItems: any[]
    }
}
// 接受父组件传来的配置参数
const props = defineProps&lt;IProps&gt;()

const emit = defineEmits([&#39;queryClick&#39;, &#39;resetClick&#39;])

const initialForm: any = {}
for(const item of props.searchConfig.formItems) {
    initialForm[item.prop] = item.initialValue ?? &#39;&#39;
}
const searchForm = reactive({
    initialForm
})

// 重置功能
const formRef = ref&lt;InstanceType&lt;typeof ElForm&gt;&gt;()
function handleResetClick() {
    formRef.value?.resetFields()
    // 发送请求重置查找
    emit(&#39;resetClick&#39;)
}

// 搜索功能
function handleQueryClick() {
    // 通过事件抛出（子传父）
    emit(&#39;queryClick&#39;, searchForm)
}
&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;
.search {
    background-color: #fff;
    padding: 20px;

    .el-form-item {
        padding: 20px;
        margin-bottom: 0;
    }

    .btns {
        text-align: right;
        padding: 0 50px 10px 0;
    }
}
&lt;/style&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="父组件引用配置文件" tabindex="-1"><a class="header-anchor" href="#父组件引用配置文件" aria-hidden="true">#</a> 父组件引用配置文件</h4><p>父组件传递参数为<code>search-config</code>给子组件。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// department.vue
&lt;template&gt;
  &lt;div class=&quot;department&quot;&gt;
    &lt;page-search :search-config=&quot;searchConfig&quot;/&gt;
    // ...
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot; name=&quot;department&quot;&gt;
import pageSearch from &#39;@/components/page-search/page-search.vue&#39;
import searchConfig from &#39;./config/search.config&#39;
// ...
&lt;/script&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="封装表格内容组件" tabindex="-1"><a class="header-anchor" href="#封装表格内容组件" aria-hidden="true">#</a> 封装表格内容组件</h3><p><img src="https://secure2.wostatic.cn/static/6zGDaiK1EqPzQCHsgAaWAT/image.png" alt=""></p><h4 id="编写表格内容配置文件" tabindex="-1"><a class="header-anchor" href="#编写表格内容配置文件" aria-hidden="true">#</a> 编写表格内容配置文件</h4><p><code>content.config.ts</code></p><p>针对不同类型的表格数据的作用域插槽，区分不同的<code>type</code>。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>const contentConfig = {
    pageName: &#39;Department&#39;,
    header: {
        title: &#39;部门列表&#39;,
        btnTitle: &#39;新建部门&#39;
    },
    propsList:[
        { type: &#39;selection&#39;, label: &#39;选择&#39;, width: &#39;80px&#39; },
        { type: &#39;index&#39;, label: &#39;序号&#39;, width: &#39;80px&#39; },

        { type: &#39;normal&#39;, prop: &#39;name&#39;, label: &#39;部门名称&#39;, width: &#39;150px&#39; },
        { type: &#39;normal&#39;, prop: &#39;leader&#39;, label: &#39;部门领导&#39;, width: &#39;150px&#39; },
        { type: &#39;normal&#39;, prop: &#39;parentId&#39;, label: &#39;上级部门&#39;, width: &#39;150px&#39; },

        { type: &#39;time&#39;, prop: &#39;createAt&#39;, label: &#39;创建时间&#39; },
        { type: &#39;time&#39;, prop: &#39;updateAt&#39;, label: &#39;更新时间&#39; },

        { type: &#39;handler&#39;, label: &#39;操作&#39;, width: &#39;180px&#39; },
    ]
}

export default contentConfig
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="重构表格内容组件" tabindex="-1"><a class="header-anchor" href="#重构表格内容组件" aria-hidden="true">#</a> 重构表格内容组件</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// page-content.vue
&lt;template&gt;
  &lt;div class=&quot;content&quot;&gt;
    &lt;div class=&quot;header&quot;&gt;
      &lt;h3 class=&quot;title&quot;&gt;{{ contentConfig?.header?.title ?? &#39;数据列表&#39; }}&lt;/h3&gt;
      &lt;el-button type=&quot;primary&quot; @click=&quot;handleNewData&quot;&gt;{{ contentConfig?.header?.btnTitle ?? &#39;新建数据&#39; }}&lt;/el-button&gt;
    &lt;/div&gt;
    &lt;div class=&quot;table&quot;&gt;
      &lt;el-table :data=&quot;pageList&quot; :border=&quot;true&quot; style=&quot;width: 100%&quot;&gt;
        &lt;template v-for=&quot;item in contentConfig.propsList&quot; :key=&quot;item.prop&quot;&gt;

          &lt;!-- 处理带自定义插槽的时间格式类型 --&gt;
          &lt;template v-if=&quot;item.type === &#39;time&#39;&quot;&gt;
            &lt;el-table-column align=&quot;center&quot; v-bind=&quot;item&quot;&gt;
              &lt;template #default=&quot;scope&quot;&gt;
                {{ formatUTC(scope.row[item.prop]) }}
              &lt;/template&gt;
            &lt;/el-table-column&gt;
          &lt;/template&gt;

          &lt;!-- 处理handle类型 --&gt;
          &lt;template v-else-if=&quot;item.type === &#39;handler&#39;&quot;&gt;
            &lt;el-table-column align=&quot;center&quot; v-bind=&quot;item&quot;&gt;
              &lt;template #default=&quot;scope&quot;&gt;
                &lt;el-button type=&quot;primary&quot; size=&quot;small&quot; icon=&quot;EditPen&quot; link @click=&quot;handleEditClick(scope.row)&quot;&gt;
                  编辑
                &lt;/el-button&gt;
                &lt;el-button type=&quot;danger&quot; size=&quot;small&quot; icon=&quot;Delete&quot; link @click=&quot;handleDeleteClick(scope.row.id)&quot;&gt;
                  删除
                &lt;/el-button&gt;
              &lt;/template&gt;
            &lt;/el-table-column&gt;
          &lt;/template&gt;

          &lt;!-- 处理普通类型 --&gt;
          &lt;template v-else&gt;
            &lt;!-- &lt;el-table-column align=&quot;center&quot; :type=&quot;item.type&quot; :prop=&quot;item.prop&quot; :label=&quot;item.label&quot; :width=&quot;item.width&quot; /&gt; 相当于下面--&gt;
            &lt;el-table-column align=&quot;center&quot; v-bind=&quot;item&quot; /&gt;
          &lt;/template&gt;
        &lt;/template&gt;
      &lt;/el-table&gt;
    &lt;/div&gt;
    &lt;div class=&quot;footer&quot;&gt;
      &lt;el-pagination
        v-model:currentPage=&quot;currentPage&quot;
        v-model:page-size=&quot;pageSize&quot;
        :page-sizes=&quot;[10, 20, 30]&quot;
        layout=&quot;total, sizes, prev, pager, next, jumper&quot;
        :total=&quot;pageTotalCount&quot;
        @current-change=&quot;handleCurrentChange&quot;
      /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot; name=&quot;content&quot;&gt;
import { storeToRefs } from &#39;pinia&#39;
import useSystemStore from &#39;@/store/main/system/system&#39;
import { formatUTC } from &#39;@/utils/format&#39;;
import { ref } from &#39;vue&#39;

interface IProps {
  contentConfig: {
    // 用于处理接口方法中传入的pageName参数
    pageName: string,
    header?: {
      title?: string,
      btnTitle: string
    },
    propsList: any[]
  }
}

const props = defineProps&lt;IProps&gt;()

const emit = defineEmits([&#39;newDataClick&#39;, &#39;editDataClick&#39;])

// 1.请求数据
const systemStore = useSystemStore()
const currentPage = ref(1)
const pageSize = ref(10)
function fetchPageListData(formData: any = {}) {
  // 1.获取offset和size
  const size = pageSize.value
  const offset = (currentPage.value - 1) * size
  const pageInfo = { size, offset}

  // 2.发起网络请求
  const queryInfo = { ...pageInfo, ...formData}
  // 从配置文件中获取pageName
  systemStore.getPageListDataAction(props.contentConfig.pageName, { offset, size, ...queryInfo })
}
fetchPageListData()

// 2.展示数据
const { pageList, pageTotalCount } = storeToRefs(systemStore)

// 3.绑定分页数据
function handleCurrentChange() {
  fetchPageListData()
}
function handleResetClick() {
  currentPage.value = 1
  pageSize.value = 10
  fetchPageListData()
}

// 4.新建数据的处理
function handleNewData() {
  emit(&#39;newDataClick&#39;)
}

// 5.删除和编辑操作
function handleDeleteClick(id: number) {
  // 从配置文件中获取pageName
  systemStore.deletePageDataAction(props.contentConfig.pageName, id)
}

function handleEditClick(data: any) {
  emit(&#39;editDataClick&#39;, data)
}

// 暴露函数
defineExpose({
  fetchPageListData,
  handleResetClick
})
&lt;/script&gt;

&lt;style scoped lang=&quot;less&quot;&gt;
.content {
  margin-top: 20px;
  padding: 20px;
  background-color: #fff;

  .header {
    display: flex;
    height: 45px;
    padding: 0 5px;
    justify-content: space-between;
    align-items: center;

    .title {
      font-size: 20px;
      font-weight: 700;
    }

    .handler {
      align-items: center;
    }
  }

  .table {
    :deep(.el-table__cell) {
      padding: 14px 0;
    }
  }

  .footer {
    display: flex;
    justify-content: flex-end;
    margin-top: 15px;
  }
}
&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="父组件引用配置文件-后面统一起来整理" tabindex="-1"><a class="header-anchor" href="#父组件引用配置文件-后面统一起来整理" aria-hidden="true">#</a> 父组件引用配置文件（后面统一起来整理）</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;template&gt;
  &lt;div class=&quot;department&quot;&gt;
    &lt;page-search @query-click=&quot;handleQueryClick&quot; @reset-click=&quot;handleResetClick&quot; :search-config=&quot;searchConfig&quot;/&gt;
    &lt;page-content ref=&quot;contentRef&quot; @new-data-click=&quot;handleNewDataClick&quot; @edit-data-click=&quot;handleEditDataClick&quot; :content-config=&quot;contentConfig&quot;/&gt;
    &lt;page-modal ref=&quot;modalRef&quot; /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot; name=&quot;department&quot;&gt;
import pageSearch from &#39;@/components/page-search/page-search.vue&#39;
import PageContent from &#39;@/components/page-content/page-content.vue&#39;
import PageModal from &#39;./cpns/page-modal.vue&#39;
import { ref } from &#39;vue&#39;

import searchConfig from &#39;./config/search.config&#39;
import contentConfig from &#39;./config/content.config&#39;

const contentRef = ref&lt;InstanceType&lt;typeof PageContent&gt;&gt;()
const modalRef = ref&lt;InstanceType&lt;typeof PageModal&gt;&gt;()
// 搜索功能
function handleQueryClick(searchInfo: any) {
  console.log(searchInfo);
  contentRef.value?.fetchPageListData(searchInfo)
}
// 重置功能
function handleResetClick() {
  contentRef.value?.fetchPageListData()
}
// 新增功能
function handleNewDataClick() {
  modalRef.value?.setDialogVisible()
}
// 编辑功能
function handleEditDataClick(itemData: any) {
  modalRef.value?.setDialogVisible(false, itemData)
}
&lt;/script&gt;

&lt;style scoped&gt;&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="进阶-封装自定义的定制作用域插槽" tabindex="-1"><a class="header-anchor" href="#进阶-封装自定义的定制作用域插槽" aria-hidden="true">#</a> (进阶)封装自定义的定制作用域插槽</h4><p>以上代码是通过不断的<code>if</code>判断 <code>&lt;template v-else-if=&quot;item.type === &#39;custom&#39;&quot;&gt;</code>，来处理不同类型（带有作用域插槽）的<code>table</code>数据，如图片、<code>el-tag</code>、<code>button</code>等。因此通过编写通用的自定义插槽来预留一个插槽<code>slot</code>给父组件，使用户可以定制<code>table</code>数据内容。</p><p><strong>配置文件</strong></p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>const contentConfig = {
    // ...
    propsList:[
        // ...
        // 自定义插槽定制（通用）
        { type: &#39;custom&#39;, label: &#39;自定义插槽1&#39;, prop: &#39;leader&#39;, width: &#39;150px&#39;, slotName: &#39;leader&#39;},
        { type: &#39;custom&#39;, label: &#39;自定义插槽2&#39;, prop: &#39;parentId&#39;, width: &#39;150px&#39;, slotName: &#39;parent&#39;},
    ]
}

export default contentConfig
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>自定义插槽的组件模版</strong></p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;template&gt;
  &lt;div class=&quot;content&quot;&gt;
    // ...
    &lt;div class=&quot;table&quot;&gt;
      &lt;el-table :data=&quot;pageList&quot; :border=&quot;true&quot; style=&quot;width: 100%&quot;&gt;
        &lt;template v-for=&quot;item in contentConfig.propsList&quot; :key=&quot;item.prop&quot;&gt;
          &lt;!-- 处理带自定义插槽的时间格式类型 --&gt;
          // ...
          &lt;!-- 处理handle类型 --&gt;
          // ....
          &lt;!-- 处理普通类型 --&gt;
          // ....

          &lt;!-- 自定义插槽定制处理(通用) --&gt;
          &lt;template v-else-if=&quot;item.type === &#39;custom&#39;&quot;&gt;
            &lt;el-table-column align=&quot;center&quot; v-bind=&quot;item&quot;&gt;
              &lt;template #default=&quot;scope&quot;&gt;
                &lt;!-- 给用户预留定制插槽 --&gt;
                &lt;slot :name=&quot;item.slotName&quot; v-bind=&quot;scope&quot; :prop=&quot;item.prop&quot;&gt;&lt;/slot&gt;
              &lt;/template&gt;
            &lt;/el-table-column&gt;
          &lt;/template&gt;

        &lt;/template&gt;

      &lt;/el-table&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>父组件编写定制插槽</strong></p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;template&gt;
  &lt;div class=&quot;department&quot;&gt;
    &lt;page-search @query-click=&quot;handleQueryClick&quot; @reset-click=&quot;handleResetClick&quot; :search-config=&quot;searchConfig&quot;/&gt;

    &lt;page-content ref=&quot;contentRef&quot; @new-data-click=&quot;handleNewDataClick&quot; @edit-data-click=&quot;handleEditDataClick&quot; :content-config=&quot;contentConfig&quot;&gt;
      &lt;template #leader=&quot;scope&quot;&gt;
        &lt;span style=&quot;color: red;&quot;&gt;
          {{ scope.row[scope.prop] }}
        &lt;/span&gt;
      &lt;/template&gt;
      &lt;template #parent=&quot;scope&quot;&gt;
        &lt;el-tag&gt;
          {{ scope.row[scope.prop] }}
        &lt;/el-tag&gt;
      &lt;/template&gt;
    &lt;/page-content&gt;

    &lt;page-modal ref=&quot;modalRef&quot; /&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="封装模态框组件" tabindex="-1"><a class="header-anchor" href="#封装模态框组件" aria-hidden="true">#</a> 封装模态框组件</h3><p><img src="https://secure2.wostatic.cn/static/kbS9pkH3ukfcY4E2cyhBUd/image.png" alt=""></p><h4 id="编写模态框内容配置文件" tabindex="-1"><a class="header-anchor" href="#编写模态框内容配置文件" aria-hidden="true">#</a> 编写模态框内容配置文件</h4><p><code>motal.config.ts</code></p><p>这里的<code>options</code>应该是由获取接口数据得到的，后续会进行封装，这里先写为静态的。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>const modalConfig = {
    header: {
        newTitle: &#39;新建部门&#39;,
        editTitle: &#39;编辑部门&#39;,
    },
    pageName: &#39;department&#39;,
    formItems: [
        {
            type: &#39;input&#39;,
            prop: &#39;name&#39;,
            label: &#39;部门名称&#39;,
            placeholder: &#39;请输入部门名称&#39;
        },
        {
            type: &#39;input&#39;,
            prop: &#39;leader&#39;,
            label: &#39;部门领导&#39;,
            placeholder: &#39;请输入查询的领导名称&#39;,
            initialValue: &#39;张三&#39;
        },
        {
            type: &#39;select&#39;,
            prop: &#39;parentId&#39;,
            label: &#39;上级部门&#39;,
            options: [
                // 后面使用动态获取
                // { label: &#39;部门1&#39;, value: &#39;1&#39; },
            ]
        }
    ]
}

export default modalConfig
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="重构模态框内容组件" tabindex="-1"><a class="header-anchor" href="#重构模态框内容组件" aria-hidden="true">#</a> 重构模态框内容组件</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// page-modal.vue
&lt;template&gt;
  &lt;div class=&quot;modal&quot;&gt;
    &lt;el-dialog v-model=&quot;dialogVisible&quot; :title=&quot;isEdit ? modalConfig.header.editTitle : modalConfig.header.newTitle&quot; width=&quot;30%&quot; center&gt;
      &lt;div class=&quot;form&quot;&gt;
        &lt;el-form :model=&quot;formData&quot; label-width=&quot;80px&quot; size=&quot;large&quot;&gt;
          &lt;template v-for=&quot;item in modalConfig.formItems&quot; :key=&quot;item.prop&quot;&gt;
            &lt;el-form-item v-bind=&quot;item&quot;&gt;
              &lt;template v-if=&quot;item.type === &#39;input&#39;&quot;&gt;
                &lt;el-input v-model=&quot;formData[item.prop]&quot; :placeholder=&quot;item.placeholder&quot; /&gt;
              &lt;/template&gt;

              &lt;template v-if=&quot;item.type === &#39;select&#39;&quot;&gt;
                &lt;el-select v-model=&quot;formData[item.prop]&quot; :placeholder=&quot;item.placeholder&quot; style=&quot;width: 100%&quot;&gt;
                  &lt;template v-for=&quot;option in item.options&quot; :key=&quot;option.value&quot;&gt;
                    &lt;el-option :value=&quot;option.value&quot; :label=&quot;option.label&quot; /&gt;
                  &lt;/template&gt;
                &lt;/el-select&gt;
              &lt;/template&gt;
            &lt;/el-form-item&gt;
          &lt;/template&gt;
        &lt;/el-form&gt;
      &lt;/div&gt;
      &lt;template #footer&gt;
        &lt;span class=&quot;dialog-footer&quot;&gt;
          &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取消&lt;/el-button&gt;
          &lt;el-button type=&quot;primary&quot; @click=&quot;handleConfirmClick&quot;&gt;确定&lt;/el-button&gt;
        &lt;/span&gt;
      &lt;/template&gt;
    &lt;/el-dialog&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot; name=&quot;modal&quot;&gt;
import useMainStore from &#39;@/store/main/main&#39;
import useSystemStore from &#39;@/store/main/system/system&#39;
import { storeToRefs } from &#39;pinia&#39;
import { reactive, ref } from &#39;vue&#39;

const dialogVisible = ref(false)
const isEdit = ref(false)
const editData = ref()

// 部门和角色的数据
const mainStore = useMainStore()
const { entireDepartments } = storeToRefs(mainStore)

interface IProps {
  modalConfig: {
    header: {
      newTitle: string,
      editTitle: string
    }
    pageName: string,
    formItems: any[]
  }
}

// 定义props
const props = defineProps&lt;IProps&gt;()

// 定义数据绑定
const initialForm: any = {}
for(const item of props.modalConfig.formItems) {
    initialForm[item.prop] = item.initialValue ?? &#39;&#39;
}
const formData = reactive&lt;any&gt;(initialForm)

// 点击确定
const systemStore = useSystemStore()
function handleConfirmClick() {
  dialogVisible.value = false
  if (!isEdit.value) {
    systemStore.newPageDataAction(props.modalConfig.pageName, formData)
  } else {
    systemStore.editPageDataAction(props.modalConfig.pageName, editData.value.id, formData)
  }
}

// 新建或者编辑
function setDialogVisible(isNew: boolean = true, data: any = {}) {
  dialogVisible.value = true
  isEdit.value = !isNew
  editData.value = data
  for (const key in formData) {
    if (isNew) {
      formData[key] = &#39;&#39;
    } else {
      formData[key] = data[key]
    }
  }
}

defineExpose({
  setDialogVisible
})
&lt;/script&gt;

&lt;style scoped lang=&quot;less&quot;&gt;
.form {
  padding: 10px 30px;
}
&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="将选择器下拉内容-options-改为动态获取接口数据" tabindex="-1"><a class="header-anchor" href="#将选择器下拉内容-options-改为动态获取接口数据" aria-hidden="true">#</a> 将选择器下拉内容 options 改为动态获取接口数据</h4><p>在父组件中将要传入的<code>modalConfig</code>进行预处理，使用<code>pinia</code>将接口数据（<code>name</code>, <code>id</code>）先映射成<code>options</code>需要的参数（<code>label</code>, <code>value</code>），再将数据推入到<code>prop</code>为<code>parentId</code>下的<code>options</code>数组中。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// 父组件deparment.vue
&lt;template&gt;
  &lt;div class=&quot;department&quot;&gt;
    // ...
    &lt;page-modal ref=&quot;modalRef&quot; :modal-config=&quot;modalConfigRef&quot;/&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot; name=&quot;department&quot;&gt;
// ...
import PageModal from &#39;@/components/page-modal/page-modal.vue&#39;
import { computed, ref } from &#39;vue&#39;
import modalConfig from &#39;./config/modal.config&#39;
import useMainStore from &#39;@/store/main/main&#39;

// 对modalConfig进行操作，用于select中的options来自于接口数据
const modalConfigRef = computed(() =&gt; {
  const mainStore = useMainStore()
  // 将获取到的name和id映射成option需要的label和value形式
  const departments = mainStore.entireDepartments.map((item) =&gt; {
    return { label: item.name, value: item.id }
  })
  modalConfig.formItems.forEach((item) =&gt; {
    if (item.prop === &#39;parentId&#39;) {
      item.options.push(...departments)
    }
  })
  return modalConfig
})

// ...
&lt;/script&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="页面公共逻辑的-hooks-抽取" tabindex="-1"><a class="header-anchor" href="#页面公共逻辑的-hooks-抽取" aria-hidden="true">#</a> 页面公共逻辑的 hooks 抽取</h3><h4 id="抽取表单搜索内容中的搜索功能和重置功能。" tabindex="-1"><a class="header-anchor" href="#抽取表单搜索内容中的搜索功能和重置功能。" aria-hidden="true">#</a> 抽取表单搜索内容中的搜索功能和重置功能。</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// hooks/usePageContent.ts
import type PageContent from &quot;@/components/page-content/page-content.vue&quot;
import { ref } from &quot;vue&quot;

export function usePageContent() {
    const contentRef = ref&lt;InstanceType&lt;typeof PageContent&gt;&gt;()
    // 搜索功能
    function handleQueryClick(searchInfo: any) {
        console.log(searchInfo);
        contentRef.value?.fetchPageListData(searchInfo)
    }
    // 重置功能
    function handleResetClick() {
        contentRef.value?.fetchPageListData()
    }

    return {
        contentRef,
        handleQueryClick,
        handleResetClick
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="抽取模态框中新增和编辑功能。" tabindex="-1"><a class="header-anchor" href="#抽取模态框中新增和编辑功能。" aria-hidden="true">#</a> 抽取模态框中新增和编辑功能。</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// hooks/usePageModal.ts
import type PageModal from &quot;@/components/page-modal/page-modal.vue&quot;
import { ref } from &quot;vue&quot;

export function usePageModal() {
    const modalRef = ref&lt;InstanceType&lt;typeof PageModal&gt;&gt;()

    // 新增功能
    function handleNewDataClick() {
        modalRef.value?.setDialogVisible()
    }
    // 编辑功能
    function handleEditDataClick(itemData: any) {
        modalRef.value?.setDialogVisible(false, itemData)
    }

    return {
        modalRef,
        handleEditDataClick,
        handleNewDataClick
    }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="父组件中调用-hooks。" tabindex="-1"><a class="header-anchor" href="#父组件中调用-hooks。" aria-hidden="true">#</a> 父组件中调用 hooks。</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;script setup lang=&quot;ts&quot; name=&quot;department&quot;&gt;
import { usePageContent } from &#39;@/hooks/usePageContent&#39;
import { usePageModal } from &#39;@/hooks/usePageModal&#39;
// ...
// 抽取成hooks
const { contentRef, handleQueryClick, handleResetClick } = usePageContent()

const { modalRef, handleEditDataClick, handleNewDataClick } = usePageModal()
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="实现菜单管理功能" tabindex="-1"><a class="header-anchor" href="#实现菜单管理功能" aria-hidden="true">#</a> 实现菜单管理功能</h2><p><img src="https://secure2.wostatic.cn/static/7XLVEKxN4tVF4ssBfRRq6H/image.png" alt=""></p><h3 id="实现树形子树的展示" tabindex="-1"><a class="header-anchor" href="#实现树形子树的展示" aria-hidden="true">#</a> 实现树形子树的展示</h3><p>使用<code>el-table</code>中的<code>row-key=&quot;id&quot;</code>来绑定子树的<code>id</code>。这里使用配置项来在表格数据中动态绑定。</p><blockquote><p><a href="https://element-plus.gitee.io/zh-CN/component/table.html#%E6%A0%91%E5%BD%A2%E6%95%B0%E6%8D%AE%E4%B8%8E%E6%87%92%E5%8A%A0%E8%BD%BD" target="_blank" rel="noopener noreferrer">树形数据<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>：支持树类型的数据的显示。 当 row 中包含 <code>children</code> 字段时，被视为树形数据。 渲染嵌套数据需要 prop 的 <code>row-key</code>。 此外，子行数据可以异步加载。 设置 Table 的<code>lazy</code>属性为 true 与加载函数 <code>load</code> 。 通过指定 row 中的<code>hasChildren</code>字段来指定哪些行是包含子节点。 <code>children</code> 与<code>hasChildren</code>都可以通过 <code>tree-props</code> 配置。</p></blockquote><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// page-content.vue
&lt;template&gt;
  &lt;div class=&quot;content&quot;&gt;
    &lt;div class=&quot;header&quot;&gt;
      &lt;h3 class=&quot;title&quot;&gt;{{ contentConfig?.header?.title ?? &#39;数据列表&#39; }}&lt;/h3&gt;
      &lt;el-button type=&quot;primary&quot; @click=&quot;handleNewData&quot;&gt;{{ contentConfig?.header?.btnTitle ?? &#39;新建数据&#39; }}&lt;/el-button&gt;
    &lt;/div&gt;
    &lt;div class=&quot;table&quot;&gt;
      &lt;el-table :data=&quot;pageList&quot; :border=&quot;true&quot; style=&quot;width: 100%&quot; v-bind=&quot;contentConfig.childrenTree&quot;&gt;
        &lt;template v-for=&quot;item in contentConfig.propsList&quot; :key=&quot;item.prop&quot;&gt;
          &lt;!-- 处理带自定义插槽的时间格式类型 --&gt;
          &lt;template v-if=&quot;item.type === &#39;timer&#39;&quot;&gt;
            &lt;el-table-column align=&quot;center&quot; v-bind=&quot;item&quot;&gt;
              &lt;template #default=&quot;scope&quot;&gt;
                {{ formatUTC(scope.row[item.prop]) }}
              &lt;/template&gt;
            &lt;/el-table-column&gt;
          &lt;/template&gt;

          &lt;!-- 处理handle类型 --&gt;
          &lt;template v-else-if=&quot;item.type === &#39;handler&#39;&quot;&gt;
            &lt;el-table-column align=&quot;center&quot; v-bind=&quot;item&quot;&gt;
              &lt;template #default=&quot;scope&quot;&gt;
                &lt;el-button type=&quot;primary&quot; size=&quot;small&quot; icon=&quot;EditPen&quot; link @click=&quot;handleEditClick(scope.row)&quot;&gt;
                  编辑
                &lt;/el-button&gt;
                &lt;el-button type=&quot;danger&quot; size=&quot;small&quot; icon=&quot;Delete&quot; link @click=&quot;handleDeleteClick(scope.row.id)&quot;&gt;
                  删除
                &lt;/el-button&gt;
              &lt;/template&gt;
            &lt;/el-table-column&gt;
          &lt;/template&gt;

          &lt;!-- 处理普通类型 --&gt;
          &lt;template v-else&gt;
            &lt;!-- &lt;el-table-column align=&quot;center&quot; :type=&quot;item.type&quot; :prop=&quot;item.prop&quot; :label=&quot;item.label&quot; :width=&quot;item.width&quot; /&gt; 相当于下面--&gt;
            &lt;el-table-column align=&quot;center&quot; v-bind=&quot;item&quot; /&gt;
          &lt;/template&gt;
        &lt;/template&gt;

      &lt;/el-table&gt;
    &lt;/div&gt;
    &lt;div class=&quot;footer&quot;&gt;
      &lt;el-pagination
        v-model:currentPage=&quot;currentPage&quot;
        v-model:page-size=&quot;pageSize&quot;
        :page-sizes=&quot;[10, 20, 30]&quot;
        layout=&quot;total, sizes, prev, pager, next, jumper&quot;
        :total=&quot;pageTotalCount&quot;
        @current-change=&quot;handleCurrentChange&quot;
      /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot; name=&quot;content&quot;&gt;
import { storeToRefs } from &#39;pinia&#39;
import useSystemStore from &#39;@/store/main/system/system&#39;
import { formatUTC } from &#39;@/utils/format&#39;;
import { ref } from &#39;vue&#39;

interface IProps {
  contentConfig: {
    // 用于处理接口方法中传入的pageName参数
    pageName: string,
    header?: {
      title?: string,
      btnTitle: string
    },
    propsList: any[],
    childrenTree: any[]
  }
}

const props = defineProps&lt;IProps&gt;()

const emit = defineEmits([&#39;newDataClick&#39;, &#39;editDataClick&#39;])

// 1.请求数据
const systemStore = useSystemStore()
const currentPage = ref(1)
const pageSize = ref(10)
function fetchPageListData(formData: any = {}) {
  // 1.获取offset和size
  const size = pageSize.value
  const offset = (currentPage.value - 1) * size
  const pageInfo = { size, offset}

  // 2.发起网络请求
  const queryInfo = { ...pageInfo, ...formData}
  systemStore.getPageListDataAction(props.contentConfig.pageName, { offset, size, ...queryInfo })
}
fetchPageListData()

// 2.展示数据
const { pageList, pageTotalCount } = storeToRefs(systemStore)

// 3.绑定分页数据
function handleCurrentChange() {
  fetchPageListData()
}
function handleResetClick() {
  currentPage.value = 1
  pageSize.value = 10
  fetchPageListData()
}

// 4.新建数据的处理
function handleNewData() {
  emit(&#39;newDataClick&#39;)
}

// 5.删除和编辑操作
function handleDeleteClick(id: number) {
  systemStore.deletePageDataAction(props.contentConfig.pageName, id)
}

function handleEditClick(data: any) {
  emit(&#39;editDataClick&#39;, data)
}

// 暴露函数
defineExpose({
  fetchPageListData,
  handleResetClick
})
&lt;/script&gt;

&lt;style scoped lang=&quot;less&quot;&gt;
.content {
  margin-top: 20px;
  padding: 20px;
  background-color: #fff;

  .header {
    display: flex;
    height: 45px;
    padding: 0 5px;
    justify-content: space-between;
    align-items: center;

    .title {
      font-size: 20px;
      font-weight: 700;
    }

    .handler {
      align-items: center;
    }
  }

  .table {
    :deep(.el-table__cell) {
      padding: 14px 0;
    }
  }

  .footer {
    display: flex;
    justify-content: flex-end;
    margin-top: 15px;
  }
}
&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用配置项绑定<code>row-key</code>属性。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// content.config.ts
const contentConfig = {
    pageName: &#39;menu&#39;,
    header: {
      title: &#39;菜单列表&#39;,
      btnTitle: &#39;新建菜单&#39;
    },
    propsList: [
      // 若要实现树形数据，就不能加type，会冲突
      { prop: &#39;name&#39;, label: &#39;菜单名称&#39;, width: &#39;180px&#39; },
      { prop: &#39;type&#39;, label: &#39;级别&#39;, width: &#39;120px&#39; },
      { prop: &#39;url&#39;, label: &#39;菜单url&#39;, width: &#39;150px&#39; },
      { prop: &#39;icon&#39;, label: &#39;菜单icon&#39;, width: &#39;180px&#39; },
      { prop: &#39;sort&#39;, label: &#39;排序&#39;, width: &#39;120px&#39; },
      { prop: &#39;permission&#39;, label: &#39;权限&#39;, width: &#39;150px&#39; },
      { type: &#39;time&#39;, prop: &#39;createAt&#39;, label: &#39;创建时间&#39; },
      { type: &#39;time&#39;, prop: &#39;updateAt&#39;, label: &#39;更新时间&#39; },
      { type: &#39;handler&#39;, label: &#39;操作&#39;, width: &#39;150px&#39;}
    ],
    childrenTree: {
      rowKey: &#39;id&#39;,
      treeProps: {
        children: &#39;children&#39;
      }
    }
  }

export default contentConfig
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现新增、编辑模态框功能以及删除功能" tabindex="-1"><a class="header-anchor" href="#实现新增、编辑模态框功能以及删除功能" aria-hidden="true">#</a> 实现新增、编辑模态框功能以及删除功能</h3><p>使用配置文件完成。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// modal.config.ts
const modalConfig = {
    pageName: &#39;menu&#39;,
    header: {
      newTitle: &#39;新建菜单&#39;,
      editTitle: &#39;编辑菜单&#39;
    },
    formItems: [
      {
        type: &#39;input&#39;,
        label: &#39;菜单名称&#39;,
        prop: &#39;name&#39;,
        placeholder: &#39;请输入菜单名称&#39;
      },
      {
        type: &#39;input&#39;,
        label: &#39;菜单级别&#39;,
        prop: &#39;type&#39;,
        placeholder: &#39;请输入菜单级别&#39;
      },
      {
        type: &#39;input&#39;,
        label: &#39;菜单级别&#39;,
        prop: &#39;type&#39;,
        placeholder: &#39;请输入菜单级别&#39;
      },
      {
        type: &#39;input&#39;,
        label: &#39;菜单url&#39;,
        prop: &#39;url&#39;,
        placeholder: &#39;请输入菜单url&#39;
      },
      {
        type: &#39;input&#39;,
        label: &#39;菜单icon&#39;,
        prop: &#39;icon&#39;,
        placeholder: &#39;请输入菜单icon&#39;
      },
      {
        type: &#39;input&#39;,
        label: &#39;排序&#39;,
        prop: &#39;sort&#39;,
        placeholder: &#39;请输入排序&#39;
      },
      {
        type: &#39;input&#39;,
        label: &#39;权限&#39;,
        prop: &#39;permission&#39;,
        placeholder: &#39;请输入权限&#39;
      },
      {
        type: &#39;input&#39;,
        label: &#39;创建时间&#39;,
        prop: &#39;createAt&#39;,
        placeholder: &#39;请输入创建时间&#39;
      },
      {
        type: &#39;input&#39;,
        label: &#39;更新时间&#39;,
        prop: &#39;updateAt&#39;,
        placeholder: &#39;请输入更新时间&#39;
      },
      {
        type: &#39;custom&#39;,
        slotName: &#39;menulist&#39;
      }
    ]
}
export default modalConfig

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>父组件<code>menu.vue</code>传递配置文件中的配置项。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;template&gt;
  &lt;div class=&quot;menu&quot;&gt;
    &lt;page-content :content-config=&quot;contentConfig&quot; @new-data-click=&quot;handleNewDataClick&quot; @edit-data-click=&quot;handleEditDataClick&quot;/&gt;
    &lt;page-modal :modal-config=&quot;modalConfig&quot; ref=&quot;modalRef&quot;/&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot; name=&quot;menu&quot;&gt;
import PageContent from &#39;@/components/page-content/page-content.vue&#39;;
import contentConfig from &#39;./config/content.config&#39;;

import PageModal from &#39;@/components/page-modal/page-modal.vue&#39;;
import modalConfig from &#39;./config/modal.config&#39;;

import { usePageModal } from &#39;@/hooks/usePageModal&#39;;

const { modalRef, handleEditDataClick, handleNewDataClick } = usePageModal()
&lt;/script&gt;

&lt;style scoped&gt;
&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="实现角色管理中的权限分配-难点" tabindex="-1"><a class="header-anchor" href="#实现角色管理中的权限分配-难点" aria-hidden="true">#</a> 实现角色管理中的权限分配（难点）</h2><p><strong>在新建角色时使用上文写的自定义作用域插槽定制化树形选择角色权限列表。</strong></p><h3 id="创建角色的菜单树展示" tabindex="-1"><a class="header-anchor" href="#创建角色的菜单树展示" aria-hidden="true">#</a> 创建角色的菜单树展示</h3><p><img src="https://secure2.wostatic.cn/static/6rSjN4g6PwbrGQjTNx1xjF/image.png" alt=""></p><h4 id="封装请求接口数据" tabindex="-1"><a class="header-anchor" href="#封装请求接口数据" aria-hidden="true">#</a> 封装请求接口数据</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// service/main.ts
// 获取所有菜单
export function getEntireMenus() {
    return hyRequest.post({
        url: &quot;/menu/list&quot;
    })
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// store/main.ts
import { getEntireDepartments, getEntireMenus, getEntireRoles } from &quot;@/service/main/main&quot;;
import { defineStore } from &quot;pinia&quot;;

interface IMainState {
    // ...
    entireMenus: any[]
}
const useMainStore = defineStore(&#39;main&#39;, {
    state: (): IMainState =&gt; ({
        // ...
        entireMenus: []
    }),
    actions: {
        async fetchEntireDataAction() {
            // ...
            const menuResult = await getEntireMenus()
            this.entireMenus = menuResult.data.list
        }
    }

})
export default useMainStore

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="在配置文件中定义自定义类型" tabindex="-1"><a class="header-anchor" href="#在配置文件中定义自定义类型" aria-hidden="true">#</a> 在配置文件中定义自定义类型</h4><p>因为新建角色在模态框中展现，因此在<code>modal.config.ts</code>中定义。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>const modalConfig = {
    pageName: &#39;role&#39;,
    header: {
      newTitle: &#39;新建角色&#39;,
      editTitle: &#39;编辑角色&#39;
    },
    formItems: [
      {
        type: &#39;input&#39;,
        label: &#39;角色名称&#39;,
        prop: &#39;name&#39;,
        placeholder: &#39;请输入角色名称&#39;
      },
      {
        type: &#39;input&#39;,
        label: &#39;权限介绍&#39;,
        prop: &#39;intro&#39;,
        placeholder: &#39;请输入权限介绍&#39;
      },
      // 自定义类型
      {
        type: &#39;custom&#39;,
        slotName: &#39;menulist&#39;
      }
    ]
}
export default modalConfig

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="编写自定义插槽" tabindex="-1"><a class="header-anchor" href="#编写自定义插槽" aria-hidden="true">#</a> 编写自定义插槽</h4><p>在<code>page-modal.vue</code>中编写<code>type</code>为<code>custom</code>的作用域插槽。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;template&gt;
  &lt;div class=&quot;modal&quot;&gt;
    &lt;el-dialog v-model=&quot;dialogVisible&quot; :title=&quot;isEdit ? modalConfig.header.editTitle : modalConfig.header.newTitle&quot; width=&quot;30%&quot; center&gt;
      &lt;div class=&quot;form&quot;&gt;
        &lt;el-form :model=&quot;formData&quot; label-width=&quot;80px&quot; size=&quot;large&quot;&gt;
          &lt;template v-for=&quot;item in modalConfig.formItems&quot; :key=&quot;item.prop&quot;&gt;
            &lt;el-form-item v-bind=&quot;item&quot;&gt;
              &lt;template v-if=&quot;item.type === &#39;input&#39;&quot;&gt;
                // ...
              &lt;/template&gt;

              &lt;template v-if=&quot;item.type === &#39;select&#39;&quot;&gt;
                // ...
              &lt;/template&gt;

              &lt;!-- 自定义插槽：如角色管理中的权限树形选择 --&gt;
              &lt;template v-if=&quot;item.type === &#39;custom&#39;&quot;&gt;
                &lt;slot :name=&quot;item.slotName&quot;&gt;&lt;/slot&gt;
              &lt;/template&gt;
            &lt;/el-form-item&gt;
          &lt;/template&gt;
        &lt;/el-form&gt;
      &lt;/div&gt;
      // ...
    &lt;/el-dialog&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="在父组件中实现菜单列表的自定义插槽" tabindex="-1"><a class="header-anchor" href="#在父组件中实现菜单列表的自定义插槽" aria-hidden="true">#</a> 在父组件中实现菜单列表的自定义插槽</h4><p>使用<code>el-tree</code>中的树节点选择实现，将请求接口数据<code>entireMenus</code>传入给<code>:data</code>即可。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;template&gt;
  &lt;div class=&quot;role&quot;&gt;
    &lt;page-search :search-config=&quot;searchConfig&quot; @query-click=&quot;handleQueryClick&quot; @reset-click=&quot;handleResetClick&quot;/&gt;
    &lt;page-content :content-config=&quot;contentConfig&quot; ref=&quot;contentRef&quot; @new-data-click=&quot;handleNewDataClick&quot; @edit-data-click=&quot;handleEditDataClick&quot;/&gt;
    &lt;page-modal :modal-config=&quot;modalConfig&quot; ref=&quot;modalRef&quot;&gt;
      &lt;!-- 自定义菜单列表 --&gt;
      &lt;template #menulist&gt;
        &lt;el-tree
          ref=&quot;treeRef&quot;
          :data=&quot;entireMenus&quot;
          show-checkbox
          default-expand-all
          node-key=&quot;id&quot;
          highlight-current
          :props=&quot;{ children: &#39;children&#39;, label: &#39;name&#39; }&quot;
        /&gt;
      &lt;/template&gt;
    &lt;/page-modal&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import pageSearch from &#39;@/components/page-search/page-search.vue&#39;;
import searchConfig from &#39;./config/search.config&#39;

import pageContent from &#39;@/components/page-content/page-content.vue&#39;;
import contentConfig from &#39;./config/content.config&#39;;

import pageModal from &#39;@/components/page-modal/page-modal.vue&#39;;
import modalConfig from &#39;./config/modal.config&#39;;

import { usePageContent } from &#39;@/hooks/usePageContent&#39;;
import { usePageModal } from &#39;@/hooks/usePageModal&#39;;
import useMainStore from &#39;@/store/main/main&#39;;
import { storeToRefs } from &#39;pinia&#39;;

// hooks逻辑关系
const { contentRef, handleQueryClick, handleResetClick } = usePageContent()
const { modalRef, handleEditDataClick, handleNewDataClick } = usePageModal()

const mainStore = useMainStore()
const { entireMenus } = storeToRefs(mainStore)
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建角色携带菜单树的权限数据" tabindex="-1"><a class="header-anchor" href="#创建角色携带菜单树的权限数据" aria-hidden="true">#</a> 创建角色携带菜单树的权限数据</h3><p>将菜单树的<code>menulist</code>和<code>formData</code>绑定一起传递给服务器，使用<code>el-tree</code>中<code>check</code>属性获取选中值，里面有 2 个参数，第 2 个参数能够获取当前选中的结点<code>checkedNodes</code>以及它的父结点<code>halfCheckedNodes</code>和它们的<code>key</code>。</p><h4 id="父组件中获取权限数据并传递给-page-modal-子组件" tabindex="-1"><a class="header-anchor" href="#父组件中获取权限数据并传递给-page-modal-子组件" aria-hidden="true">#</a> 父组件中获取权限数据并传递给 page-modal 子组件</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// role.vue
&lt;template&gt;
  &lt;div class=&quot;role&quot;&gt;
    // ...
    &lt;page-modal :modal-config=&quot;modalConfig&quot; ref=&quot;modalRef&quot; :other-info=&quot;otherInfo&quot;&gt;
      &lt;!-- 自定义菜单列表 --&gt;
      &lt;template #menulist&gt;
        &lt;el-tree
          // ...
          @check=&quot;handleELTreeCheck&quot;
        /&gt;
      &lt;/template&gt;
    &lt;/page-modal&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
// ...
// 获取树形列表的key(id)
const otherInfo = ref({})
function handleELTreeCheck(data1: any, data2: any) {
  const menuList = [...data2.checkedKeys, ...data2.halfCheckedKeys]
  otherInfo.value = { menuList }
}
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="子组件接受数据并将其合并发送给服务器" tabindex="-1"><a class="header-anchor" href="#子组件接受数据并将其合并发送给服务器" aria-hidden="true">#</a> 子组件接受数据并将其合并发送给服务器</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// page-modal.vue
&lt;script setup lang=&quot;ts&quot; name=&quot;modal&quot;&gt;
// ...
interface IProps {
  modalConfig: {
    // ...
  }
  otherInfo?: any
}

// ...

// 点击确定
const systemStore = useSystemStore()
function handleConfirmClick() {
  dialogVisible.value = false

  // 若有其它info进行合并发送给服务器（如：角色管理中新建角色的权限分配菜单树menuList）
  let infoData = formData
  if(props.otherInfo) {
    infoData = { ...formData, ...props.otherInfo}
  }

  if (!isEdit.value) {
    systemStore.newPageDataAction(props.modalConfig.pageName, infoData)
  } else {
    systemStore.editPageDataAction(props.modalConfig.pageName, editData.value.id, infoData)
  }
}
&lt;/script&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="编辑时角色菜单权限回显" tabindex="-1"><a class="header-anchor" href="#编辑时角色菜单权限回显" aria-hidden="true">#</a> 编辑时角色菜单权限回显</h3><h4 id="封装菜单映射权限-id-列表的工具" tabindex="-1"><a class="header-anchor" href="#封装菜单映射权限-id-列表的工具" aria-hidden="true">#</a> 封装菜单映射权限 Id 列表的工具</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// utils/map-menus.ts
/**
 * 菜单映射到id的列表（用于角色管理的权限树分配）
 * @param menuList
 */
export function mapMenuListToIds(menuList: any[]) {
  const ids: number[] = []

  function recurseGetId(menus: any[]) {
    for(const item of menus) {
      // 如果有子菜单，就递归直到没有子菜单，然后把id添加到ids中
      if(item.children) {
        recurseGetId(item.children)
      } else {
        ids.push(item.id)
      }
    }
  }
  recurseGetId(menuList)
  return ids
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="获取角色权限菜单的数据" tabindex="-1"><a class="header-anchor" href="#获取角色权限菜单的数据" aria-hidden="true">#</a> 获取角色权限菜单的数据</h4><p>在点击编辑按钮触发<code>usePageModal</code>事件时，传入的参数<code>itemData</code>中可以拿到模态框里的数据（包括菜单树控件<code>el-tree</code>），但是因为点击编辑事件封装在<code>hooks</code>里面，在<code>role.vue</code>中需要传入一个函数<code>editCallback</code>来获取。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>type callbackType = (item: any) =&gt; void
export function usePageModal(editCallback?: callbackType) {
    const modalRef = ref&lt;InstanceType&lt;typeof PageModal&gt;&gt;()
    // ...
    // 编辑功能
    function handleEditDataClick(itemData: any) {
        modalRef.value?.setDialogVisible(false, itemData)
        // 回显角色管理中权限菜单树
        if(editCallback) editCallback(itemData)
    }
    return {
        handleEditDataClick,
        // ...
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 role.vue 中使用<code>editCallback</code>函数来接受编辑事件传来的<code>itemData</code>（对象），并将其用<code>mapMenuListToIds</code>工具处理成<code>id</code>数组，在<code>nextTick()</code>中调用。</p><blockquote><p><code>nextTick</code>：当你在 Vue 中更改响应式状态时，最终的 DOM 更新并不是同步生效的，而是由 Vue 将它们缓存在一个队列中，直到下一个“tick”才一起执行。这样是为了确保每个组件无论发生多少状态改变，都仅执行一次更新。<code>nextTick()</code> 可以在状态改变后立即使用，以等待 DOM 更新完成。</p></blockquote><blockquote><p>Vue 是异步执行 dom 更新的，一旦观察到数据变化，Vue 就会开启一个队列，然后把在同一个事件循环 (event loop) 当中观察到数据变化的 watcher 推送进这个队列。如果这个 watcher 被触发多次，只会被推送到队列一次。这种缓冲行为可以有效的去掉重复数据造成的不必要的计算和 DOm 操作。而在下一个事件循环时，Vue 会清空队列，并进行必要的 DOM 更新。<br> 当你设置 vm.someData = &#39;new value&#39;，DOM 并不会马上更新，而是在异步队列被清除，也就是下一个事件循环开始时执行更新时才会进行必要的 DOM 更新。如果此时你想要根据更新的 DOM 状态去做某些事情，就会出现问题。。为了在数据变化之后等待 Vue 完成更新 DOM ，可以在数据变化之后立即使用 Vue.nextTick(callback) ，这样回调函数在 DOM 更新完成后就会调用。在 Vue3 中是微任务，Vue2 中不断更新变化。</p></blockquote><p><img src="https://secure2.wostatic.cn/static/g74CyDLQpixmcAHwDpCFbs/image.png" alt=""></p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;template&gt;
  &lt;div class=&quot;role&quot;&gt;
    // ...
    &lt;page-modal :modal-config=&quot;modalConfig&quot; ref=&quot;modalRef&quot; :other-info=&quot;otherInfo&quot;&gt;
      &lt;!-- 自定义菜单列表 --&gt;
      &lt;template #menulist&gt;
        &lt;el-tree
          ref=&quot;treeRef&quot;
          :data=&quot;entireMenus&quot;
          show-checkbox
          default-expand-all
          node-key=&quot;id&quot;
          highlight-current
          :props=&quot;{ children: &#39;children&#39;, label: &#39;name&#39; }&quot;
          @check=&quot;handleELTreeCheck&quot;
        /&gt;
      &lt;/template&gt;
    &lt;/page-modal&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
// ...
import { ref, nextTick } from &#39;vue&#39;;
import { mapMenuListToIds } from &#39;@/utils/map-menus&#39;;
import type { ElTree } from &#39;element-plus/es/components/index.js&#39;;
// ...
const { modalRef, handleEditDataClick, handleNewDataClick } = usePageModal(editCallback)

// ...
// 编辑角色菜单权限回显
const treeRef = ref&lt;InstanceType&lt;typeof ElTree&gt;&gt;()
function editCallback(data: any){
  nextTick(() =&gt; {
    const menuList = mapMenuListToIds(data.menuList)
    // 只有在nextTick之后才能设置setCheckedKeys
    treeRef.value?.setCheckedKeys(menuList)
  })
}
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="新增时角色菜单权限回显重置" tabindex="-1"><a class="header-anchor" href="#新增时角色菜单权限回显重置" aria-hidden="true">#</a> 新增时角色菜单权限回显重置</h3><h4 id="重置角色权限菜单树的数据" tabindex="-1"><a class="header-anchor" href="#重置角色权限菜单树的数据" aria-hidden="true">#</a> 重置角色权限菜单树的数据</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// role.vue
&lt;script setup lang=&quot;ts&quot;&gt;
import { ref, nextTick } from &#39;vue&#39;;
import { mapMenuListToIds } from &#39;@/utils/map-menus&#39;;
import type { ElTree } from &#39;element-plus/es/components/index.js&#39;;
// ...
const { modalRef, handleEditDataClick, handleNewDataClick } = usePageModal(newCallback, editCallback)

// ...
// 新增角色菜单权限重置
function newCallback(){
  nextTick(() =&gt; {
    treeRef.value?.setCheckedKeys([])
  })
}
// 编辑角色菜单权限回显...
}
&lt;/script&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="hooks-中调用" tabindex="-1"><a class="header-anchor" href="#hooks-中调用" aria-hidden="true">#</a> hooks 中调用</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// ...
type callbackType = (item?: any) =&gt; void
export function usePageModal(newCallback?: callbackType, editCallback?: callbackType) {
    const modalRef = ref&lt;InstanceType&lt;typeof PageModal&gt;&gt;()
    // 新增功能
    function handleNewDataClick() {
        modalRef.value?.setDialogVisible()
        if(newCallback) newCallback()
    }
    // 编辑功能...
    return {
        modalRef,
        handleEditDataClick,
        handleNewDataClick
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="实现登录用户的权限功能" tabindex="-1"><a class="header-anchor" href="#实现登录用户的权限功能" aria-hidden="true">#</a> 实现登录用户的权限功能</h2><p>通过每个子菜单下增删改查的如<code>permission:&quot;system:users:create&quot;</code>字段实现，用于控制按钮权限的展示。</p><h3 id="封装菜单映射按钮权限工具" tabindex="-1"><a class="header-anchor" href="#封装菜单映射按钮权限工具" aria-hidden="true">#</a> 封装菜单映射按钮权限工具</h3><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// map-menus.ts
/**
 * 菜单映射到按钮的权限permissions
 * @param menuList 菜单列表
 * @returns 权限的数组
 */
export function mapMenuListToPermissions(menuList :any) {
  const permissions: string[] = []

  function recurseGetPermission(menus: any[]) {
    for(const item of menus) {
      if(item.type === 3) {
        permissions.push(item.permission)
      } else {
        // 没有子树的话就将menus设置为空数组，否则会null/undefine报错
        recurseGetPermission(item.children ?? [])
      }
    }
  }
  recurseGetPermission(menuList)

  return permissions
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="获取登录用户的所有按钮权限" tabindex="-1"><a class="header-anchor" href="#获取登录用户的所有按钮权限" aria-hidden="true">#</a> 获取登录用户的所有按钮权限</h3><p>使用菜单映射按钮权限工具，获取登录用户的所有权限，存入<code>pinia</code>中。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>import { mapMenuListToPermissions, mapMenuToRoutes } from &quot;@/utils/map-menus&quot;;

interface ILoginState {
    // ...
    permissions: string[],
}

const useLoginStore = defineStore(&#39;login&#39;, {
    state: (): ILoginState =&gt; ({
        // ...
        permissions: []
    }),
    actions: {
        async loginAccountAction(account: IAccount) {
            // ...

            // 7.获取登录用户的所有按钮权限
            const permissions = mapMenuListToPermissions(this.userMenus)
            this.permissions = permissions
        },

        // 解决刷新页面后，动态路由丢失的问题(不再是loginAccountAction登录时才执行)
        loadLocalDataAction() {
            // ...
            if(token &amp;&amp; userInfo &amp;&amp; userMenus) {
                // ...
                // 刷新时缓存按钮权限
                const permissions = mapMenuListToPermissions(userMenus)
                this.permissions = permissions
            }
        }
    }
})

export default useLoginStore
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="封装权限-hooks" tabindex="-1"><a class="header-anchor" href="#封装权限-hooks" aria-hidden="true">#</a> 封装权限 hooks</h3><p>用于查询某个页面的权限是否在获取到的登录用户所有权限中，如判断<code>department:create</code>、<code>department:update</code>是否包含在登录用户存入在<code>pinia</code>中的<code>permissions</code>数组，用<code>permissions.find</code>去查找。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// hooks/usePermission.ts
import useLoginStore from &#39;@/store/login/login&#39;

function usePermission(pageName: string, handleName: string) {
  const queryPermission = `${pageName}:${handleName}`
  const { permissions } = useLoginStore()

  // !!将字符串转换为布尔值
  return !!permissions.find((item) =&gt; item.includes(queryPermission))
}

export default usePermission

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="编写-page-content-组件" tabindex="-1"><a class="header-anchor" href="#编写-page-content-组件" aria-hidden="true">#</a> 编写 Page-content 组件</h3><p>调用 hooks，判断每一个按钮是否有有对应的增删改查权限，使用<code>v-if</code>控制对应按钮的显示。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;template&gt;
  &lt;div class=&quot;content&quot;&gt;
    &lt;div class=&quot;header&quot;&gt;
      // ...
      // 增
      &lt;el-button v-if=&quot;isCreate&quot; type=&quot;primary&quot; @click=&quot;handleNewData&quot;&gt;{{ contentConfig?.header?.btnTitle ?? &#39;新建数据&#39; }}&lt;/el-button&gt;
    &lt;/div&gt;
    &lt;div class=&quot;table&quot;&gt;
      &lt;el-table :data=&quot;pageList&quot; :border=&quot;true&quot; style=&quot;width: 100%&quot; v-bind=&quot;contentConfig.childrenTree&quot;&gt;
            // ...
          &lt;!-- 处理handle类型 --&gt;
          &lt;template v-else-if=&quot;item.type === &#39;handler&#39;&quot;&gt;
            // ...
            // 改
            &lt;el-button v-if=&quot;isUpdate&quot; type=&quot;primary&quot; size=&quot;small&quot; icon=&quot;EditPen&quot; link @click=&quot;handleEditClick(scope.row)&quot;&gt;
              编辑
            &lt;/el-button&gt;
            // 删
            &lt;el-button v-if=&quot;isDelete&quot; type=&quot;danger&quot; size=&quot;small&quot; icon=&quot;Delete&quot; link @click=&quot;handleDeleteClick(scope.row.id)&quot;&gt;
              删除
            &lt;/el-button&gt;
          &lt;/template&gt;
          // ...
      &lt;/el-table&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot; name=&quot;content&quot;&gt;
import usePermission from &#39;@/hooks/usePermission&#39;

interface IProps {
  contentConfig: {
    // 用于处理接口方法中传入的pageName参数
    pageName: string,
    header?: {
      title?: string,
      btnTitle: string
    },
    propsList: any[],
    childrenTree: any[]
  }
}
const props = defineProps&lt;IProps&gt;()
const emit = defineEmits([&#39;newDataClick&#39;, &#39;editDataClick&#39;])

// 0. 获取是否有对应的增删改查权限
// 增
const isCreate = usePermission(props.contentConfig.pageName, &#39;create&#39;)
// 删
const isDelete = usePermission(props.contentConfig.pageName, &#39;delete&#39;)】
// 改
const isUpdate = usePermission(props.contentConfig.pageName, &#39;update&#39;)
// 查
const isQuery = usePermission(props.contentConfig.pageName, &#39;query&#39;)

// 1.请求数据...
function fetchPageListData(formData: any = {}) {
  // 查
  if(!isQuery) return
  // ...
}
// ...
&lt;/script&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="细节处理-新增编辑删除操作重置-current-分页" tabindex="-1"><a class="header-anchor" href="#细节处理-新增编辑删除操作重置-current-分页" aria-hidden="true">#</a> (细节处理)新增编辑删除操作重置 current 分页</h2><p>通过使用<code>pinia</code>中的<a href="https://pinia.vuejs.org/zh/core-concepts/actions.html#subscribing-to-actions" target="_blank" rel="noopener noreferrer">订阅<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://pinia.vuejs.org/zh/core-concepts/actions.html#subscribing-to-actions" target="_blank" rel="noopener noreferrer"><code>action</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，去监听增删改的<code>actions</code>，从而将<code>current</code>重置。</p><blockquote><p>订阅 <code>action</code>：你可以通过 <code>store.$onAction()</code> 来监听 <code>action</code> 和它们的结果。传递给它的回调函数会在 <code>action</code> 本身之前执行。<code>after</code> 表示在 promise 解决之后，允许你在 <code>action</code> 解决后执行一个回调函数。同样地，<code>onError</code> 允许你在 <code>action</code> 抛出错误或 <code>reject</code> 时执行一个回调函数。</p></blockquote><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// page-content.vue
&lt;script setup lang=&quot;ts&quot; name=&quot;content&quot;&gt;
// ...
// 6.监听systemStore的增删改action,将页面currentPage重置
systemStore.$onAction(({ name, after }) =&gt; {
  // after表示在action成功执行之后执行（失败时不执行）
  after(() =&gt; {
    if(name === &#39;editPageDataAction&#39; || name === &#39;newPageDataAction&#39; || name === &#39;deletePageDataAction&#39;) {
      currentPage.value = 1
    }
  })
})
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="实现数据统计页面" tabindex="-1"><a class="header-anchor" href="#实现数据统计页面" aria-hidden="true">#</a> 实现数据统计页面</h2><h3 id="实现顶部卡片组件页面" tabindex="-1"><a class="header-anchor" href="#实现顶部卡片组件页面" aria-hidden="true">#</a> 实现顶部卡片组件页面</h3><h4 id="实现子组件数字统计卡片的静态默认展示。" tabindex="-1"><a class="header-anchor" href="#实现子组件数字统计卡片的静态默认展示。" aria-hidden="true">#</a> 实现子组件数字统计卡片的静态默认展示。</h4><p>使用了<code>withDefaults</code>实现。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// cpns/count-card/count-card.vue
&lt;template&gt;
  &lt;div class=&quot;count-card&quot;&gt;
    &lt;div class=&quot;header&quot;&gt;
        &lt;span class=&quot;title&quot;&gt;{{ title }}&lt;/span&gt;
        &lt;el-tooltip :content=&quot;tips&quot; placement=&quot;top-start&quot; effect=&quot;dark&quot;&gt;
            &lt;el-icon&gt;&lt;Warning /&gt;&lt;/el-icon&gt;
        &lt;/el-tooltip&gt;
    &lt;/div&gt;
    &lt;div class=&quot;content&quot;&gt;
        &lt;span class=&quot;count&quot;&gt;{{ number1 }}&lt;/span&gt;
    &lt;/div&gt;
    &lt;div class=&quot;footer&quot;&gt;
        &lt;span&gt;{{ subtitle }}&lt;/span&gt;
        &lt;span&gt;{{ number2 }}&lt;/span&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
interface IProps {
    title?: string,
    tips?: string,
    number1?: number,
    number2?: number,
    subtitle?: string
}

// withDefaults默认值
withDefaults(defineProps&lt;IProps&gt;(), {
    title: &#39;商品总销量&#39;,
    tips: &#39;所有商品的总销量&#39;,
    number1: 509989,
    number2: 509989,
    subtitle: &#39;商品总销量&#39;
})

&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;
.count-card {
    display: flex;
    flex-direction: column;
    padding: 0 20px;
    height: 130px;
    background: white;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);

    .header {
        display: flex;
        height: 38px;
        font-size: 14px;
        color: rgba(0, 0, 0, 0.45);
        justify-content: space-between;
        align-items: flex-end
    }

    .content {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: flex-start;
        flex: 1;
        margin-left: 0px;
        font-size: 26px;
        color: rgba(0, 0, 0, 0.85);
    }

    .footer {
        display: flex;
        height: 38px;
        line-height: 38px;
        letter-spacing: 1px;
        color: rgba(0, 0, 0, 0.85);
        border-top: 1px solid #f0f0f0;
    }
}
&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="封装网络请求实现动态页面" tabindex="-1"><a class="header-anchor" href="#封装网络请求实现动态页面" aria-hidden="true">#</a> 封装网络请求实现动态页面</h4><p>使用<code>hyRequest</code>和<code>pinia</code>封装网络请求以及数据。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// service/main/analysis.ts
import hyRequest from &quot;@/service&quot;;

export function getAmountListData() {
    return hyRequest.get({
        url: &#39;/goods/amount/list&#39;
    })
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>import { getAmountListData } from &quot;@/service/main/analysis/analysis&quot;;
import { defineStore } from &quot;pinia&quot;;

interface IAnalysisState {
    amountList: any[],
}
const useAnalysisStore = defineStore(&#39;analysis&#39;, {
    state: (): IAnalysisState =&gt; ({
        amountList: [],
    }),
    actions: {
        async fetchAnalysisDataAction() {
            const amountResult = await getAmountListData()
            this.amountList = amountResult.data
        }
    }
})

export default useAnalysisStore
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="父组件获取请求数据并传递给子组件" tabindex="-1"><a class="header-anchor" href="#父组件获取请求数据并传递给子组件" aria-hidden="true">#</a> 父组件获取请求数据并传递给子组件</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// views/main/analysis.vue
&lt;template&gt;
  &lt;div class=&quot;dashboard&quot;&gt;
    &lt;el-row :gutter=&quot;10&quot;&gt;
      &lt;template v-for=&quot;item in amountList&quot; :key=&quot;item.amount&quot;&gt;
        &lt;el-col :span=&quot;6&quot; :xs=&quot;24&quot; :sm=&quot;12&quot; :md=&quot;8&quot; :lg=&quot;6&quot;&gt;
          &lt;count-card v-bind=&quot;item&quot;/&gt;
        &lt;/el-col&gt;
      &lt;/template&gt;
    &lt;/el-row&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import countCard from &quot;./cpns/count-card/count-card.vue&quot;;
import useAnalysisStore from &#39;@/store/main/analysis/analysis&#39;
import { storeToRefs } from &#39;pinia&#39;

// 发起actions封装的网络请求
const analysisStore = useAnalysisStore()
analysisStore.fetchAnalysisDataAction()

// 获取数据
const { amountList } = storeToRefs(analysisStore)
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="顶部卡片中的数据递增动画实现" tabindex="-1"><a class="header-anchor" href="#顶部卡片中的数据递增动画实现" aria-hidden="true">#</a> 顶部卡片中的数据递增动画实现</h3><p>安装<code>npm install countup.js</code></p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;template&gt;
  // ...
  &lt;span ref=&quot;count1Ref&quot;&gt;{{ number1 }}&lt;/span&gt;
  &lt;span ref=&quot;count2Ref&quot;&gt;{{ number2 }}&lt;/span&gt;
&lt;/template&gt;
&lt;script setup lang=&quot;ts&quot;&gt;
// 数字递增动画
import { CountUp } from &#39;countup.js&#39;;
import { onMounted, ref } from &#39;vue&#39;;

interface IProps {
    amount? :string,
    title?: string,
    tips?: string,
    number1?: number,
    number2?: number,
    subtitle?: string
}

// withDefaults默认值
const props = withDefaults(defineProps&lt;IProps&gt;(), {
    title: &#39;商品总销量&#39;,
    tips: &#39;所有商品的总销量&#39;,
    number1: 509989,
    number2: 509989,
    subtitle: &#39;商品总销量&#39;
})

// 给数字前面加前缀¥
const countOption = {
    prefix: props.amount == &#39;sale&#39; ? &#39;¥&#39; : &#39;&#39;
}

// 创建CountUp的实例对象
const count1Ref = ref&lt;HTMLElement&gt;()
const count2Ref = ref&lt;HTMLElement&gt;()
// 参数1: 数字动画的元素
// 参数2: 数字增加到多少
// 参数3: 给参数1前面加个前缀，如¥
// 这里使用onMounted是因为setup的时候还没挂载到ref,就会报错
onMounted(() =&gt; {
    const countup1 = new CountUp(count1Ref.value!, props.number1, countOption)
    const countup2 = new CountUp(count2Ref.value!, props.number2, countOption)

    countup1.start()
    countup2.start()
})
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现顶部卡片响应式布局" tabindex="-1"><a class="header-anchor" href="#实现顶部卡片响应式布局" aria-hidden="true">#</a> 实现顶部卡片响应式布局</h3><p>使用<code>el-col</code>的<code>xs</code>，<code>sm</code>，<code>md</code>，<code>lg</code>，<code>xl</code>实现。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;el-col :span=&quot;6&quot; :xs=&quot;24&quot; :sm=&quot;12&quot; :md=&quot;8&quot; :lg=&quot;6&quot;&gt;
  // ...
&lt;/el-col&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="实现-echart-可视化" tabindex="-1"><a class="header-anchor" href="#实现-echart-可视化" aria-hidden="true">#</a> 实现 echart 可视化</h2><p>安装：<a href="https://echarts.apache.org/handbook/zh/get-started/" target="_blank" rel="noopener noreferrer"><code>npm install echarts --save</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="初步搭建可视化页面" tabindex="-1"><a class="header-anchor" href="#初步搭建可视化页面" aria-hidden="true">#</a> 初步搭建可视化页面</h3><h4 id="使用-element-封装卡片组件" tabindex="-1"><a class="header-anchor" href="#使用-element-封装卡片组件" aria-hidden="true">#</a> 使用 element 封装卡片组件</h4><p>使用<code>el-card</code>卡片，将<code>echart</code>可视化图形聚合在卡片容器中展示。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// chart-card.vue
&lt;template&gt;
    &lt;div class=&quot;chart-card&quot;&gt;
      &lt;el-card class=&quot;box-card&quot;&gt;
        &lt;template #header&gt;
          &lt;div class=&quot;cart-header&quot;&gt;
            &lt;span&gt;分类商品数量(饼图)&lt;/span&gt;
          &lt;/div&gt;
        &lt;/template&gt;

        &lt;div class=&quot;content&quot;&gt;
          &lt;slot&gt;&lt;/slot&gt;
        &lt;/div&gt;
      &lt;/el-card&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;&lt;/script&gt;
&lt;style lang=&quot;less&quot; scoped&gt;&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="引入-echarts-的饼图" tabindex="-1"><a class="header-anchor" href="#引入-echarts-的饼图" aria-hidden="true">#</a> 引入 ECharts 的饼图</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// dashboard.vue
&lt;template&gt;
  &lt;div class=&quot;dashboard&quot;&gt;
    // 顶部卡片组件
    &lt;el-row :gutter=&quot;10&quot;&gt;
      &lt;template v-for=&quot;item in amountList&quot; :key=&quot;item.amount&quot;&gt;
        &lt;el-col :span=&quot;6&quot;&gt;
          &lt;count-card v-bind=&quot;item&quot;/&gt;
        &lt;/el-col&gt;
      &lt;/template&gt;
    &lt;/el-row&gt;

    &lt;el-row :gutter=&quot;10&quot;&gt;
      // echart饼图
      &lt;el-col :span=&quot;7&quot;&gt;
        &lt;chart-card&gt;
          &lt;div class=&quot;echart&quot; ref=&quot;echartRef&quot;&gt;&lt;/div&gt;
        &lt;/chart-card&gt;
      &lt;/el-col&gt;

      &lt;el-col :span=&quot;10&quot;&gt;
        &lt;chart-card/&gt;
      &lt;/el-col&gt;

      &lt;el-col :span=&quot;7&quot;&gt;
        &lt;chart-card/&gt;
      &lt;/el-col&gt;
    &lt;/el-row&gt;

    &lt;el-row :gutter=&quot;10&quot;&gt;
      &lt;el-col :span=&quot;12&quot;&gt;
        &lt;chart-card&gt;折线图&lt;/chart-card&gt;
      &lt;/el-col&gt;

      &lt;el-col :span=&quot;12&quot;&gt;
        &lt;chart-card&gt;柱状图&lt;/chart-card&gt;
      &lt;/el-col&gt;
    &lt;/el-row&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
// ...
import chartCard from &quot;./cpns/chart-card/chart-card.vue&quot;;
import { onMounted, ref } from &quot;vue&quot;;

import * as echarts from &#39;echarts&#39;

// 发起actions封装的网络请求...
// 获取数据...

// 1. 引用dom实例
const echartRef = ref&lt;HTMLElement&gt;()
onMounted(() =&gt; {
  // 2. 基于准备好的dom，初始化echart实例
  const echartInstance = echarts.init(echartRef.value!, &quot;light&quot;, {
    renderer: &#39;canvas&#39;
  })

  // 3.设置options(配置)
  echartInstance.setOption({
    title: {
      text: &#39;Referer of a Website&#39;,
      subtext: &#39;Fake Data&#39;,
      left: &#39;center&#39;
    },
    tooltip: {
      trigger: &#39;item&#39;
    },
    legend: {
      orient: &#39;vertical&#39;,
      left: &#39;left&#39;
    },
    series: [
      {
        name: &#39;Access From&#39;,
        type: &#39;pie&#39;,
        radius: &#39;50%&#39;,
        data: [
          { value: 1048, name: &#39;Search Engine&#39; },
          { value: 735, name: &#39;Direct&#39; },
          { value: 580, name: &#39;Email&#39; },
          { value: 484, name: &#39;Union Ads&#39; },
          { value: 300, name: &#39;Video Ads&#39; }
        ],
        emphasis: {
          itemStyle: {
            shadowBlur: 10,
            shadowOffsetX: 0,
            shadowColor: &#39;rgba(0, 0, 0, 0.5)&#39;
          }
        }
      }
    ]
  })
})
&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;
.el-row {
  margin-bottom: 15px;
}

.echart {
  height: 250px;
}
&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="三层组件封装-echart" tabindex="-1"><a class="header-anchor" href="#三层组件封装-echart" aria-hidden="true">#</a> 三层组件封装 echart</h3><h4 id="封装-base-echart-组件" tabindex="-1"><a class="header-anchor" href="#封装-base-echart-组件" aria-hidden="true">#</a> 封装 Base-echart 组件</h4><p><code>base-echart</code>做初始化（基于准备好的<code>dom</code>，初始化<code>echart</code>实例），用于接收不同<code>echart</code>图形的<code>option</code>配置。监听<code>window</code>的<code>resize</code>属性设置<code>echartInstance.resize()</code>可以实现<code>echart</code>的响应式。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// base-echart.vue
&lt;template&gt;
  &lt;div class=&quot;base-echart&quot;&gt;
    &lt;div class=&quot;echart&quot; ref=&quot;echartRef&quot;&gt;&lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import * as echarts from &#39;echarts&#39;
import { onMounted, ref, watchEffect } from &#39;vue&#39;
// 获取echart的option类型
import type { EChartsOption } from &#39;echarts&#39;

// 接收每个echart不同配置
interface IProps {
    option: EChartsOption
}
const props = defineProps&lt;IProps&gt;()

// 1. 引用dom实例
const echartRef = ref&lt;HTMLElement&gt;()
onMounted(() =&gt; {
  // 2. 基于准备好的dom，初始化echart实例
  const echartInstance = echarts.init(echartRef.value!, &quot;light&quot;, {
    renderer: &#39;canvas&#39;
  })

  // 3.第一次options(配置),动态传入每个图的option
  // watchEffect监听option变化，重新执行
  watchEffect(() =&gt; echartInstance.setOption(props.option))

  // 4.监听window缩放实现echart响应式布局
  window.addEventListener(&#39;resize&#39;, () =&gt; {
    echartInstance.resize()
  })
})
&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;
.echart {
  height: 250px;
}
&lt;/style&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="绘制-echarts-图形" tabindex="-1"><a class="header-anchor" href="#绘制-echarts-图形" aria-hidden="true">#</a> 绘制 ECharts 图形</h4><p>编写<code>option</code>配置，将<code>option</code>传入子组件<code>base-echart.vue</code>，使用<code>:option</code>接收。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// pie-echart.vue
&lt;template&gt;
  &lt;div class=&quot;pie-echart&quot;&gt;
    &lt;base-echart :option=&quot;option&quot;/&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import BaseEchart from &#39;./base-echart.vue&#39;
import type { EChartsOption } from &#39;echarts&#39;

// 只负责传入饼图的option
const option: EChartsOption = {
    title: {
      text: &#39;Referer of a Website&#39;,
      subtext: &#39;Fake Data&#39;,
      left: &#39;center&#39;
    },
    tooltip: {
      trigger: &#39;item&#39;
    },
    legend: {
      orient: &#39;vertical&#39;,
      left: &#39;left&#39;
    },
    series: [
      {
        name: &#39;Access From&#39;,
        type: &#39;pie&#39;,
        radius: &#39;50%&#39;,
        data: [
          { value: 1048, name: &#39;Search Engine&#39; },
          { value: 735, name: &#39;Direct&#39; },
          { value: 580, name: &#39;Email&#39; },
          { value: 484, name: &#39;Union Ads&#39; },
          { value: 300, name: &#39;Video Ads&#39; }
        ],
        emphasis: {
          itemStyle: {
            shadowBlur: 10,
            shadowOffsetX: 0,
            shadowColor: &#39;rgba(0, 0, 0, 0.5)&#39;
          }
        }
      }
    ]
}
&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;
&lt;/style&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="统一导出" tabindex="-1"><a class="header-anchor" href="#统一导出" aria-hidden="true">#</a> 统一导出</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// index.ts
import BaseEchart from &#39;./src/base-echart.vue&#39;
import PieEchart from &#39;./src/pie-echart.vue&#39;
import LineEchart from &#39;./src/line-echart.vue&#39;

export { PieEchart, LineEchart }

export default BaseEchart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="引入-echarts-图形" tabindex="-1"><a class="header-anchor" href="#引入-echarts-图形" aria-hidden="true">#</a> 引入 ECharts 图形</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// dashboard,vue
&lt;template&gt;
  &lt;div class=&quot;dashboard&quot;&gt;
    &lt;!--顶部卡片组件 --&gt;
    &lt;el-row :gutter=&quot;10&quot;&gt;
      &lt;template v-for=&quot;item in amountList&quot; :key=&quot;item.amount&quot;&gt;
        &lt;el-col :span=&quot;6&quot;&gt;
          &lt;count-card v-bind=&quot;item&quot;/&gt;
        &lt;/el-col&gt;
      &lt;/template&gt;
    &lt;/el-row&gt;
    &lt;el-row :gutter=&quot;10&quot;&gt;
      &lt;el-col :span=&quot;7&quot;&gt;
        &lt;chart-card&gt;
          &lt;pie-echart/&gt;
        &lt;/chart-card&gt;
      &lt;/el-col&gt;

      &lt;el-col :span=&quot;10&quot;&gt;
        &lt;chart-card&gt;
          &lt;line-echart/&gt;
        &lt;/chart-card&gt;
      &lt;/el-col&gt;
    &lt;/el-row&gt;
    // ...
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
// ...
&lt;/style&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="获取请求数据用于-echarts-显示" tabindex="-1"><a class="header-anchor" href="#获取请求数据用于-echarts-显示" aria-hidden="true">#</a> 获取请求数据用于 ECharts 显示</h3><h4 id="封装-service-请求接口" tabindex="-1"><a class="header-anchor" href="#封装-service-请求接口" aria-hidden="true">#</a> 封装 service 请求接口</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// service/analysis.ts
// 获取饼图分类商品数量
export function getGoodsCategoryCount() {
    return hyRequest.get({
        url: &#39;/goods/category/count&#39;
    })
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="封装-pinia-请求数据" tabindex="-1"><a class="header-anchor" href="#封装-pinia-请求数据" aria-hidden="true">#</a> 封装 pinia 请求数据</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// store/analysis.ts
import { getAmountListData, getGoodsCategoryCount } from &quot;@/service/main/analysis/analysis&quot;;
import { defineStore } from &quot;pinia&quot;;

interface IAnalysisState {
    amountList: any[],
    goodsCategoryCount: any[]
}
const useAnalysisStore = defineStore(&#39;analysis&#39;, {
    state: (): IAnalysisState =&gt; ({
        amountList: [],
        goodsCategoryCount: []
    }),
    actions: {
        async fetchAnalysisDataAction() {
            // 顶部卡片数据
            const amountResult = await getAmountListData()
            this.amountList = amountResult.data

            // 获取饼图数据
            const goodsResult = await getGoodsCategoryCount()
            this.goodsCategoryCount = goodsResult.data
        },
    }
})
export default useAnalysisStore
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="父组件调用-pinia-中的-actions-发起请求" tabindex="-1"><a class="header-anchor" href="#父组件调用-pinia-中的-actions-发起请求" aria-hidden="true">#</a> 父组件调用 pinia 中的 actions 发起请求</h4><p>父组件<code>dashboard.vue</code>发起请求获取饼图数据，将数据（<code>name</code>，<code>goodsCount</code>）通过<code>map</code>映射成饼图需要的数据（<code>name</code>，<code>value</code>），通过<code>:pie-data=&quot;showGoodsCategoryCount</code>传递给子组件<code>pie-echart.vue</code>。</p><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// dashboard.vue
&lt;template&gt;
  &lt;div class=&quot;dashboard&quot;&gt;
    &lt;!--顶部卡片组件 --&gt;
    // ...
    // 饼图
    &lt;el-row :gutter=&quot;10&quot;&gt;
      &lt;el-col :span=&quot;7&quot;&gt;
        &lt;chart-card&gt;
          &lt;pie-echart :pie-data=&quot;showGoodsCategoryCount&quot;/&gt;
        &lt;/chart-card&gt;
      &lt;/el-col&gt;
     &lt;/el-row&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script setup lang=&quot;ts&quot;&gt;
import { storeToRefs } from &#39;pinia&#39;
import { computed } from &quot;vue&quot;;
import countCard from &quot;./cpns/count-card/count-card.vue&quot;;
import chartCard from &quot;./cpns/chart-card/chart-card.vue&quot;;
import useAnalysisStore from &#39;@/store/main/analysis/analysis&#39;

// 发起actions封装的网络请求
const analysisStore = useAnalysisStore()
analysisStore.fetchAnalysisDataAction()

// 获取数据
const { amountList, goodsCategoryCount } = storeToRefs(analysisStore)

// 获取echart饼图数据
const showGoodsCategoryCount = computed(() =&gt; {
  return goodsCategoryCount.value.map((item) =&gt; ({
    name: item.name,
    value: item.goodsCount
  }))
})
&lt;/script&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="子组件动态接收饼图-option-数据" tabindex="-1"><a class="header-anchor" href="#子组件动态接收饼图-option-数据" aria-hidden="true">#</a> 子组件动态接收饼图 option 数据</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>&lt;template&gt;
  &lt;div class=&quot;pie-echart&quot;&gt;
    &lt;base-echart :option=&quot;option&quot;/&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import BaseEchart from &#39;./base-echart.vue&#39;
import type { EChartsOption } from &#39;echarts&#39;
import { computed } from &#39;vue&#39;

interface IEchartValueType {
  value: number
  name: string
}

interface IProps {
  pieData: IEchartValueType[]
}

const props = defineProps&lt;IProps&gt;()

// 只负责传入饼图的option
const option = computed&lt;EChartsOption&gt;(() =&gt; {
    return {
      tooltip: {
        trigger: &#39;item&#39;
      },
      legend: {
        orient: &#39;horizontal&#39;,
        left: &#39;left&#39;
      },
      series: [
        {
          name: &#39;访问来问&#39;,
          type: &#39;pie&#39;,
          radius: &#39;50%&#39;,
          bottom: &#39;-10%&#39;,
          data: props.pieData,
          emphasis: {
            itemStyle: {
              shadowBlur: 10,
              shadowOffsetX: 0,
              shadowColor: &#39;rgba(0, 0, 0, 0.5)&#39;
            }
          }
        }
      ]
    }
})
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现各种-echart-图动态数据展示" tabindex="-1"><a class="header-anchor" href="#实现各种-echart-图动态数据展示" aria-hidden="true">#</a> 实现各种 Echart 图动态数据展示</h3><h4 id="封装请求接口的动态数据" tabindex="-1"><a class="header-anchor" href="#封装请求接口的动态数据" aria-hidden="true">#</a> 封装请求接口的动态数据</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// service/analysis.ts
// 获取饼图、玫瑰图分类商品数量
export function getGoodsCategoryCount() {
    return hyRequest.get({
        url: &#39;/goods/category/count&#39;
    })
}

// 获取折线图商品销量
export function getGoodsCategorySale() {
    return hyRequest.get({
        url: &#39;/goods/category/sale&#39;
    })
}

// 获取柱状图商品收藏数量
export function getGoodsCategoryFavor() {
    return hyRequest.get({
        url: &#39;/goods/category/favor&#39;
    })
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// store/analysis.ts
import { getAmountListData, getGoodsCategoryCount, getGoodsCategoryFavor, getGoodsCategorySale } from &quot;@/service/main/analysis/analysis&quot;;
import { defineStore } from &quot;pinia&quot;;

interface IAnalysisState {
    amountList: any[],
    goodsCategoryCount: any[],
    goodsCategorySale: any[],
    goodsCategoryFavor: any[]
}
const useAnalysisStore = defineStore(&#39;analysis&#39;, {
    state: (): IAnalysisState =&gt; ({
        amountList: [],
        goodsCategoryCount: [],
        goodsCategorySale: [],
        goodsCategoryFavor: []
    }),
    actions: {
        async fetchAnalysisDataAction() {
            // 顶部卡片数据
            const amountResult = await getAmountListData()
            this.amountList = amountResult.data

            // 获取饼图、玫瑰图数据
            const goodsCountResult = await getGoodsCategoryCount()
            this.goodsCategoryCount = goodsCountResult.data

            // 获取折线图数据
            const goodsSaleResult = await getGoodsCategorySale()
            this.goodsCategorySale = goodsSaleResult.data

            // 获取柱状图数据
            const goodsFavorResult = await getGoodsCategoryFavor()
            this.goodsCategoryFavor = goodsFavorResult.data
        },
    }
})

export default useAnalysisStore

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="封装-type-类型接口" tabindex="-1"><a class="header-anchor" href="#封装-type-类型接口" aria-hidden="true">#</a> 封装 Type 类型接口</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// types/index.ts
export interface IEchartValueType {
    value: number
    name: string
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="实现玫瑰图数据展示" tabindex="-1"><a class="header-anchor" href="#实现玫瑰图数据展示" aria-hidden="true">#</a> 实现玫瑰图数据展示</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// page-echarts/src/rose-echart.vue
&lt;template&gt;
  &lt;div class=&quot;pie-echart&quot;&gt;
    &lt;base-echart :option=&quot;option&quot; /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import BaseEchart from &#39;./base-echart.vue&#39;
import { computed } from &#39;vue&#39;
import type { IEchartValueType } from &#39;../types&#39;
import type { EChartsOption } from &#39;echarts&#39;

interface IProps {
  roseData: IEchartValueType[]
}

const props = defineProps&lt;IProps&gt;()

// 玫瑰图
const option = computed&lt;EChartsOption&gt;(() =&gt; {
  return {
    tooltip: {
      trigger: &#39;item&#39;
    },
    toolbox: {
      show: true,
      feature: {
        mark: { show: true },
        dataView: { show: true, readOnly: false },
        restore: { show: true },
        saveAsImage: { show: true }
      }
    },
    series: [
      {
        name: &#39;访问来源&#39;,
        type: &#39;pie&#39;,
        radius: [10, 160],
        center: [&#39;50%&#39;, &#39;50%&#39;],
        roseType: &#39;area&#39;,
        itemStyle: {
          borderRadius: 8
        },
        bottom: &#39;-25%&#39;,
        data: props.roseData,
        label: {
            show: false
        }
      }
    ]
  }
})
&lt;/script&gt;
&lt;style lang=&quot;less&quot; scoped&gt;&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="实现折线图数据展示" tabindex="-1"><a class="header-anchor" href="#实现折线图数据展示" aria-hidden="true">#</a> 实现折线图数据展示</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// page-echarts/src/line-echart.vue
&lt;template&gt;
  &lt;div class=&quot;line-echart&quot;&gt;
    &lt;base-echart :option=&quot;option&quot; /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import BaseEchart from &#39;./base-echart.vue&#39;
import { computed } from &#39;vue&#39;
import type { EChartsOption } from &#39;echarts&#39;

interface IProps {
  labels: string[]
  values: string[]
}

const props = defineProps&lt;IProps&gt;()

// 玫瑰图
const option = computed&lt;EChartsOption&gt;(() =&gt; {
  return {
    grid: {
      left: &#39;3%&#39;,
      right: &#39;4%&#39;,
      bottom: &#39;3%&#39;,
      containLabel: true
    },
    xAxis: {
      type: &#39;category&#39;,
      boundaryGap: false,
      data: props.labels
    },
    yAxis: {
      type: &#39;value&#39;
    },
    series: [
      {
        name: &#39;分类销量统计&#39;,
        type: &#39;line&#39;,
        stack: &#39;总量&#39;,
        areaStyle: {},
        emphasis: {
          focus: &#39;series&#39;
        },
        data: props.values
      }
    ]
  }
})
&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="实现柱状图数据展示" tabindex="-1"><a class="header-anchor" href="#实现柱状图数据展示" aria-hidden="true">#</a> 实现柱状图数据展示</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// // page-echarts/src/bar-echart.vue
&lt;template&gt;
  &lt;div class=&quot;bar-echart&quot;&gt;
    &lt;base-echart :option=&quot;option&quot; /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import BaseEchart from &#39;./base-echart.vue&#39;
import { computed } from &#39;vue&#39;
import type { EChartsOption } from &#39;echarts&#39;
import * as echarts from &#39;echarts&#39;

interface IProps {
  labels: string[]
  values: string[]
}

const props = defineProps&lt;IProps&gt;()

// 玫瑰图
const option = computed&lt;EChartsOption&gt;(() =&gt; {
  return {
    title: {
      text: &#39;支持鼠标滚动缩放&#39;
    },
    grid: {
      bottom: &#39;5%&#39;
    },
    xAxis: {
      data: props.labels,
      axisLabel: {
        inside: true,
        color: &#39;#fff&#39;
      },
      z: 10
    },
    yAxis: {
      axisLabel: {
        color: &#39;#999&#39;
      }
    },
    series: [
      {
        type: &#39;bar&#39;,
        showBackground: true,
        data: props.values,
        itemStyle: {
          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
            { offset: 0, color: &#39;#2378f7&#39; },
            { offset: 0.5, color: &#39;#188df0&#39; },
            { offset: 1, color: &#39;#188df0&#39; }
          ])
        },
        emphasis: {
          itemStyle: {
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
              { offset: 0, color: &#39;#2378f7&#39; },
              { offset: 0.7, color: &#39;#2378f7&#39; },
              { offset: 1, color: &#39;#83bff6&#39; }
            ])
          }
        }
      }
    ]
  }
})
&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;&lt;/style&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="父组件将接口数据映射-echart-需要的数据进行传递使用" tabindex="-1"><a class="header-anchor" href="#父组件将接口数据映射-echart-需要的数据进行传递使用" aria-hidden="true">#</a> 父组件将接口数据映射 Echart 需要的数据进行传递使用</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// dashboard.vue
&lt;template&gt;
  &lt;div class=&quot;dashboard&quot;&gt;
    &lt;!--顶部卡片组件 --&gt;
    &lt;el-row :gutter=&quot;10&quot;&gt;
      &lt;template v-for=&quot;item in amountList&quot; :key=&quot;item.amount&quot;&gt;
        &lt;el-col :span=&quot;6&quot; :xs=&quot;24&quot; :sm=&quot;12&quot; :md=&quot;8&quot; :lg=&quot;6&quot;&gt;
          &lt;count-card v-bind=&quot;item&quot;/&gt;
        &lt;/el-col&gt;
      &lt;/template&gt;
    &lt;/el-row&gt;

    &lt;el-row :gutter=&quot;10&quot;&gt;
      &lt;el-col :span=&quot;7&quot;&gt;
        &lt;chart-card&gt;
          &lt;pie-echart :pie-data=&quot;showGoodsCategoryCount&quot;/&gt;
        &lt;/chart-card&gt;
      &lt;/el-col&gt;

      &lt;el-col :span=&quot;10&quot;&gt;
        &lt;chart-card&gt;
          &lt;line-echart/&gt;
        &lt;/chart-card&gt;

      &lt;/el-col&gt;

      &lt;el-col :span=&quot;7&quot;&gt;
        &lt;chart-card&gt;
          &lt;rose-echart :rose-data=&quot;showGoodsCategoryCount&quot;/&gt;
        &lt;/chart-card&gt;
      &lt;/el-col&gt;
    &lt;/el-row&gt;

    &lt;el-row :gutter=&quot;10&quot;&gt;
      &lt;el-col :span=&quot;12&quot;&gt;
        &lt;chart-card&gt;
          &lt;line-echart :labels=&quot;showGoodsCategorySale.labels&quot; :values=&quot;showGoodsCategorySale.values&quot;/&gt;
        &lt;/chart-card&gt;
      &lt;/el-col&gt;

      &lt;el-col :span=&quot;12&quot;&gt;
        &lt;chart-card&gt;
          &lt;bar-echart v-bind=&quot;showGoodsCategoryFavor&quot;/&gt;
        &lt;/chart-card&gt;
      &lt;/el-col&gt;
    &lt;/el-row&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import { storeToRefs } from &#39;pinia&#39;
import { computed } from &quot;vue&quot;;
import countCard from &quot;./cpns/count-card/count-card.vue&quot;;
import chartCard from &quot;./cpns/chart-card/chart-card.vue&quot;;
import useAnalysisStore from &#39;@/store/main/analysis/analysis&#39;

// 发起actions封装的网络请求
const analysisStore = useAnalysisStore()
analysisStore.fetchAnalysisDataAction()

// 获取数据
const { amountList, goodsCategoryCount, goodsCategorySale, goodsCategoryFavor } = storeToRefs(analysisStore)

// 获取echart饼图、玫瑰图数据(将接口数据映射成name, value)
const showGoodsCategoryCount = computed(() =&gt; {
  return goodsCategoryCount.value.map((item) =&gt; ({
    name: item.name,
    value: item.goodsCount
  }))
})

// 获取echart折线图数据(将接口数据映射成labels、values)
const showGoodsCategorySale = computed(() =&gt; {
  const labels = goodsCategorySale.value.map((item) =&gt; item.name)
  const values = goodsCategorySale.value.map((item) =&gt; item.goodsSale)
  return { labels, values }
})

// 获取echart柱状图数据
const showGoodsCategoryFavor = computed(() =&gt; {
  const labels = goodsCategoryFavor.value.map((item) =&gt; item.name)
  const values = goodsCategoryFavor.value.map((item) =&gt; item.goodsFavor)
  return { labels, values }
})
&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;
.el-row {
  margin-bottom: 15px;
}
&lt;/style&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-echart-地图数据展示" tabindex="-1"><a class="header-anchor" href="#实现-echart-地图数据展示" aria-hidden="true">#</a> 实现 echart 地图数据展示</h3><h4 id="引入地图位置经纬度-json-数据" tabindex="-1"><a class="header-anchor" href="#引入地图位置经纬度-json-数据" aria-hidden="true">#</a> 引入地图位置经纬度 json 数据</h4><p><a href="https://datav.aliyun.com/portal/school/atlas/area_selector#&amp;lat=31.769817845138945&amp;lng=104.29901249999999&amp;zoom=4" target="_blank" rel="noopener noreferrer">阿里云地图 JSON API<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>：<a href="https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json" target="_blank" rel="noopener noreferrer">https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="封装坐标信息" tabindex="-1"><a class="header-anchor" href="#封装坐标信息" aria-hidden="true">#</a> 封装坐标信息</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// utils/coordinate-data.ts
export const coordinateData: any = {
  上海: [121.487899486, 31.24916171],
  临沧: [100.092612914, 23.8878061038],
  丽江: [100.229628399, 26.8753510895],
  保山: [99.1779956133, 25.1204891962],
  大理白族自治州: [100.223674789, 25.5968996394],
  德宏傣族景颇族自治州: [98.5894342874, 24.441239663],
  怒江傈僳族自治州: [98.8599320425, 25.8606769782],
  文山壮族苗族自治州: [104.246294318, 23.3740868504],
  昆明: [102.714601139, 25.0491531005],
  昭通: [103.725020656, 27.3406329636],
  普洱: [100.98005773, 22.7887777801],
  曲靖: [103.782538888, 25.5207581429],
  楚雄彝族自治州: [101.529382239, 25.0663556742],
  玉溪: [102.545067892, 24.3704471344],
  红河哈尼族彝族自治州: [103.384064757, 23.3677175165],
  西双版纳傣族自治州: [100.803038275, 22.0094330022],
  迪庆藏族自治州: [99.7136815989, 27.8310294612],
  乌兰察布: [113.112846391, 41.0223629468],
  乌海: [106.831999097, 39.6831770068],
  兴安盟: [122.048166514, 46.0837570652],
  包头: [109.846238532, 40.6471194257],
  呼伦贝尔: [119.760821794, 49.2016360546],
  呼和浩特: [111.66035052, 40.8283188731],
  巴彦淖尔: [107.42380672, 40.7691799024],
  赤峰: [118.930761192, 42.2971123203],
  通辽: [122.260363263, 43.633756073],
  鄂尔多斯: [109.993706251, 39.8164895606],
  锡林郭勒盟: [116.027339689, 43.9397048423],
  阿拉善盟: [105.695682871, 38.8430752644],
  北京: [116.395645038, 39.9299857781],
  台中: [119.337634104, 26.0911937119],
  台北: [114.130474436, 22.3748329286],
  台南: [121.360525873, 38.9658447898],
  嘉义: [114.246701335, 22.7288657203],
  高雄: [111.590952812, 21.9464822541],
  吉林: [126.564543989, 43.8719883344],
  四平: [124.391382074, 43.1755247011],
  延边朝鲜族自治州: [129.485901958, 42.8964136037],
  松原: [124.832994532, 45.1360489701],
  白城: [122.840776679, 45.6210862752],
  白山: [126.435797675, 41.945859397],
  辽源: [125.133686052, 42.9233026191],
  通化: [125.942650139, 41.7363971299],
  长春: [125.313642427, 43.8983376071],
  乐山: [103.760824239, 29.6009576111],
  内江: [105.073055992, 29.5994615348],
  凉山彝族自治州: [102.259590803, 27.8923929037],
  南充: [106.105553984, 30.8009651682],
  宜宾: [104.633019062, 28.7696747963],
  巴中: [106.757915842, 31.8691891592],
  广元: [105.81968694, 32.4410401584],
  广安: [106.635720331, 30.4639838879],
  德阳: [104.402397818, 31.1311396527],
  成都: [104.067923463, 30.6799428454],
  攀枝花: [101.722423152, 26.5875712571],
  泸州: [105.443970289, 28.8959298039],
  甘孜藏族自治州: [101.969232063, 30.0551441144],
  眉山: [103.841429563, 30.0611150799],
  绵阳: [104.705518975, 31.5047012581],
  自贡: [104.776071339, 29.3591568895],
  资阳: [104.635930302, 30.132191434],
  达州: [107.494973447, 31.2141988589],
  遂宁: [105.564887792, 30.5574913504],
  阿坝藏族羌族自治州: [102.228564689, 31.9057628583],
  雅安: [103.009356466, 29.9997163371],
  天津: [117.210813092, 39.1439299033],
  中卫: [105.196754199, 37.5211241916],
  吴忠: [106.208254199, 37.9935610029],
  固原: [106.285267996, 36.0215234807],
  石嘴山: [106.379337202, 39.0202232836],
  银川: [106.206478608, 38.5026210119],
  亳州: [115.787928245, 33.8712105653],
  六安: [116.505252683, 31.7555583552],
  合肥: [117.282699092, 31.8669422607],
  安庆: [117.058738772, 30.5378978174],
  宣城: [118.752096311, 30.9516423543],
  宿州: [116.988692412, 33.6367723858],
  池州: [117.494476772, 30.6600192482],
  淮北: [116.791447429, 33.9600233054],
  淮南: [117.018638863, 32.6428118237],
  滁州: [118.324570351, 32.3173505954],
  芜湖: [118.384108423, 31.3660197875],
  蚌埠: [117.357079866, 32.9294989067],
  铜陵: [117.819428729, 30.9409296947],
  阜阳: [115.820932259, 32.9012113306],
  马鞍山: [118.515881847, 31.6885281589],
  黄山: [118.293569632, 29.7344348562],
  东营: [118.583926333, 37.4871211553],
  临沂: [118.340768237, 35.0724090744],
  威海: [122.093958366, 37.5287870813],
  德州: [116.328161364, 37.4608259263],
  日照: [119.507179943, 35.4202251931],
  枣庄: [117.279305383, 34.8078830784],
  泰安: [117.089414917, 36.1880777589],
  济南: [117.024967066, 36.6827847272],
  济宁: [116.600797625, 35.4021216643],
  淄博: [118.059134278, 36.8046848542],
  滨州: [117.968292415, 37.4053139418],
  潍坊: [119.142633823, 36.7161148731],
  烟台: [121.30955503, 37.5365615629],
  聊城: [115.986869139, 36.4558285147],
  莱芜: [117.684666912, 36.2336541336],
  菏泽: [115.463359775, 35.2624404961],
  青岛: [120.384428184, 36.1052149013],
  临汾: [111.538787596, 36.0997454436],
  吕梁: [111.143156602, 37.527316097],
  大同: [113.290508673, 40.1137444997],
  太原: [112.550863589, 37.890277054],
  忻州: [112.727938829, 38.461030573],
  晋中: [112.7385144, 37.6933615268],
  晋城: [112.867332758, 35.4998344672],
  朔州: [112.479927727, 39.3376719662],
  运城: [111.006853653, 35.0388594798],
  长治: [113.120292086, 36.2016643857],
  阳泉: [113.569237602, 37.8695294932],
  东莞: [113.763433991, 23.0430238154],
  中山: [113.422060021, 22.5451775145],
  云浮: [112.050945959, 22.9379756855],
  佛山: [113.134025635, 23.0350948405],
  广州: [113.307649675, 23.1200491021],
  惠州: [114.41065808, 23.1135398524],
  揭阳: [116.379500855, 23.5479994669],
  梅州: [116.126403098, 24.304570606],
  汕头: [116.728650288, 23.3839084533],
  汕尾: [115.372924289, 22.7787305002],
  江门: [113.078125341, 22.5751167835],
  河源: [114.713721476, 23.7572508505],
  深圳: [114.025973657, 22.5460535462],
  清远: [113.040773349, 23.6984685504],
  湛江: [110.365067263, 21.2574631038],
  潮州: [116.630075991, 23.6618116765],
  珠海: [113.562447026, 22.2569146461],
  肇庆: [112.47965337, 23.0786632829],
  茂名: [110.931245331, 21.6682257188],
  阳江: [111.977009756, 21.8715173045],
  韶关: [113.594461107, 24.8029603119],
  北海: [109.122627919, 21.472718235],
  南宁: [108.297233556, 22.8064929356],
  崇左: [107.357322038, 22.4154552965],
  来宾: [109.231816505, 23.7411659265],
  柳州: [109.42240181, 24.3290533525],
  桂林: [110.260920147, 25.262901246],
  梧州: [111.30547195, 23.4853946367],
  河池: [108.069947709, 24.6995207829],
  玉林: [110.151676316, 22.6439736084],
  百色: [106.631821404, 23.9015123679],
  贵港: [109.613707557, 23.1033731644],
  贺州: [111.552594179, 24.4110535471],
  钦州: [108.638798056, 21.9733504653],
  防城港: [108.351791153, 21.6173984705],
  乌鲁木齐: [87.5649877411, 43.8403803472],
  伊犁哈萨克自治州: [81.2978535304, 43.9222480963],
  克孜勒苏柯尔克孜自治州: [76.1375644775, 39.7503455778],
  克拉玛依: [84.8811801861, 45.5943310667],
  博尔塔拉蒙古自治州: [82.0524362672, 44.9136513743],
  吐鲁番地区: [89.1815948657, 42.9604700169],
  和田地区: [79.9302386372, 37.1167744927],
  哈密地区: [93.5283550928, 42.8585963324],
  喀什地区: [75.9929732675, 39.4706271887],
  塔城地区: [82.9748805837, 46.7586836297],
  昌吉回族自治州: [87.2960381257, 44.0070578985],
  自治区直辖: [85.6148993383, 42.1270009576],
  阿克苏地区: [80.2698461793, 41.1717309015],
  阿勒泰地区: [88.1379154871, 47.8397444862],
  南京: [118.778074408, 32.0572355018],
  南通: [120.873800951, 32.0146645408],
  宿迁: [118.296893379, 33.9520497337],
  常州: [119.981861013, 31.7713967447],
  徐州: [117.188106623, 34.2715534311],
  扬州: [119.427777551, 32.4085052546],
  无锡: [120.305455901, 31.5700374519],
  泰州: [119.919606016, 32.4760532748],
  淮安: [119.030186365, 33.6065127393],
  盐城: [120.148871818, 33.3798618771],
  苏州: [120.619907115, 31.317987368],
  连云港: [119.173872217, 34.601548967],
  镇江: [119.455835405, 32.2044094436],
  上饶: [117.955463877, 28.4576225539],
  九江: [115.999848022, 29.7196395261],
  南昌: [115.893527546, 28.6895780001],
  吉安: [114.992038711, 27.1138476502],
  宜春: [114.400038672, 27.8111298958],
  抚州: [116.360918867, 27.9545451703],
  新余: [114.947117417, 27.8223215586],
  景德镇: [117.186522625, 29.3035627684],
  萍乡: [113.859917033, 27.639544223],
  赣州: [114.935909079, 25.8452955363],
  鹰潭: [117.035450186, 28.2413095972],
  保定: [115.494810169, 38.886564548],
  唐山: [118.183450598, 39.6505309225],
  廊坊: [116.703602223, 39.5186106251],
  张家口: [114.89378153, 40.8111884911],
  承德: [117.933822456, 40.9925210525],
  沧州: [116.863806476, 38.2976153503],
  石家庄: [114.522081844, 38.0489583146],
  秦皇岛: [119.604367616, 39.9454615659],
  衡水: [115.686228653, 37.7469290459],
  邢台: [114.520486813, 37.0695311969],
  邯郸: [114.482693932, 36.6093079285],
  三门峡: [111.181262093, 34.7833199411],
  信阳: [114.085490993, 32.1285823075],
  南阳: [112.542841901, 33.0114195691],
  周口: [114.654101942, 33.6237408181],
  商丘: [115.641885688, 34.4385886402],
  安阳: [114.351806508, 36.1102667222],
  平顶山: [113.300848978, 33.7453014565],
  开封: [114.351642118, 34.8018541758],
  新乡: [113.912690161, 35.3072575577],
  洛阳: [112.447524769, 34.6573678177],
  漯河: [114.0460614, 33.5762786885],
  濮阳: [115.026627441, 35.7532978882],
  焦作: [113.211835885, 35.234607555],
  许昌: [113.83531246, 34.0267395887],
  郑州: [113.64964385, 34.7566100641],
  驻马店: [114.049153547, 32.9831581541],
  鹤壁: [114.297769838, 35.7554258742],
  丽水: [119.929575843, 28.4562995521],
  台州: [121.440612936, 28.6682832857],
  嘉兴: [120.760427699, 30.7739922396],
  宁波: [121.579005973, 29.8852589659],
  杭州: [120.219375416, 30.2592444615],
  温州: [120.690634734, 28.002837594],
  湖州: [120.137243163, 30.8779251557],
  绍兴: [120.592467386, 30.0023645805],
  舟山: [122.169872098, 30.0360103026],
  衢州: [118.875841652, 28.9569104475],
  金华: [119.652575704, 29.1028991054],
  三亚: [109.522771281, 18.2577759149],
  三沙: [112.350383075, 16.840062894],
  海口: [110.330801848, 20.022071277],
  十堰: [110.801228917, 32.6369943395],
  咸宁: [114.300060592, 29.8806567577],
  孝感: [113.935734392, 30.9279547842],
  宜昌: [111.310981092, 30.732757818],
  恩施土家族苗族自治州: [109.491923304, 30.2858883166],
  武汉: [114.316200103, 30.5810841269],
  省直辖: [112.410562192, 31.2093162501],
  荆州: [112.241865807, 30.332590523],
  荆门: [112.217330299, 31.0426112029],
  襄阳: [112.250092848, 32.2291685915],
  鄂州: [114.895594041, 30.3844393228],
  随州: [113.379358364, 31.7178576082],
  黄冈: [114.906618047, 30.4461089379],
  黄石: [115.050683164, 30.2161271277],
  娄底: [111.996396357, 27.7410733023],
  岳阳: [113.146195519, 29.3780070755],
  常德: [111.653718137, 29.0121488552],
  张家界: [110.481620157, 29.1248893532],
  怀化: [109.986958796, 27.5574829012],
  株洲: [113.131695341, 27.8274329277],
  永州: [111.614647686, 26.4359716468],
  湘潭: [112.935555633, 27.835095053],
  湘西土家族苗族自治州: [109.7457458, 28.3179507937],
  益阳: [112.366546645, 28.5880877799],
  衡阳: [112.583818811, 26.8981644154],
  邵阳: [111.461525404, 27.2368112449],
  郴州: [113.037704468, 25.7822639757],
  长沙: [112.979352788, 28.2134782309],
  无堂区划分区域: [113.557519102, 22.2041179884],
  澳门半岛: [113.566432335, 22.1950041592],
  澳门离岛: [113.557519102, 22.2041179884],
  临夏回族自治州: [103.215249178, 35.5985143488],
  兰州: [103.823305441, 36.064225525],
  嘉峪关: [98.2816345853, 39.8023973267],
  天水: [105.736931623, 34.5843194189],
  定西: [104.626637601, 35.5860562418],
  平凉: [106.688911157, 35.55011019],
  庆阳: [107.644227087, 35.7268007545],
  张掖: [100.459891869, 38.939320297],
  武威: [102.640147343, 37.9331721429],
  甘南藏族自治州: [102.917442486, 34.9922111784],
  白银: [104.171240904, 36.5466817062],
  酒泉: [98.5084145062, 39.7414737682],
  金昌: [102.208126263, 38.5160717995],
  陇南: [104.934573406, 33.3944799729],
  三明: [117.642193934, 26.2708352794],
  南平: [118.181882949, 26.6436264742],
  厦门: [118.103886046, 24.4892306125],
  宁德: [119.54208215, 26.6565274192],
  泉州: [118.600362343, 24.901652384],
  漳州: [117.676204679, 24.5170647798],
  福州: [119.330221107, 26.0471254966],
  莆田: [119.077730964, 25.4484501367],
  龙岩: [117.017996739, 25.0786854335],
  山南地区: [91.7506438744, 29.2290269317],
  拉萨: [91.111890896, 29.6625570621],
  日喀则地区: [88.8914855677, 29.2690232039],
  昌都地区: [97.18558158, 31.1405756319],
  林芝地区: [94.3499854582, 29.6669406258],
  那曲地区: [92.0670183689, 31.4806798301],
  阿里地区: [81.1076686895, 30.4045565883],
  六盘水: [104.85208676, 26.5918660603],
  安顺: [105.928269966, 26.2285945777],
  毕节: [105.333323371, 27.4085621313],
  贵阳: [106.709177096, 26.6299067414],
  遵义: [106.931260316, 27.6999613771],
  铜仁: [109.168558028, 27.6749026906],
  黔东南苗族侗族自治州: [107.985352573, 26.5839917665],
  黔南布依族苗族自治州: [107.52320511, 26.2645359974],
  黔西南布依族苗族自治州: [104.900557798, 25.0951480559],
  丹东: [124.338543115, 40.1290228266],
  大连: [121.593477781, 38.9487099383],
  抚顺: [123.929819767, 41.8773038296],
  朝阳: [120.446162703, 41.5718276679],
  本溪: [123.77806237, 41.3258376266],
  沈阳: [123.432790922, 41.8086447835],
  盘锦: [122.07322781, 41.141248023],
  营口: [122.233391371, 40.6686510665],
  葫芦岛: [120.860757645, 40.7430298813],
  辽阳: [123.172451205, 41.2733392656],
  铁岭: [123.854849615, 42.2997570121],
  锦州: [121.147748738, 41.1308788759],
  阜新: [121.660822129, 42.0192501071],
  鞍山: [123.007763329, 41.1187436822],
  重庆: [106.530635013, 29.5446061089],
  咸阳: [108.707509278, 34.345372996],
  商洛: [109.934208154, 33.8739073951],
  安康: [109.038044563, 32.70437045],
  宝鸡: [107.170645452, 34.3640808097],
  延安: [109.500509757, 36.6033203523],
  榆林: [109.745925744, 38.2794392401],
  汉中: [107.045477629, 33.0815689782],
  渭南: [109.483932697, 34.5023579758],
  西安: [108.953098279, 34.2777998978],
  铜川: [108.968067013, 34.9083676964],
  果洛藏族自治州: [100.223722769, 34.4804845846],
  海东地区: [102.085206987, 36.5176101677],
  海北藏族自治州: [100.879802174, 36.9606541011],
  海南藏族自治州: [100.624066094, 36.2843638038],
  海西蒙古族藏族自治州: [97.3426254153, 37.3737990706],
  玉树藏族自治州: [97.0133161374, 33.0062399097],
  西宁: [101.76792099, 36.640738612],
  黄南藏族自治州: [102.007600308, 35.5228515517],
  九龙: [114.173291988, 22.3072458588],
  新界: [114.146701965, 22.4274312754],
  香港岛: [114.183870524, 22.2721034276],
  七台河: [131.019048047, 45.7750053686],
  伊春: [128.910765978, 47.7346850751],
  佳木斯: [130.284734586, 46.8137796047],
  双鸭山: [131.17140174, 46.6551020625],
  哈尔滨: [126.657716855, 45.7732246332],
  大兴安岭地区: [124.19610419, 51.991788968],
  大庆: [125.02183973, 46.59670902],
  牡丹江: [129.608035396, 44.5885211528],
  绥化: [126.989094572, 46.646063927],
  鸡西: [130.941767273, 45.3215398866],
  鹤岗: [130.292472051, 47.3386659037],
  黑河: [127.500830295, 50.2506900907],
  齐齐哈尔: [123.987288942, 47.3476998134]
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="封装转化坐标信息属性为-echart-地图所需属性工具" tabindex="-1"><a class="header-anchor" href="#封装转化坐标信息属性为-echart-地图所需属性工具" aria-hidden="true">#</a> 封装转化坐标信息属性为 echart 地图所需属性工具</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// utils/convert-data.ts
import { coordinateData } from &quot;./coordinate-data&quot;

export function convertData(data: any) {
    const res = []
    for(let i = 0; i &lt; data.length; i++) {
        const geoCoord = coordinateData[data[i].name]
        if(geoCoord) {
            res.push({
                name: data[i].name,
                value: geoCoord.concat(data[i].value)
            })
        }
    }
    return res
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="echart-注册地图" tabindex="-1"><a class="header-anchor" href="#echart-注册地图" aria-hidden="true">#</a> echart 注册地图</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// base-echart.vue
&lt;template&gt;
  &lt;div class=&quot;base-echart&quot;&gt;
    &lt;div class=&quot;echart&quot; ref=&quot;echartRef&quot;&gt;&lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import * as echarts from &#39;echarts&#39;
import { onMounted, ref, watchEffect } from &#39;vue&#39;
// 获取echart的option类型
import type { EChartsOption } from &#39;echarts&#39;
import ChinaJSON from &#39;../data/china.json&#39;

// echart注册地图
echarts.registerMap(&#39;china&#39;, ChinaJSON as any)

// 接收每个echart不同配置
interface IProps {
    option: EChartsOption
}
const props = defineProps&lt;IProps&gt;()

// 1. 引用dom实例
const echartRef = ref&lt;HTMLElement&gt;()
onMounted(() =&gt; {
  // 2. 基于准备好的dom，初始化echart实例
  const echartInstance = echarts.init(echartRef.value!, &quot;light&quot;, {
    renderer: &#39;canvas&#39;
  })

  // 3.第一次options(配置),动态传入每个图的option
  // watchEffect监听option变化，重新执行
  watchEffect(() =&gt; echartInstance.setOption(props.option))

  // 4.监听window缩放实现echart响应式布局
  window.addEventListener(&#39;resize&#39;, () =&gt; {
    echartInstance.resize()
  })
})
&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;
.echart {
  height: 250px;
}
&lt;/style&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="编写-echart-地图组件" tabindex="-1"><a class="header-anchor" href="#编写-echart-地图组件" aria-hidden="true">#</a> 编写 echart 地图组件</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// map-echart.vue
&lt;template&gt;
  &lt;div class=&quot;map-echart&quot;&gt;
    &lt;base-echart :option=&quot;option&quot; /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import { computed } from &#39;vue&#39;
import BaseEchart from &#39;./base-echart.vue&#39;
import type { EChartsOption } from &#39;echarts&#39;
import type { IEchartValueType } from &#39;../types&#39;
import { convertData } from &#39;../utils/convert-data&#39;

const props = defineProps&lt;{
    mapData: IEchartValueType[]
}&gt;()

// 只负责传入饼图的option
const option = computed&lt;EChartsOption&gt;(() =&gt; {
  return {
    width: &#39;270px&#39;,
    height: &#39;250px&#39;,
    center: [100, 32],
    backgroundColor: &#39;#fff&#39;,
    title: {
        text: &#39;全国销量统计&#39;,
        left: &#39;center&#39;,
        textStyle: {
            color: &#39;#fff&#39;
        }
    },
    tooltip: {
        trigger: &#39;item&#39;,
        formatter: function(params: any) {
            return params.name + &#39; : &#39; + params.value[2]
        }
    },
    visualMap: {
        min: 0,
        max: 60000,
        left: 20,
        bottom: 20,
        calculable: true,
        text: [&#39;高&#39;, &#39;低&#39;],
        inRange: {
            color: [&#39;rgb(70, 240, 252)&#39;, &#39;rgb(250, 220, 46)&#39;, &#39;rgb(245, 38, 186)&#39;]
        },
        textStyle: {
            color: &#39;#fff&#39;
        }
    },
    geo: {
        // 设置使用的地图(注册过的china地址)
        map: &#39;china&#39;,
        // 支持鼠标缩放效果
        // roam: &#39;scale&#39;,
        emphasis: {
            areaColor: &#39;#f4cccc&#39;,
            borderColor: &#39;rgb(9, 54, 95)&#39;,
            itemStyle: {
                areaColor: &#39;#f4cccc&#39;
            }
        }
    },
    series: [
        {
            name: &#39;销量&#39;,
            // 散点图在地图上展示数据
            type: &#39;scatter&#39;,
            coordinateSystem: &#39;geo&#39;,
            data: convertData(props.mapData),
            // 散点的大小（可以根据数据不同显示不同的大小，设置为一个函数）
            symbolSize: 11,
            emphasis: {
                itemStyle: {
                    borderCap: &#39;#fff&#39;,
                    borderWidth: 1
                }
            }
        },
        {
            // 会自动生成geo地理坐标系统
            type: &#39;map&#39;,
            // 设置使用的地图名称，复用的是第0个坐标系统
            map: &#39;china&#39;
        }
    ]
  }
})
&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;&lt;/style&gt;


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="封装地图商品销量请求数据" tabindex="-1"><a class="header-anchor" href="#封装地图商品销量请求数据" aria-hidden="true">#</a> 封装地图商品销量请求数据</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// service/analysis.ts
// 获取地图数据
export function getGoodsAddressSale() {
    return hyRequest.get({
        url: &#39;/goods/address/sale&#39;
    })
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>import { getAmountListData, getGoodsAddressSale, getGoodsCategoryCount, getGoodsCategoryFavor, getGoodsCategorySale } from &quot;@/service/main/analysis/analysis&quot;;
import { defineStore } from &quot;pinia&quot;;

interface IAnalysisState {
    // ...
    goodsAddressSale: any[]
}
const useAnalysisStore = defineStore(&#39;analysis&#39;, {
    state: (): IAnalysisState =&gt; ({
        // ....
        goodsAddressSale: []
    }),
    actions: {
        async fetchAnalysisDataAction() {
            // 顶部卡片数据...
            // 获取饼图、玫瑰图数据...
            // 获取折线图数据...
            // 获取柱状图数据...

            // 获取地图数据
            const goodsAddressSaleResult = await getGoodsAddressSale()
            this.goodsAddressSale = goodsAddressSaleResult.data
            console.log(this.goodsAddressSale);
        },
    }
})

export default useAnalysisStore
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="父组件传递数据给地图组件" tabindex="-1"><a class="header-anchor" href="#父组件传递数据给地图组件" aria-hidden="true">#</a> 父组件传递数据给地图组件</h4><div class="language-JavaScript ext-JavaScript line-numbers-mode"><pre class="language-JavaScript"><code>// dashboard.vue
&lt;template&gt;
  &lt;div class=&quot;dashboard&quot;&gt;
    &lt;!--顶部卡片组件 --&gt;
    // ...
    &lt;el-row :gutter=&quot;10&quot;&gt;
      &lt;el-col :span=&quot;10&quot;&gt;
        &lt;chart-card&gt;
          &lt;map-echart :map-data=&quot;showGoodsAddressSale&quot;/&gt;
        &lt;/chart-card&gt;
      &lt;/el-col&gt;
    &lt;/el-row&gt;
    // ....
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
import useAnalysisStore from &#39;@/store/main/analysis/analysis&#39;
// ...

// 发起actions封装的网络请求
const analysisStore = useAnalysisStore()
analysisStore.fetchAnalysisDataAction()

// 获取数据
const { amountList, goodsCategoryCount, goodsCategorySale, goodsCategoryFavor, goodsAddressSale } = storeToRefs(analysisStore)

// 获取echart饼图数据...
// 获取echart折线图数据...
// 获取echart柱状图数据...

// 获取echart地图数据
const showGoodsAddressSale = computed(() =&gt; {
  return goodsAddressSale.value.map((item) =&gt; ({
    name: item.address,
    value: item.count
  }))
})
&lt;/script&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/xumingyu2018/xumingyu2018.github.io/edit/main/vuepress-blog/projects/vue/cms.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2023/8/22 15:12:26</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: xmy981022@163.com">Nevermore</span><!--]--><!--]--></div></footer><!----><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">MIT Licensed | Copyright © 2022-present Nevermore毓</div><div class="copyright">Copyright © 2023 Nevermore毓</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.8c0e81d7.js" defer></script>
  </body>
</html>
